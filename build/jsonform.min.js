!function(e,a,h,f,m){e&&!f&&(f=require("underscore"));function s(){return{rootClass:"",formClass:"form-group",formReadonlyClass:"jsonform-readonly",formDisabledClass:"jsonform-disabled",formInlineClass:"form-inline",formsGroupClass:"form-group",groupMarkClassPrefix:"has-",labelClass:"col-form-label",controlClass:"",iconClassPrefix:"fa fa",buttonClass:"btn-secondary",submitButtonClass:"btn-primary",resetButtonClass:"btn-danger",buttonGroupClass:"btn-group",textualInputClass:"form-control",inputGroupClass:"input-group",prependClass:"input-group-prepend",appendClass:"input-group-append",addonClass:"input-group-text",placementClassPrefix:"float",helpClass:"form-text text-muted",useTooltip:!!h.fn.tooltip,tooltipClass:"",tooltipIconSuffix:"info-circle",actionsClass:"",errorTextClass:"text-danger",imgResponsiveClass:"img-fluid",legendClass:"col-form-label-lg",navTabsClass:"nav-tabs",navItemClass:"nav-item",navLinkClass:"nav-link",selectWrapClass:"",rangeInputClass:"form-control-range",switchWrapClass:"custom-control custom-switch",switchInputClass:"custom-control-input",switchLabelClass:"custom-control-label",radioWrapClass:"form-check",radioWrapInlineClass:"form-check form-check-inline",radioInputClass:"form-check-input",radioLabelClass:"form-check-label",checkboxWrapClass:"form-check",checkboxWrapInlineClass:"form-check form-check-inline",checkboxInputClass:"form-check-input",checkboxLabelClass:"form-check-label",dropdownMenuClass:"",dropdownInputClass:""}}function u(e){return!(f.isUndefined(e)||f.isNull(e))}function r(e,t){return"object"==typeof e&&e.hasOwnProperty(t)}function p(e){return u(e)&&(e=""+e)?e.replace(/&(?!\w+;|#\d+;|#x[\da-f]+;)/gi,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;"):""}function g(e){return e.replace(/([ \!\"\#\$\%\&\'\(\)\*\+\,\.\/\:\;<\=\>\?\@\[\\\]\^\`\{\|\}\~])/g,"\\$1")}function d(e){return e.replace(/\ /g,"_")}function v(){h('[data-toggle="tooltip"]').tooltip()}function i(e){function i(e,t){t.find("> .active").removeClass("active").find("> a.active").removeClass("active"),e.addClass("active").find("> a").addClass("active")}function n(e,t){e.find("input, textarea, select").prop("disabled",!1),e.parent().children(":not([data-idx="+t+"])").find("input, textarea, select").attr("disabled","disabled")}function t(e){var t=h("option:selected",h(this)),l=h(this),s=t.get(0).getAttribute("data-idx")||t.attr("value");e.preventDefault(),t.hasClass("active")||(e=h(this).parents(".jsonform-tabbable").eq(0).find("> .tab-content > [data-idx="+s+"]"),i(t,l),i(e,e.parent()),n(e,s))}function l(e){h("a",h(this));var t=h(this).parents(".jsonform-tabbable").first().find(".tab-content").first(),l=h(this).index(),t=t.find("> [data-idx="+l+"]");e.preventDefault(),i(h(this),h(this).parent()),i(t,t.parent()),h(this).parent().hasClass("jsonform-alternative")&&n(t,l)}e.each(function(){h(this).on("change","select.nav",t),h(this).find("select.nav").each(function(){h(this).val(h(this).find(".active").attr("value"));var e=h(this).find("option:selected").get(0).getAttribute("data-idx")||h(this).find("option:selected").attr("value"),t=h(this).parents(".jsonform-tabbable").eq(0).find("> .tab-content > [data-idx="+e+"]");n(t,e)}),h(this).on("click","ul.nav li",l),h(this).find("ul.nav li.active").trigger("click")})}function t(e,t,l){return e={template:'<input type="'+e+'" class="<%= fieldHtmlClass'+(t?" || cls.textualInputClass":"")+' %>" name="<%= node.name %>" value="<%= escape(value) %>" id="<%= id %>" aria-label="<%= node.title ? escape(node.title) : node.name %>"<%= (node.disabled? " disabled" : "")%><%= (node.isReadOnly() ? " readonly=\'readonly\'" : "") %><%= (node.schemaElement && node.schemaElement.minLength ? " minlength=\'" + node.schemaElement.minLength + "\'" : "") %><%= (node.schemaElement && node.schemaElement.maxLength ? " maxlength=\'" + node.schemaElement.maxLength + "\'" : "") %><%= (node.required ? " required=\'required\'" : "") %><%= (node.placeholder? " placeholder=" + \'"\' + escape(node.placeholder) + \'"\' : "")%> />',fieldtemplate:!0,inputfield:!0,onInsert:function(e,t){if(t.formElement){var l=h(t.el).find("input");if(t.formElement.autocomplete&&l.autocomplete&&l.autocomplete(t.formElement.autocomplete),t.formElement.tagsinput||"tagsvalue"===t.formElement.getValue){if(!h.fn.tagsinput)throw new Error("tagsinput is not found");var s=Array.isArray(t.value),i=(s&&l.attr("value","").val(""),{maxChars:t.schemaElement&&t.schemaElement.maxLength&&-1<t.schemaElement.maxLength?t.schemaElement.maxLength:void 0});t.formElement.tagsinput&&f.extend(i,t.formElement.tagsinput),l.tagsinput(i),s&&t.value.forEach(function(e){l.tagsinput("add",e)})}t.formElement.typeahead&&l.typeahead&&l.typeahead(t.formElement.typeahead)}}},e=l?f.extend(e,l):e}function l(s,e){return{template:("range"===s?'<div class="range">':"")+'<input type="'+s+'" class="<%= fieldHtmlClass'+(e?" || cls.textualInputClass":"")+" %>"+("range"===s?"<%= cls.rangeInputClass %>":"")+'" name="<%= node.name %>" value="<%= escape(value) %>" id="<%= id %>" aria-label="<%= node.title ? escape(node.title) : node.name %>"<%= (node.disabled? " disabled" : "")%><%= (node.isReadOnly() ? " readonly=\'readonly\'" : "") %><%= (range.min !== undefined ? " min="+range.min : "")%><%= (range.max !== undefined ? " max="+range.max : "")%><%= (range.step !== undefined ? " step="+range.step : "")%><%= (node.schemaElement && node.schemaElement.minLength ? " minlength=\'" + node.schemaElement.minLength + "\'" : "") %><%= (node.schemaElement && node.schemaElement.maxLength ? " maxlength=\'" + node.schemaElement.maxLength + "\'" : "") %><%= (node.required ? " required=\'required\'" : "") %><%= (node.placeholder? " placeholder=" + \'"\' + escape(node.placeholder) + \'"\' : "")%> />'+("range"===s?'<% if (range.indicator) { %><span class="range-value" rel="<%= id %>"><%= escape(value) %></span><% } %></div>':""),fieldtemplate:!0,inputfield:!0,onInput:function(e,t){const l=document.querySelector('span.range-value[rel="'+t.id+'"]');l&&(l.innerText=e.target.value)},onBeforeRender:function(e,t){var l;e.range={step:1,indicator:!1},"range"==s&&(e.range.min=1,e.range.max=100),t&&t.schemaElement&&(void 0!==t.schemaElement.multipleOf?e.range.step=t.schemaElement.multipleOf:t.formElement&&t.formElement.step?e.range.step=t.formElement.step:"number"==t.schemaElement.type&&(e.range.step="any"),l="any"===e.range.step?1:e.range.step,t.formElement&&t.formElement.indicator&&(e.range.indicator=t.formElement.indicator),void 0!==t.schemaElement.minimum&&(t.schemaElement.exclusiveMinimum?e.range.min=t.schemaElement.minimum+l:e.range.min=t.schemaElement.minimum),void 0!==t.schemaElement.maximum&&(t.schemaElement.exclusiveMaximum?e.range.max=t.schemaElement.maximum-l:e.range.max=t.schemaElement.maximum))}}}function c(e,t){if(t=t.replace(/\./g,".properties.").replace(/\[[0-9]*\]/g,".items"),(e=E.util.getObjKey(e,t,!0))&&e.$ref)throw new Error("JSONForm does not yet support schemas that use the $ref keyword. See: https://github.com/joshfire/jsonform/issues/54");return e}function y(e,t,l){var s;if(l=l||0,u(t)&&""!==t)if(e.default&&0==l)s=E.util.getObjKeyEx(e.default,t);else{var i=t.match(/^((([^\\\[.]|\\.)+)|\[(\d+)\])\.?(.*)$/);if(!i)throw new Error("bad format key: "+t);if("string"==typeof i[2]&&0<i[2].length)e=e.properties[i[2]];else{if(!("string"==typeof i[4]&&0<i[4].length))throw new Error("impossible reach here");e=e.items,0<l&&--l}e&&(s=e.default&&0==l?E.util.getObjKeyEx(e.default,i[5]):y(e,i[5],l))}else 0==l&&(s=e.default);return s}function b(e,l,s){var i=0;return e?l&&0!==l.length?e.replace(x,function(e,t){return s&&2!=e.length||!u(l[i])||(e="["+l[i]+"]"),i+=1,e}):e:null}function C(){this.id=null,this.key=null,this.el=null,this.formElement=null,this.schemaElement=null,this.view=null,this.children=[],this.ownerTree=null,this.parentNode=null,this.childTemplate=null,this.legendChild=null,this.arrayPath=[],this.childPos=0}function n(){this.eventhandlers=[],this.root=null,this.formDesc=null}var x=/\[([0-9]*)\](?=\[|\.|$)/g,o={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g},w={evaluate:/\{\[([\s\S]+?)\]\}/g,interpolate:/\{\{([\s\S]+?)\}\}/g},E={util:{}};E.fieldTemplate=function(e){return'<div <% for(var key in elt.htmlMetaData) {%><%= key %>="<%= elt.htmlMetaData[key] %>" <% }%>class="<%= cls.formClass %> jsonform-node jsonform-error-<%= keydash %><%= elt.htmlClass ? " " + elt.htmlClass : "" %><%= (node.required && node.formElement && (node.formElement.type !== "checkbox") && (node.formElement.type !== "switch") ? " jsonform-required" : "") %><%= (node.isReadOnly() ? " " + cls.formReadonlyClass : "") %><%= (node.disabled ? " " + cls.formDisabledClass : "") %>" data-jsonform-type="<%= node.formElement.type %>"><% if (!elt.notitle && node.inlinetitle !== true) { %><label class="<%= cls.labelClass %>" for="<%= node.id %>"><%= node.getTitle() %><% if (node.description && (elt.useTooltip === true || (elt.useTooltip === undefined && cls.useTooltip))) { %><span data-toggle="tooltip" data-placement="right" title="<%= node.description %>" class="<%= cls.tooltipClass %> jsonform-description-tooltip"><i class="<%= cls.iconClassPrefix %>-<%= cls.tooltipIconSuffix %>"></i></span><% } %></label><% } %><div<% if (cls.controlClass) { %> class="<%= cls.controlClass %>"<% } %>><% if (node.description && !(elt.useTooltip === true || (elt.useTooltip === undefined && cls.useTooltip))) { %><small class="<%= cls.helpClass %> jsonform-description"><%= node.description %></small><% } %><% if (node.prepend || node.append) { %><div class="<%= cls.inputGroupClass %>"><% if (node.prepend) { %><% if (cls.prependClass) { %><div class="<%= cls.prependClass %>"><% } %><% if (node.prepend.indexOf("<input ") >= 0) { %><div class="<%= cls.addonClass %>"><%= node.prepend %></div><% } else { %><% if (node.prepend.indexOf("<button ") >= 0) { %><%= node.prepend %><% } else { %><span class="<%= cls.addonClass %>"><%= node.prepend %></span><% } %><% } %><% if (cls.prependClass) { %></div><% } %><% } %>'+e+'<% if (node.append) { %><% if (cls.appendClass) { %><div class="<%= cls.appendClass %>"><% } %><% if (node.append.indexOf("<input ") >= 0) { %><div class="<%= cls.addonClass %>"><%= node.append %></div><% } else { %><% if (node.append.indexOf("<button ") >= 0) { %><%= node.append %><% } else { %><span class="<%= cls.addonClass %>"><%= node.append %></span><% } %><% } %><% if (cls.appendClass) { %></div><% } %><% } %></div><% } else { %>'+e+'<% } %><small class="<%= cls.errorTextClass %> jsonform-errortext" style="display:none;"></small></div></div>'},E.elementTypes={none:{template:""},root:{template:'<div<% if (cls.rootClass) { %> class="<%= cls.rootClass %>"<% } %>><%= children %></div>'},text:t("text",!0),password:t("password",!0),date:t("date",!0,{onInsert:function(e,t){var l,s;window.Modernizr&&window.Modernizr.inputtypes&&!window.Modernizr.inputtypes.date&&(l=h(t.el).find("input")).datepicker&&(s={dateFormat:"yy-mm-dd"},t.formElement&&t.formElement.datepicker&&"object"==typeof t.formElement.datepicker&&f.extend(s,t.formElement.datepicker),l.datepicker(s))}}),datetime:t("datetime",!0),"datetime-local":t("datetime-local",!0,{onBeforeRender:function(e,t){e.value&&e.value.getTime&&(e.value=new Date(e.value.getTime()-6e4*e.value.getTimezoneOffset()).toISOString().slice(0,-1))}}),email:t("email",!0),month:t("month",!0),number:l("number",!0),search:t("search",!0),tel:t("tel",!0),time:t("time",!0),url:t("url",!0),week:t("week",!0),range:l("range"),color:{template:'<span id="color_picker_<%= id %>"><input type="text" <%= (fieldHtmlClass ? "class=\'" + fieldHtmlClass + "\' " : "") %>name="<%= node.name %>" value="<%= escape(value) %>" id="<%= id %>" aria-label="<%= node.title ? escape(node.title) : node.name %>"<%= (node.disabled? " disabled" : "")%><%= (node.required ? " required=\'required\'" : "") %><%= (node.isReadOnly()? " readonly=\'readonly\'" : "") %> /></span>',fieldtemplate:!0,inputfield:!0,getElement:function(e){return h(e).parent().get(0)},onInsert:function(e,t){var l;a.Picker?(h(t.el).find("input").attr("readOnly","true"),(l=h(t.el).find("input").attr("value"))&&h(t.el).find("#"+g(t.id)).attr("style","background-color:"+l+";color:"+l),new a.Picker({parent:document.querySelector("#color_picker_"+g(t.id)),alpha:!1,color:l||"",editor:!0,editorFormat:"hex",cancelButton:!0,onDone:function(e){h(t.el).find("#"+g(t.id)).attr("value",e.hex.slice(0,7)).attr("style","background-color:"+e.hex.slice(0,7)+";color:"+e.hex.slice(0,7))}})):(l={type:"color",showPalette:!1,showAlpha:!1,allowEmpty:!0,disabled:!!t.disabled,preferredFormat:"hex",showInput:!0},t.isReadOnly()&&f.extend(l,{beforeShow:function(e){return!1}}),h(t.el).find("#"+g(t.id)).spectrum(l))}},textarea:{template:'<textarea id="<%= id %>" name="<%= node.name %>" class="<%= fieldHtmlClass || cls.textualInputClass %>" style="height:<%= elt.height || "150px" %>;width:<%= elt.width || "100%" %>;" aria-label="<%= node.title ? escape(node.title) : node.name %>"<%= (node.disabled? " disabled" : "")%><%= (node.isReadOnly() ? " readonly=\'readonly\'" : "") %><%= (node.schemaElement && node.schemaElement.minLength ? " minlength=\'" + node.schemaElement.minLength + "\'" : "") %><%= (node.schemaElement && node.schemaElement.maxLength ? " maxlength=\'" + node.schemaElement.maxLength + "\'" : "") %><%= (node.required ? " required=\'required\'" : "") %><%= (node.placeholder? " placeholder=" + \'"\' + escape(node.placeholder) + \'"\' : "")%>><%= value %></textarea>',fieldtemplate:!0,inputfield:!0},wysihtml5:{template:'<textarea id="<%= id %>" name="<%= node.name %>" style="height:<%= elt.height || "300px" %>;width:<%= elt.width || "100%" %>;" aria-label="<%= node.title ? escape(node.title) : node.name %>"class="<%= fieldHtmlClass || cls.textualInputClass %>" <%= (node.disabled? " disabled" : "")%><%= (node.isReadOnly() ? " readonly=\'readonly\'" : "") %><%= (node.schemaElement && node.schemaElement.minLength ? " minlength=\'" + node.schemaElement.minLength + "\'" : "") %><%= (node.schemaElement && node.schemaElement.maxLength ? " maxlength=\'" + node.schemaElement.maxLength + "\'" : "") %><%= (node.required ? " required=\'required\'" : "") %><%= (node.placeholder? " placeholder=" + \'"\' + escape(node.placeholder) + \'"\' : "")%>><%= value %></textarea>',fieldtemplate:!0,inputfield:!0,onInsert:function(e,t){function l(){h(t.el).data("wysihtml5")||(h(t.el).data("wysihtml5_loaded",!0),h(t.el).find("#"+g(t.id)).wysihtml5({toolbar:{html:!0,emphasis:!0,link:!!h.fn.modal,image:!!h.fn.modal,color:!1,fa:"fa"===t.ownerTree.defaultClasses.iconClassPrefix.slice(-2)},events:{load:function(){h(this.editableElement).prop("required",!1)}}}))}var s;window.jsonform_wysihtml5_setup?window.jsonform_wysihtml5_setup(l):s=window.setInterval(function(){window.wysihtml5&&(window.clearInterval(s),l())},1e3)}},summernote:{template:'<textarea id="<%= id %>" name="<%= node.name %>" style="height:<%= elt.height || "300px" %>;width:<%= elt.width || "100%" %>;" aria-label="<%= node.title ? escape(node.title) : node.name %>"class="<%= fieldHtmlClass || cls.textualInputClass %>" <%= (node.disabled? " disabled" : "")%><%= (node.isReadOnly() ? " readonly=\'readonly\'" : "") %><%= (node.schemaElement && node.schemaElement.minLength ? " minlength=\'" + node.schemaElement.minLength + "\'" : "") %><%= (node.schemaElement && node.schemaElement.maxLength ? " maxlength=\'" + node.schemaElement.maxLength + "\'" : "") %><%= (node.required ? " required=\'required\'" : "") %><%= (node.placeholder? " placeholder=" + \'"\' + escape(node.placeholder) + \'"\' : "")%>><%= value %></textarea>',fieldtemplate:!0,inputfield:!0,onInsert:function(e,t){var l,s;l=t.formElement||{},s={placeholder:t.placeholder||null,height:l.height||"300px",width:l.width||"100%",disableDragAndDrop:!0,codeviewFilter:!0,spellCheck:!1,disableGrammar:!0,callbacks:{onInit:function(){h(this).prop("required",!1)}},toolbar:[["style",["style"]],["color",["color"]],["font",["bold","italic","underline","clear"]],["para",["ul","ol","paragraph"]],["table",["table"]],["view",["codeview"]],["insert",["link","picture"]]]},"fa"===t.ownerTree.defaultClasses.iconClassPrefix.slice(-2)&&f.extend(s,{icons:{align:'<i class="'+t.ownerTree.defaultClasses.iconClassPrefix+'-align-left"/>',alignCenter:'<i class="'+t.ownerTree.defaultClasses.iconClassPrefix+'-align-center"/>',alignJustify:'<i class="'+t.ownerTree.defaultClasses.iconClassPrefix+'-align-justify"/>',alignLeft:'<i class="'+t.ownerTree.defaultClasses.iconClassPrefix+'-align-left"/>',alignRight:'<i class="'+t.ownerTree.defaultClasses.iconClassPrefix+'-align-right"/>',indent:'<i class="'+t.ownerTree.defaultClasses.iconClassPrefix+'-indent"/>',outdent:'<i class="'+t.ownerTree.defaultClasses.iconClassPrefix+'-outdent"/>',arrowsAlt:'<i class="'+t.ownerTree.defaultClasses.iconClassPrefix+'-arrows-alt"/>',bold:'<i class="'+t.ownerTree.defaultClasses.iconClassPrefix+'-bold"/>',caret:'<i class="'+t.ownerTree.defaultClasses.iconClassPrefix+'-caret-down"/>',circle:'<i class="'+t.ownerTree.defaultClasses.iconClassPrefix+'-circle"/>',close:'<i class="'+t.ownerTree.defaultClasses.iconClassPrefix+'-times"/>',code:'<i class="'+t.ownerTree.defaultClasses.iconClassPrefix+'-code"/>',eraser:'<i class="'+t.ownerTree.defaultClasses.iconClassPrefix+'-eraser"/>',italic:'<i class="'+t.ownerTree.defaultClasses.iconClassPrefix+'-italic"/>',link:'<i class="'+t.ownerTree.defaultClasses.iconClassPrefix+'-link"/>',unlink:'<i class="'+t.ownerTree.defaultClasses.iconClassPrefix+'-unlink"/>',magic:'<i class="'+t.ownerTree.defaultClasses.iconClassPrefix+'-magic"/>',menuCheck:'<i class="'+t.ownerTree.defaultClasses.iconClassPrefix+'-check"/>',minus:'<i class="'+t.ownerTree.defaultClasses.iconClassPrefix+'-minus"/>',orderedlist:'<i class="'+t.ownerTree.defaultClasses.iconClassPrefix+'-list-ol"/>',pencil:'<i class="'+t.ownerTree.defaultClasses.iconClassPrefix+'-pencil-alt"/>',picture:'<i class="'+t.ownerTree.defaultClasses.iconClassPrefix+'-image"/>',question:'<i class="'+t.ownerTree.defaultClasses.iconClassPrefix+'-question"/>',redo:'<i class="'+t.ownerTree.defaultClasses.iconClassPrefix+'-redo"/>',square:'<i class="'+t.ownerTree.defaultClasses.iconClassPrefix+'-square"/>',strikethrough:'<i class="'+t.ownerTree.defaultClasses.iconClassPrefix+'-strikethrough"/>',subscript:'<i class="'+t.ownerTree.defaultClasses.iconClassPrefix+'-subscript"/>',superscript:'<i class="'+t.ownerTree.defaultClasses.iconClassPrefix+'-superscript"/>',table:'<i class="'+t.ownerTree.defaultClasses.iconClassPrefix+'-table"/>',textHeight:'<i class="'+t.ownerTree.defaultClasses.iconClassPrefix+'-text-height"/>',trash:'<i class="'+t.ownerTree.defaultClasses.iconClassPrefix+'-trash-alt"/>',underline:'<i class="'+t.ownerTree.defaultClasses.iconClassPrefix+'-underline"/>',undo:'<i class="'+t.ownerTree.defaultClasses.iconClassPrefix+'-undo"/>',unorderedlist:'<i class="'+t.ownerTree.defaultClasses.iconClassPrefix+'-list-ul"/>',video:'<i class="'+t.ownerTree.defaultClasses.iconClassPrefix+'-film"/>'}}),l.summernote&&"object"==typeof l.summernote&&f.extend(s,l.summernote),h(t.el).find("#"+g(t.id)).summernote(s),(t.disabled||t.isReadOnly())&&h(t.el).find("#"+g(t.id)).summernote("disable")}},ace:{template:'<div id="<%= id %>" style="position:relative;height:<%= elt.height || "300px" %>;"><div id="<%= id %>__ace" style="width:<%= elt.width || "100%" %>;height:<%= elt.height || "300px" %>;"></div><input type="hidden" name="<%= node.name %>" id="<%= id %>__hidden" value="<%= escape(value) %>"/></div>',fieldtemplate:!0,inputfield:!0,onBeforeRender:function(e,t){(e.value&&"object"==typeof e.value||Array.isArray(e.value))&&(e.value=m.stringify(e.value,null,2))},onInsert:function(e,s){function t(){var e=s.formElement||{},t=window.ace.edit(h(s.el).find("#"+g(s.id)+"__ace").get(0)),l="#"+g(s.id)+"__hidden";t.getSession().setNewLineMode("unix"),t.renderer.setShowPrintMargin(!1),t.setTheme("ace/theme/"+(e.aceTheme||"twilight")),e.aceMode&&t.getSession().setMode("ace/mode/"+e.aceMode),t.getSession().setTabSize(2);null==(e=s.value)?e="":"object"!=typeof e&&!Array.isArray(e)||(e=m.stringify(e,null,2)),t.getSession().setValue(e),e=f.debounce(function(){h(s.el).find(l).val(t.getSession().getValue()),h(s.el).find(l).trigger("change")},600);t.getSession().on("change",e),t.on("blur",function(){h(s.el).find(l).trigger("change"),h(s.el).find(l).trigger("blur")}),t.on("focus",function(){h(s.el).find(l).trigger("focus")})}var l;window.jsonform_ace_setup?window.jsonform_ace_setup(t):l=window.setInterval(function(){window.ace&&(window.clearInterval(l),t())},1e3)}},checkbox:{template:'<div class="<%= cls.checkboxWrapClass %>"><input class=\'<%= cls.checkboxInputClass %><%= (checkboxTitle ? "" : " position-static") %><%= (fieldHtmlClass ? " " + fieldHtmlClass : "") %>\' type="checkbox" id="<%= id %>" value="1" name="<%= node.name %>" aria-label="<%= node.title ? escape(node.title) : node.name %>" <% if (value) {%>checked <% } %><%= (node.isReadOnly() ? "readonly=\'readonly\' " : "") %><%= (node.disabled || node.isReadOnly() ? "disabled " : "") %><%= (node.required && node.schemaElement && (node.schemaElement.type !== "boolean") ? " required=\'required\'" : "") %>/><% if (checkboxTitle) { %><label class="<%= cls.checkboxLabelClass %>" for="<%= id %>"><%= checkboxTitle || "" %></label><% } %></div>',fieldtemplate:!0,inputfield:!0,onBeforeRender:function(e,t){e.checkboxTitle=!0===t.inlinetitle?t.title:t.inlinetitle},onInsert:function(e,t){var l,s,i;t.formElement.toggleNext&&(s="jsonform-toggle-next jsonform-toggle-next-"+(l=!0===t.formElement.toggleNext?1:t.formElement.toggleNext),(i=1===l?h(t.el).next():"all"===l?h(t.el).nextAll():h(t.el).nextAll().slice(0,l)).addClass("jsonform-toggle-next-target"),h(t.el).addClass(s).find(":checkbox").on("change",function(){var e=h(this).is(":checked");h(t.el).toggleClass("checked",e),i.toggle(e).toggleClass("jsonform-toggled-visible",e)}).trigger("change"))},getElement:function(e){return h(e).parent().get(0)}},switch:{template:'<div class="<%= cls.switchWrapClass %>"><input class=\'<%= cls.switchInputClass %><%= (fieldHtmlClass ? " " + fieldHtmlClass : "") %>\' type="checkbox" id="<%= id %>" value="1" name="<%= node.name %>" aria-label="<%= node.title ? escape(node.title) : node.name %>" <% if (value) {%>checked <% } %><%= (node.isReadOnly() ? "readonly=\'readonly\' " : "") %><%= (node.disabled || node.isReadOnly() ? "disabled " : "") %><%= (node.required && node.schemaElement && (node.schemaElement.type !== "boolean") ? " required=\'required\'" : "") %>/><label class="<%= cls.switchLabelClass %>" for="<%= id %>"><%= switchTitle || "" %></label></div>',fieldtemplate:!0,inputfield:!0,onBeforeRender:function(e,t){e.switchTitle=!0===t.inlinetitle?t.title:t.inlinetitle},onInsert:function(e,t){var l,s,i;t.formElement.toggleNext&&(s="jsonform-toggle-next jsonform-toggle-next-"+(l=!0===t.formElement.toggleNext?1:t.formElement.toggleNext),(i=1===l?h(t.el).next():"all"===l?h(t.el).nextAll():h(t.el).nextAll().slice(0,l)).addClass("jsonform-toggle-next-target"),h(t.el).addClass(s).find(":checkbox").on("change",function(){var e=h(this).is(":checked");h(t.el).toggleClass("checked",e),i.toggle(e).toggleClass("jsonform-toggled-visible",e)}).trigger("change"))},getElement:function(e){return h(e).parent().get(0)}},file:{template:'<input class="input-file form-control-file" id="<%= id %>" name="<%= node.name %>" type="file" <%= (node.required ? " required=\'required\'" : "") %><%= (node.formElement && node.formElement.accept ? (" accept=\'" + node.formElement.accept + "\'") : "") %>/>',fieldtemplate:!0,inputfield:!0},select:{template:'<% if (cls.selectWrapClass) { %><div class="<%= cls.selectWrapClass %>"><% } %><select name="<%= node.name %>" id="<%= id %>" class="<%= fieldHtmlClass || cls.textualInputClass %>"<%= (node.schemaElement && node.schemaElement.disabled? " disabled" : "")%><%= (node.required ? " required=\'required\'" : "") %>> <% _.each(node.options, function(key, val) { if(key instanceof Object) { if (value === key.value) { %> <option selected value="<%= key.value %>"><%= key.title %></option> <% } else { %> <option value="<%= key.value %>"><%= key.title %></option> <% }} else { if (value === key) { %> <option selected value="<%= key %>"><%= key %></option> <% } else { %><option value="<%= key %>"><%= key %></option> <% }}}); %> </select><% if (cls.selectWrapClass) { %></div><% } %>',fieldtemplate:!0,inputfield:!0},tagsinput:{template:'<select name="<%= node.name %><%= node.formElement.getValue === "tagsinput" ? "" : "[]" %>" id="<%= id %>" class="<%= fieldHtmlClass || cls.textualInputClass %>" multiple<%= (node.disabled? " disabled" : "")%><%= (node.required ? " required=\'required\'" : "") %>> </select>',fieldtemplate:!0,inputfield:!0,onInsert:function(e,t){if(!h.fn.tagsinput)throw new Error("tagsinput is not found");var l=h(t.el).find("select"),s={};t.schemaElement&&"array"===t.schemaElement.type&&(t.schemaElement.maxItems&&-1<t.schemaElement.maxItems&&(s.maxTags=t.schemaElement.maxItems),s.allowDuplicates=!t.schemaElement.uniqueItems,"object"==typeof t.schemaElement.items&&"string"===t.schemaElement.items.type&&(s.maxChars=t.schemaElement.items.maxLength&&-1<t.schemaElement.items.maxLength?t.schemaElement.items.maxLength:void 0)),t.formElement&&t.formElement.tagsinput&&f.extend(s,t.formElement.tagsinput),l.tagsinput(s),t.value&&t.value.forEach(function(e){l.tagsinput("add",e)})}},imageselect:{template:'<div><input type="hidden" name="<%= node.name %>" id="<%= node.id %>" value="<%= value %>" /><div class="dropdown"><a class="btn <%= cls.buttonClass %> <%= cls.dropdownInputClass %>" data-toggle="dropdown" href="#"<% if (node.value) { %> style="max-width:<%= width %>px;max-height:<%= height %>px"<% } %>><% if (node.value) { %><img class="<%= cls.imgResponsiveClass %>" src="<% if (!node.value.match(/^https?:/)) { %><%= prefix %><% } %><%= node.value %><%= suffix %>" alt="" /><% } else { %><%= buttonTitle %><% } %></a><div class="dropdown-menu <%= cls.dropdownMenuClass %>" id="<%= node.id %>_dropdown"><div><% _.each(node.options, function(key, idx) { if ((idx > 0) && ((idx % columns) === 0)) { %></div><div><% } %><a class="btn<% if (buttonClass) { %> <%= buttonClass %><% } %>" style="max-width:<%= width %>px;max-height:<%= height %>px"><% if (key instanceof Object) { %><img class="<%= cls.imgResponsiveClass %>" src="<% if (!key.value.match(/^https?:/)) { %><%= prefix %><% } %><%= key.value %><%= suffix %>" alt="<%= key.title %>" /></a><% } else { %><img class="<%= cls.imgResponsiveClass %>" src="<% if (!key.match(/^https?:/)) { %><%= prefix %><% } %><%= key %><%= suffix %>" alt="" /><% } %></a> <% }); %></div><div class="<%= cls.placementClassPrefix %>-right"><a class="btn <%= cls.buttonClass %>">Reset</a></div></div></div></div>',fieldtemplate:!0,inputfield:!0,onBeforeRender:function(e,t){var l=t.formElement||{},s=l.imageSelectorColumns||5;e.buttonTitle=l.imageSelectorTitle||"Select...",e.prefix=l.imagePrefix||"",e.suffix=l.imageSuffix||"",e.width=l.imageWidth||32,e.height=l.imageHeight||32,e.buttonClass=l.imageButtonClass||!1,t.options.length>s?(l=Math.ceil(t.options.length/s),e.columns=Math.ceil(t.options.length/l)):e.columns=s},getElement:function(e){return h(e).parent().get(0)},onInsert:function(e,a){h(a.el).on("click",".dropdown-menu a",function(e){e.preventDefault(),e.stopPropagation();var e=("img"===e.target.nodeName.toLowerCase()?h(e.target):h(e.target).find("img")).attr("src"),t=a.formElement||{},l=t.imagePrefix||"",s=t.imageSuffix||"",i=t.imageWidth||32,n=t.imageHeight||32;e?(e=(e=0===e.indexOf(l)?e.substring(l.length):e).substring(0,e.length-s.length),h(a.el).find("input").attr("value",e),h(a.el).find('a[data-toggle="dropdown"]').attr("style","max-width:"+i+"px;max-height:"+n+"px").html('<img class="'+a.ownerTree.defaultClasses.imgResponsiveClass+'" src="'+(e.match(/^https?:/)?"":l)+e+s+'" alt="" />').dropdown("hide")):(h(a.el).find("input").attr("value",""),h(a.el).find('a[data-toggle="dropdown"]').removeAttr("style").html(t.imageSelectorTitle||"Select...").dropdown("hide"))})}},iconselect:{template:'<div><input type="hidden" name="<%= node.name %>" id="<%= node.id %>" value="<%= value %>" /><div class="dropdown"><a class="btn <%= cls.buttonClass %> <%= cls.dropdownInputClass %>" data-toggle="dropdown" href="#"><% if (node.value) { %><i class="<%= cls.iconClassPrefix %>-<%= node.value %><% if (isFaIcon) { %> fa-fw<% } %>" alt="" /><% } else { %><%= buttonTitle %><% } %></a><div class="dropdown-menu <%= cls.dropdownMenuClass %>" id="<%= node.id %>_dropdown"><div><% _.each(node.options, function(key, idx) { if ((idx > 0) && ((idx % columns) === 0)) { %></div><div><% } %><a class="btn<% if (buttonClass) { %> <%= buttonClass %><% } %>"><% if (key instanceof Object) { %><i class="<%= cls.iconClassPrefix %>-<%= key.value %><% if (isFaIcon) { %> fa-fw<% } %>" alt="<%= key.title %>"></i><% } else { %><i class="<%= cls.iconClassPrefix %>-<%= key %><% if (isFaIcon) { %> fa-fw<% } %>" alt=""></i><% } %></a> <% }); %></div><div class="<%= cls.placementClassPrefix %>-right"><a class="btn <%= cls.buttonClass %>">Reset</a></div></div></div></div>',fieldtemplate:!0,inputfield:!0,onBeforeRender:function(e,t){var l=t.formElement||{},s=l.imageSelectorColumns||5;e.buttonTitle=l.imageSelectorTitle||"Select...",e.buttonClass=l.imageButtonClass||!1,e.isFaIcon="fa"===e.cls.iconClassPrefix.slice(-2),t.options.length>s?(l=Math.ceil(t.options.length/s),e.columns=Math.ceil(t.options.length/l)):e.columns=s},getElement:function(e){return h(e).parent().get(0)},onInsert:function(e,s){h(s.el).on("click",".dropdown-menu a",function(e){e.preventDefault(),e.stopPropagation();var e=("i"===e.target.nodeName.toLowerCase()?h(e.target):h(e.target).find("i")).attr("class"),t=s.formElement||{},l="fa"===s.ownerTree.defaultClasses.iconClassPrefix.slice(-2);e?(0===e.indexOf(s.ownerTree.defaultClasses.iconClassPrefix)&&(e=e.substring(s.ownerTree.defaultClasses.iconClassPrefix.length+1)),l&&(e=e.substring(0,e.length-" fa-fw".length)),h(s.el).find("input").attr("value",e),h(s.el).find('a[data-toggle="dropdown"]').html('<i class="'+s.ownerTree.defaultClasses.iconClassPrefix+"-"+e+(l?" fa-fw":"")+'" alt="" />').dropdown("hide")):(h(s.el).find("input").attr("value",""),h(s.el).find('a[data-toggle="dropdown"]').html(t.imageSelectorTitle||"Select...").dropdown("hide"))})}},radios:{template:'<div id="<%= node.id %>"<% if (elt.inline) { %> class="<%= cls.formInlineClass %>"<% } %>><% _.each(node.options, function(key, val) { %><div class="<% if (elt.inline) { %><%= cls.radioWrapInlineClass %><% } else { %><%= cls.radioWrapClass %><% } %>"><input class=\'<%= cls.radioInputClass %><%= (fieldHtmlClass ? " " + fieldHtmlClass : "") %>\' type="radio" id="<%= node.id %>_<%= escape(key instanceof Object ? key.title : key) %>" value="<%= (key instanceof Object ? key.value : key) %>" name="<%= node.name %>" aria-label="<%= (key instanceof Object ? key.title : key) %>" <% if (((key instanceof Object) && (value === key.value)) || (value === key)) { %>checked="checked" <% } else { %><%= (node.isReadOnly() ? "disabled " : "") %><% } %><%= (node.disabled ? "disabled " : "") %><%= (node.required ? "required=\'required\'" : "") %>/><label class="<%= cls.radioLabelClass %>" for="<%= node.id %>_<%= escape(key instanceof Object ? key.title : key) %>"><%= (key instanceof Object ? key.title : key) %></label></div><% }); %></div>',fieldtemplate:!0,inputfield:!0,onInsert:function(e,t){if(t.formElement.toggleNextMap){var l,n={};for(l in t.formElement.toggleNextMap){var s=t.formElement.toggleNextMap[l],s=!0===s?1:s,i="jsonform-toggle-next jsonform-toggle-next-"+s,s=1===s?h(t.el).next():"all"===s?h(t.el).nextAll():h(t.el).nextAll().slice(0,s);s.addClass("jsonform-toggle-next-target"),n[l]=s}h(t.el).addClass(i).find(":radio").on("change",function(){var e,t=h(this),l=t.val(),s=t.is(":checked");for(e in n){var i=n[e];s&&e===l?i.toggle(!0).toggleClass("jsonform-toggled-visible",!0):i.toggle(!1).toggleClass("jsonform-toggled-visible",!1)}}).trigger("change")}}},radiobuttons:{template:'<div id="<%= node.id %>" class="<%= cls.buttonGroupClass %> btn-group-toggle" data-toggle="buttons"><% _.each(node.options, function(key, val) { %><label class="btn <% if (((key instanceof Object) && (value === key.value)) || (value === key)) { %>active <%= elt.activeClass ? elt.activeClass : cls.buttonClass %><% } else { %><%= cls.buttonClass %><% } %><%= (node.disabled || node.isReadOnly() ? " disabled" : "") %>"><input type="radio" style="position:absolute;left:-9999px;" <%= (fieldHtmlClass ? "class=\'" + fieldHtmlClass + "\' ": "") %>name="<%= node.name %>" value="<%= (key instanceof Object ? key.value : key) %>" <% if (((key instanceof Object) && (value === key.value)) || (value === key)) { %>checked="checked" <% } %><%= (node.disabled ? "disabled" : "") %>/><%= (key instanceof Object ? key.title : key) %></label> <% }); %></div>',fieldtemplate:!0,inputfield:!0,onInsert:function(e,t){var l,s;t.disabled||t.isReadOnly()||(l="active",(s=t.formElement||{}).activeClass?l+=" "+s.activeClass:l+=" "+t.ownerTree.defaultClasses.buttonClass,h(t.el).find("label.btn").on("click",function(){h(this).parent().find("label.btn").removeClass(l).addClass(t.ownerTree.defaultClasses.buttonClass),h(this).removeClass(t.ownerTree.defaultClasses.buttonClass).addClass(l)}).find(":checked").closest("label.btn").addClass(l))}},checkboxes:{template:'<div id="<%= node.id %>"<% if (elt.inline) { %> class="<%= cls.formInlineClass %>"<% } %>><%= choiceshtml %><%= children %></div>',fieldtemplate:!0,inputfield:!0,childTemplate:function(e,t){if(!t.formElement.otherField)return e;var l='<div class="'+(t.formElement.inline?"<%= cls.checkboxWrapInlineClass %>":"<%= cls.checkboxWrapClass %>")+(t.formElement.otherField.inline?" inline-":" ")+'other-field">',s=(t.formElement.otherField.asArrayValue&&t.otherValues&&(l+='<% value = node.parentNode.otherValues.join(", ") %>'),t.key+"["+(void 0!==t.formElement.otherField.idx?t.formElement.otherField.idx:t.formElement.options.length)+"]");return l+='<input class=\'<%= cls.checkboxInputClass %><%= (fieldHtmlClass ? " " + fieldHtmlClass : "") %>\' type="checkbox" id="'+s+'" aria-label="<%= node.title || "Other" %>" <% if ((value !== undefined) && (value !== null) && (value !== "")) {%>checked="checked" <% } else { %><%= (node.isReadOnly() ? "disabled " : "") %><% } %><%= (node.disabled ? "disabled " : "") %>',(t.formElement.otherField.asArrayValue||!0===t.formElement.otherField.novalue)&&!1!==t.formElement.otherField.novalue||(l+=' name="'+s+'" value="'+(t.formElement.optionsAsEnumOrder?1:t.formElement.otherField.otherValue||"OTHER")+'"'),l=l+"/>"+('<label class="<%= cls.checkboxLabelClass %>" for="'+s+'"><%= node.title || "Other" %></label>'),l=t.formElement.otherField.inline?l+'<div class="other-field-content">'+e+"</div></div>":l+'</div><div class="other-field-content">'+e+"</div>"},onBeforeRender:function(e,l){var t,s,i,n,a;l&&l.schemaElement&&((t=l.formElement.options)&&(s='<div class="'+(l.formElement.inline?e.cls.checkboxWrapInlineClass:e.cls.checkboxWrapClass)+"\"><input class='"+e.cls.checkboxInputClass+'<%= (title ? "" : " position-static") %><%= (node.formElement.fieldHtmlClass ? " " + node.formElement.fieldHtmlClass : "") %>\' type="checkbox" id="<%= name %>" value="<%= escape(value) %>" name="<%= name %>" aria-label="<%= title ? escape(title) : name %>" <% if (checked) {%>checked="checked" <% } else { %><%= (node.isReadOnly() ? "disabled " : "") %><% } %><%= (node.disabled ? "disabled" : "") %>/><% if (title) { %><label class="'+e.cls.checkboxLabelClass+'" for="<%= name %>"><%= title || "" %></label><% } %></div>',i="",l.formElement.otherField&&l.formElement.otherField.asArrayValue&&l.value?(n=t.map(function(e){return e.value}),a=[],l.value.forEach(function(e){f.include(n,e)||a.push(e)}),0<a.length&&(l.otherValues=a)):delete l.otherValues,f.each(t,function(e,t){l.formElement.otherField&&e.value===(l.formElement.otherField.otherValue||"OTHER")?l.formElement.otherField.idx=t:i+=f.template(s,o)({name:l.key+"["+t+"]",value:l.formElement.optionsAsEnumOrder?1:e.value,checked:f.include(l.value,e.value),title:e.title,node:l,escape:p})}),l.formElement.otherField,e.choiceshtml=i))},onInsert:function(e,t){var l=t.formElement.otherField&&t.formElement.otherField.inline?h(t.el).find(".inline-other-field :checkbox").first():h(t.el).find(".other-field :checkbox"),s=h(t.el).find(".other-field-content :input");function i(){var t;l.prop("checked",(t=!1,s.each(function(){var e=h(this);return e.is(":checkbox, :radio")&&e.prop("checked")||!e.is("button")&&""!==h(this).val()?!(t=!0):void 0}),t))}s.on("keyup",i).on("change",i).trigger("change"),l.on("change",function(){this.checked?(this.checked=!1,s.not(":checkbox,:radio,button").trigger("focus")):s.filter("input[type=text], textarea").val("")})}},checkboxbuttons:{template:'<div id="<%= node.id %>" class="<%= cls.buttonGroupClass %> btn-group-toggle" data-toggle="buttons"><%= choiceshtml %></div>',fieldtemplate:!0,inputfield:!0,onBeforeRender:function(l,s){var e,i=null,n='<label class="btn <% if (checked) { %>active <%= node.formElement && node.formElement.activeClass ? node.formElement.activeClass : cls.buttonClass %><% } else { %><%= cls.buttonClass %><% } %><%= (node.disabled || node.isReadOnly() ? " disabled" : "") %>"><input type="checkbox" style="position:absolute;left:-9999px;" '+(l.fieldHtmlClass?'class="'+l.fieldHtmlClass+'" ':"")+'<% if (checked) { %> checked="checked" <% } %> name="<%= name %>" value="<%= value %>" <%= (node.disabled ? "disabled" : "") %>/><%= title %></label> ';s&&s.schemaElement&&(e=s.formElement.options)&&(s.value&&Array.isArray(s.value)||(s.value=[]),i="",f.each(e,function(e,t){i+=f.template(n,o)({name:s.key+"["+t+"]",checked:f.include(s.value,e.value),value:e.value,title:e.title,node:s,cls:l.cls})}),l.choiceshtml=i)},onInsert:function(e,t){var l=(t.formElement||{}).activeClass||t.ownerTree.defaultClasses.buttonClass;h(t.el).find("label.btn").on("click",function(){h(this).find("input:checkbox").prop("checked")?(h(this).removeClass(t.ownerTree.defaultClasses.buttonClass),h(this).toggleClass(l,!0)):(h(this).toggleClass(l,!1),h(this).addClass(t.ownerTree.defaultClasses.buttonClass))}).find(":checked").closest("label.btn").addClass(l)}},array:{template:'<div id="<%= id %>"><ul class="_jsonform-array-ul" style="list-style-type:none;"><%= children %></ul><% if (!node.isReadOnly()) { %><span class="_jsonform-array-buttons"><a href="#" class="btn <%= cls.buttonClass %> _jsonform-array-addmore"><i class="<%= cls.iconClassPrefix %>-plus" title="<%= node.formElement.addMoreTooltip ? escape(node.formElement.addMoreTooltip) : \'Add new item\'%>"></i> <%= node.formElement.addMoreTitle || \'\'%></a> </span><% } %></div>',fieldtemplate:!0,array:!0,childTemplate:function(e,t){var l='<span class="_jsonform-array-legend"><%= escape(node.legend) || "" %></span> ';return t.isReadOnly()||(!h("").sortable||u(t.formElement.draggable)&&!t.formElement.draggable||(l+='<span class="draggable line"><i class="<%= cls.iconClassPrefix %>-list" title="Move item"></i></span> '),l+='<a href="#" class="_jsonform-array-item-delete"><i class="<%= cls.iconClassPrefix %>-trash" title="Remove item"></i></a>'),'<li data-idx="<%= node.childPos %>">'+l+e+"</li>"},onInsert:function(e,r){function d(){f.each(r.children,function(e,t){h('> ul._jsonform-array-ul > li[data-idx="'+t+'"] > span._jsonform-array-legend',c).html(p(e.legend||""))});var e=0<=s.minItems&&r.children.length<=s.minItems;c.find(n).toggle(!e)}function l(e){if(0<=s.maxItems){var t=s.maxItems-r.children.length;if(c.find(i).toggleClass("disabled",t<=1),t<1)return}r.insertArrayItem(e,h("> ul",c).get(0)),r.ownerTree.defaultClasses.useTooltip&&v(),d()}var c=h(r.el).find("#"+g(r.id)),s=r.getArrayBoundaries(),i="> span > a._jsonform-array-addmore",n="> ul > li > a._jsonform-array-item-delete";if(c.off("click",i).on("click",i,function(e){var t=r.children.length;e.preventDefault(),e.stopPropagation(),l(t)}),c.off("click",n).on("click",n,function(e){e.preventDefault(),e.stopPropagation();var e=h(e.currentTarget).parent().data("idx"),t=r.children.length-Math.max(s.minItems,0);c.find(n).toggle(1<t),t<1||(r.deleteArrayItem(e),d(),c.find(i).toggleClass("disabled",0<=s.maxItems&&r.children.length>=s.maxItems))}),h(r.el).on("legendUpdated",function(e){d(),e.preventDefault(),e.stopPropagation()}),u(r.formElement.draggable)&&!r.formElement.draggable||!r.isReadOnly()&&h(r.el).sortable&&(h("> ul",c).sortable(),h("> ul",c).on("sortstop",function(e,t){var l=h(t.item).data("idx"),t=h(t.item).index(),s=t;if(l!==s){for(var i=l<s?1:-1,n=0,a=h("> ul",c),n=l;n!==s;n+=i)r.children[n].switchValuesWith(r.children[n+i]),r.children[n].render(a.get(0)),r.children[n+i].render(a.get(0));var t=h(r.children[l].el),o=h(r.children[s].el);t.detach(),o.detach(),l<s?(0===l?a.prepend(t):h(r.children[l-1].el).after(t),h(r.children[s-1].el).after(o)):(0===s?a.prepend(o):h(r.children[s-1].el).after(o),h(r.children[l-1].el).after(t))}d()})),0<=s.minItems)for(var t=r.children.length;t<s.minItems;t++)l(r.children.length);d(),c.find(i).toggleClass("disabled",0<=s.maxItems&&r.children.length>=s.maxItems);var a=0<=s.minItems&&r.children.length<=s.minItems;c.find(n).toggle(!a)}},tabarray:{template:'<div id="<%= id %>"><div class="jsonform-tabbable"><ul class="nav <%= cls.navTabsClass %>"><%= tabs %></ul><div style="clear: both;"></div><div class="tab-content"><%= children %></div></div></div>',fieldtemplate:!0,array:!0,childTemplate:function(e){return'<div data-idx="<%= node.childPos %>" class="tab-pane">'+e+"</div>"},onBeforeRender:function(e,t){e.tabs=""},onInsert:function(e,o){function r(e){var l="",t=!1,s=((e=void 0===e?(e=h("> .jsonform-tabbable > ul.nav .active",d).data("idx"))?parseInt(e,10):(t=!0,0):e)>=o.children.length&&(e=o.children.length-1),f.each(o.children,function(e,t){h('> .jsonform-tabbable > .tab-content > [data-idx="'+t+'"] > fieldset > legend',d).html(e.legend);e=e.legend||e.title||"Item "+(t+1);l+='<li class="tabwrap '+o.ownerTree.defaultClasses.navItemClass+'" data-idx="'+t+'"><a class="draggable tab '+o.ownerTree.defaultClasses.navLinkClass+'" data-toggle="tab" rel="'+escape(e)+'">'+p(e),o.isReadOnly()||(l+=' <span href="#" class="_jsonform-array-item-delete"><i class="'+o.ownerTree.defaultClasses.iconClassPrefix+'-trash" title="Remove item"></i></span></a>'),l+="</li>"}),!o.isReadOnly()&&(i.maxItems<0||o.children.length<i.maxItems)&&(l+='<li class="tabwrap '+o.ownerTree.defaultClasses.navItemClass+'" data-idx="-1"><a class="tab '+o.ownerTree.defaultClasses.navLinkClass+' _jsonform-array-addmore" title="'+(o.formElement.addMoreTooltip?p(o.formElement.addMoreTooltip):"Add new item")+'"><i class="'+o.ownerTree.defaultClasses.iconClassPrefix+'-plus"></i> '+(o.formElement.addMoreTitle||"New")+"</a></li>"),h("> .jsonform-tabbable > ul.nav",d).html(l),0<=i.minItems&&o.children.length<=i.minItems);d.find(n).toggle(!s),t&&h('> .jsonform-tabbable > ul.nav [data-idx="0"]',d).addClass("active").find("> a").addClass("active"),h('> .jsonform-tabbable > ul.nav [data-toggle="tab"]',d).eq(e).trigger("click")}function l(e){if(0<=i.maxItems){var t=i.maxItems-o.children.length;if(d.find(s).toggleClass("disabled",t<=1),t<1)return}o.insertArrayItem(e,d.find("> .jsonform-tabbable > .tab-content").get(0)),o.ownerTree.defaultClasses.useTooltip&&v(),r(e)}var d=h(o.el).find("#"+g(o.id)),i=o.getArrayBoundaries(),s="> .jsonform-tabbable > ul.nav > li > ._jsonform-array-addmore",n="> .jsonform-tabbable > ul.nav > li > a > ._jsonform-array-item-delete";if(d.off("click",s).on("click",s,function(e){var t=o.children.length;e.preventDefault(),e.stopPropagation(),l(t)}),d.off("click",n).on("click",n,function(e){e.preventDefault(),e.stopPropagation();var e=h(e.currentTarget).closest("li").data("idx"),t=o.children.length-Math.max(i.minItems,0);d.find(n).toggle(1<t),t<1||(o.deleteArrayItem(e),r(),d.find(s).toggleClass("disabled",0<=i.maxItems&&o.children.length>=i.maxItems))}),h(o.el).on("legendUpdated",function(e){r(),e.preventDefault(),e.stopPropagation()}),u(o.formElement.draggable)&&!o.formElement.draggable||!o.isReadOnly()&&h(o.el).sortable&&h("> .jsonform-tabbable > ul.nav",d).sortable({containment:o.el,cancel:"._jsonform-array-addmore",tolerance:"pointer"}).on("sortchange",function(e,t){t.placeholder.index()==h(this).children().length-1&&-1==t.placeholder.prev().data("idx")&&t.placeholder.prev().before(t.placeholder)}).on("sortstop",function(e,t){var l=h(t.item).data("idx"),t=h(t.item).index(),s=t;if(l!==s)for(var i=l<s?1:-1,n=0,a=h("> .jsonform-tabbable > .tab-content",d).get(0),n=l;n!==s;n+=i)o.children[n].switchValuesWith(o.children[n+i]),o.children[n].render(a),o.children[n+i].render(a);r(t)}),0<=i.minItems)for(var t=o.children.length;t<i.minItems;t++)l(o.children.length);r(),d.find(s).toggleClass("disabled",0<=i.maxItems&&o.children.length>=i.maxItems);var a=0<=i.minItems&&o.children.length<=i.minItems;d.find(n).toggle(!a)}},help:{template:'<small <%= id ? \'id="\' + id + \'"\' : "" %> class="<%= cls.helpClass %>" style="padding-top:5px"><%= node.helpvalue || elt.helpvalue %></small>',fieldtemplate:!0},null:{template:'<input type="hidden" id="<%= id %>" name="<%= node.name %>" value="null" <%= (node.disabled? " disabled" : "")%> />',inputfield:!0,fieldtemplate:!0},msg:{template:"<%= elt.msg %>"},html:{template:"<%= elt.html %>"},textview:{template:'<pre id="<%= id %>" name="<%= node.name %>"><%= value %></pre>',inputfield:!0,fieldtemplate:!0},fieldset:{template:'<fieldset class="jsonform-node jsonform-error-<%= keydash %> <% if (elt.expandable) { %>expandable<% } %> <%= elt.htmlClass?elt.htmlClass:"" %>" <% if (id) { %> id="<%= id %>"<% } %> data-jsonform-type="fieldset"<%= (node.disabled ? " disabled" : "") %>><% if (node.title || node.legend) { %><legend class="<%= cls.legendClass %>" role="treeitem" aria-expanded="false"><%= node.title || node.legend %><% if (node.description && (elt.useTooltip === true || (elt.useTooltip === undefined && cls.useTooltip))) { %><span data-toggle="tooltip" data-placement="right" title="<%= node.description %>" class="<%= cls.tooltipClass %> jsonform-description-tooltip"><i class="<%= cls.iconClassPrefix %>-<%= cls.tooltipIconSuffix %>"></i></span><% } %></legend><% } %><% if (node.description && !(elt.useTooltip === true || (elt.useTooltip === undefined && cls.useTooltip))) { %><small class="<%= cls.helpClass %> jsonform-description"><%= node.description %></small><% } %><% if (elt.expandable) { %><div class="<%= cls.formsGroupClass %>"><% } %><%= children %><% if (elt.expandable) { %></div><% } %><small class="<%= cls.errorTextClass %> jsonform-errortext" style="display:none;"></small></fieldset>',onInsert:function(e,t){null!==t.el&&(h(".expandable > div, .expandable > fieldset",t.el).hide(),h(".expandable",t.el).removeClass("expanded"))}},advancedfieldset:{template:'<fieldset class="jsonform-node jsonform-error-<%= keydash %> <% if (elt.expandable !== false) { %>expandable<% } %> <%= elt.htmlClass?elt.htmlClass:"" %>"<% if (id) { %> id="<%= id %>"<% } %> data-jsonform-type="advancedfieldset"<%= (node.disabled ? " disabled" : "") %>><legend class="<%= cls.legendClass %>" role="treeitem" aria-expanded="false"><%= (node.title || node.legend) ? (node.title || node.legend) : "Advanced options" %></legend><% if (elt.expandable !== false) { %><div class="<%= cls.formsGroupClass %>"><% } %><%= children %><% if (elt.expandable !== false) { %></div><% } %><small class="<%= cls.errorTextClass %> jsonform-errortext" style="display:none;"></small></fieldset>',onInsert:function(e,t){null!==t.el&&(h(".expandable > div, .expandable > fieldset",t.el).hide(),h(".expandable",t.el).removeClass("expanded"))}},authfieldset:{template:'<fieldset class="jsonform-node jsonform-error-<%= keydash %> <% if (elt.expandable !== false) { %>expandable<% } %> <%= elt.htmlClass?elt.htmlClass:"" %>"<% if (id) { %> id="<%= id %>"<% } %> data-jsonform-type="authfieldset"<%= (node.disabled ? " disabled" : "") %>><legend class="<%= cls.legendClass %>" role="treeitem" aria-expanded="false"><%= (node.title || node.legend) ? (node.title || node.legend) : "Authentication settings" %></legend><% if (elt.expandable !== false) { %><div class="<%= cls.formsGroupClass %>"><% } %><%= children %><% if (elt.expandable !== false) { %></div><% } %><small class="<%= cls.errorTextClass %> jsonform-errortext" style="display:none;"></small></fieldset>',onInsert:function(e,t){null!==t.el&&(h(".expandable > div, .expandable > fieldset",t.el).hide(),h(".expandable",t.el).removeClass("expanded"))}},submit:{template:'<input type="submit" <% if (id) { %> id="<%= id %>" <% } %> class="btn <%= cls.submitButtonClass %> <%= elt.htmlClass?elt.htmlClass:"" %>" value="<%= value || node.title %>"<%= (node.disabled? " disabled" : "")%>/>'},reset:{template:'<input type="reset" <% if (id) { %> id="<%= id %>" <% } %> class="btn <%= cls.resetButtonClass %> <%= elt.htmlClass?elt.htmlClass:"" %>" value="<%= value || node.title %>"<%= (node.disabled? " disabled" : "")%>/>'},button:{template:'<button type="button" <% if (id) { %> id="<%= id %>" <% } %> class="btn <%= cls.buttonClass %> <%= elt.htmlClass?elt.htmlClass:"" %>"><%= node.title %></button>'},actions:{template:'<div class="<%= cls.actionsClass %> <%= elt.htmlClass?elt.htmlClass:"" %>"><%= children %></div>'},hidden:{template:'<input type="hidden" id="<%= id %>" name="<%= node.name %>" value="<%= escape(value) %>" <%= (node.disabled? " disabled" : "")%> />',inputfield:!0},tabs:{template:'<ul class="nav <%= cls.navTabsClass %> <%= elt.htmlClass?elt.htmlClass:"" %>"<% if (elt.id) { %> id="<%= elt.id %>"<% } %>><%=tab_list%></ul><div style="clear: both;"></div><div class="tab-content" <% if (elt.id) { %> data-tabset="<%= elt.id %>"<% } %>><%=children%></div>',getElement:function(e){return h(e).parent().get(0)},onBeforeRender:function(e,i){var n=p(i.id?i.id+"-":""),a="";return f.each(i.children,function(e,t){var l=p(e.title||"Item "+(t+1)),s=l.replace(" ","_");a+='<li class="tabwrap '+i.ownerTree.defaultClasses.navItemClass+(0===t?" active":"")+'"><a href="#'+n+s+'" class="tab '+i.ownerTree.defaultClasses.navLinkClass+(0===t?" active":"")+'" data-tab="'+n+s+'" data-toggle="tab">'+l+(e.formElement&&e.formElement.addIcon?'<i class="'+i.ownerTree.defaultClasses.iconClassPrefix+"-"+e.formElement.addIcon+'"></i>':"")+"</a></li>"}),e.tab_list=a,e},onInsert:function(e,t){h("#"+t.id+">li.tabwrap").on("click",function(e){e.preventDefault(),h(t.el).find("div[data-tabset='"+t.id+"']>div.tab-pane.active").each(function(){h(this).removeClass("active")});e=h(this).find("a").attr("data-tab");h("#"+e).addClass("active")})}},tab:{template:'<div class="tab-pane<% if (elt.htmlClass) { %> <%= elt.htmlClass %> <% } %><% if (node.childPos === 0) { %> active<% } %>" id="<%= tabId %>"><%= children %></div>',onBeforeRender:function(e,t){return e.tabId=p(t.parentNode.id?t.parentNode.id+"-":"")+p(t.title||"Item "+(t.childPos+1)).replace(" ","_"),e}},selectfieldset:{template:'<fieldset class="tab-container <%= elt.htmlClass?elt.htmlClass:"" %>"<%= (node.disabled ? " disabled" : "") %>><% if (node.legend) { %><legend class="<%= cls.legendClass %>" role="treeitem" aria-expanded="false"><%= node.legend %></legend><% } %><% if (node.formElement.key) { %><input type="hidden" id="<%= node.id %>" name="<%= node.name %>" value="<%= escape(value) %>" /><% } else { %><a id="<%= node.id %>"></a><% } %><div class="jsonform-tabbable"><div class="<%= cls.formClass %><%= node.formElement.hideMenu ? " hide" : "" %><%= (node.isReadOnly() ? " " + cls.formReadonlyClass : "") %><%= (node.disabled ? " " + cls.formDisabledClass : "") %>"><% if (!elt.notitle) { %><label class="<%= cls.labelClass %>" for="<%= node.id %>"><%= node.getTitle() %></label><% } %><div<% if (cls.controlClass) { %> class="<%= cls.controlClass %>"<% } %>><%= tabs %></div></div><div class="tab-content"><%= children %></div></div></fieldset>',inputfield:!0,getElement:function(e){return h(e).parent().get(0)},childTemplate:function(e){return'<div data-idx="<%= node.childPos %>" class="tab-pane<% if (node.active) { %> active<% } %>">'+e+"</div>"},onBeforeRender:function(e,s){var t=null,i=[],l=(s.schemaElement&&(i=s.schemaElement.enum||[]),t=s.options?f.map(s.options,function(e,t){var l=s.children[t];return l.childPos=t,e instanceof Object?((e=f.extend({node:l},e)).title=e.title||l.legend||l.title||"Option "+(l.childPos+1),e.value=u(e.value)?e.value:u(i[t])?i[t]:t,e):{title:e,value:u(i[l.childPos])?i[l.childPos]:l.childPos,node:l}}):f.map(s.children,function(e,t){return e.childPos=t,{title:e.legend||e.title||"Option "+(e.childPos+1),value:i[e.childPos]||e.value||e.childPos,node:e}}),f.each(t,function(e,t){e.node.active=!1}),null),n=((l=(l=(l=void 0!==e.value?f.find(t,function(e){return e.value==s.value}):l)||f.find(t,function(e){return e.node.hasNonDefaultValue()}))||t[0]).node.active=!0,e.value=l.value,s.formElement,"");return e.cls.selectWrapClass&&(n+='<div class="'+e.cls.selectWrapClass+'">'),n+='<select class="nav '+e.cls.textualInputClass+'"'+(s.disabled?" disabled":"")+">",f.each(t,function(e,t){n+='<option data-idx="'+t+'" value="'+e.value+'"'+(e.node.active?' selected="selected" class="active"':"")+">"+p(e.title)+"</option>"}),n+="</select>",e.cls.selectWrapClass&&(n+="</div>"),e.tabs=n,e},onInsert:function(e,l){h(l.el).find("select.nav").first().on("change",function(e){var t=h(this).find("option:selected");h(l.el).find('input[type="hidden"]').first().val(t.attr("value"))})}},optionfieldset:{template:'<div<% if (node.id) { %> id="<%= node.id %>"<% } %>><%= children %></div>'},section:{template:'<div<% if (node.id) { %> id="<%= node.id %>"<% } %> class="jsonform-node jsonform-error-<%= keydash %> <%= elt.htmlClass?elt.htmlClass:"" %>"><%= children %></div>'},questions:{template:'<div><input type="hidden" id="<%= node.id %>" name="<%= node.name %>" value="<%= escape(value) %>" /><%= children %></div>',fieldtemplate:!0,inputfield:!0,getElement:function(e){return h(e).parent().get(0)},onInsert:function(e,t){t.children&&0!==t.children.length&&(f.each(t.children,function(e){h(e.el).hide()}),h(t.children[0].el).show())}},question:{template:'<div id="<%= node.id %>"<% if (elt.optionsType === "radiobuttons") { %> class="<%= cls.buttonGroupClass %> btn-group-toggle" data-toggle="buttons"<% } %><% if (elt.inline) { %> class="<%= cls.formInlineClass %>"<% } %>><% _.each(node.options, function(key, val) { %><% if (elt.optionsType === "radiobuttons") { %><label class="btn <%= cls.buttonClass %><%= ((key instanceof Object && key.htmlClass) ? " " + key.htmlClass : "") %><%= (node.disabled || node.isReadOnly() ? " disabled" : "") %>"><input type="radio" style="position:absolute;left:-9999px;" name="<%= node.id %>" value="<%= val %>" <%= (node.disabled ? "disabled" : "") %>/><%= (key instanceof Object ? key.title : key) %></label> <% } else { %><div class="<% if (elt.inline) { %><%= cls.radioWrapInlineClass %><% } else { %><%= cls.radioWrapClass %><% } %>"><input class=\'<%= cls.radioInputClass %><%= ((key instanceof Object && key.htmlClass) ? " " + key.htmlClass : "") %>\' type="radio" id="<%= node.id %>_<%= escape(val) %>" value="<%= val %>" name="<%= node.id %>" <%= (node.disabled || node.isReadOnly() ? "disabled" : "") %>/><label class="<%= cls.radioLabelClass %>" for="<%= node.id %>_<%= escape(val) %>"><%= (key instanceof Object ? key.title : key) %></label></div><% } %><% }); %></div>',fieldtemplate:!0,onInsert:function(e,s){var i="active",t=s.formElement||{};t.activeClass?i+=" "+t.activeClass:"radiobuttons"===t.optionsType&&(i+=" "+s.ownerTree.defaultClasses.buttonClass),h(s.el).find('input[type="radio"]').on("change",function(e){var t,l=s.options[h(this).val()];s.parentNode&&s.parentNode.el&&(h(s.el).find("label").removeClass(i),h(s.el).find("label.btn").addClass(s.ownerTree.defaultClasses.buttonClass),h(this).closest("label.btn").removeClass(s.ownerTree.defaultClasses.buttonClass),h(this).closest("label").addClass(i),h(this).siblings("label").addClass(i),h(s.el).nextAll().hide(),h(s.el).nextAll().find('input[type="radio"]').prop("checked",!1),l.value&&h(s.parentNode.el).find('input[type="hidden"]').val(l.value),l.next&&(t=f.find(s.parentNode.children,function(e){return e.formElement&&e.formElement.qid===l.next}),h(t.el).show(),h(t.el).nextAll().hide(),h(t.el).nextAll().find('input[type="radio"]').prop("checked",!1)),l.href&&(l.target?window.open(l.href,l.target):window.location=l.href),l.submit&&setTimeout(function(){s.ownerTree.submit()},0))})}}},E.util.getObjKey=function(e,t,l){for(var s=e,i=t.split("."),n=null,a=null,o=null,r=0;r<i.length;r++){if(null===s||"object"!=typeof s)return null;if(o=(n=i[r]).replace(x,""),x.lastIndex=0,a=x.exec(n))for(;;){if(o&&!f.isArray(s[o]))return null;if(s=(o?s[o]:s)[parseInt(a[1])],!(a=x.exec(n)))break;o=null}else s=(l&&!s[o]&&f.isArray(s)&&s[0]?s[0]:s)[o]}return l&&f.isArray(s)&&s[0]?s[0]:s},E.util.getObjKeyEx=function(e,t,l){var s=e;if(null==t||""===t)return e;if("string"==typeof l&&0<l.length){if(t.slice(0,l.length)!==l)throw new Error("key ["+t+"] does not match the objKey ["+l+"]");"."===(t=t.slice(l.length))[0]&&(t=t.slice(1))}e=t.match(/^((([^\\\[.]|\\.)+)|\[(\d+)\])\.?(.*)$/);if(!e)throw new Error("bad format key: "+t);if("string"==typeof e[2]&&0<e[2].length)s=s[e[2]];else{if(!("string"==typeof e[4]&&0<e[4].length))throw new Error("impossible reach here");s=s[Number(e[4])]}return s=s&&0<e[5].length?this.getObjKeyEx(s,e[5]):s},E.util.setObjKey=function(e,t,l){for(var s=e,i=t.split("."),n=null,a=null,o=null,r=0;r<i.length-1;r++)if(o=(n=i[r]).replace(x,""),x.lastIndex=0,a=x.exec(n)){for(;;)if(f.isArray(s[o])||(s[o]=[]),s=s[o],o=parseInt(a[1],10),!(a=x.exec(n)))break;"object"==typeof s[o]&&null!==s[o]||(s[o]={}),s=s[o]}else"object"==typeof s[o]&&null!==s[o]||(s[o]={}),s=s[o];if(o=(n=i[i.length-1]).replace(x,""),x.lastIndex=0,a=x.exec(n)){for(;;)if(f.isArray(s[o])||(s[o]=[]),s=s[o],o=parseInt(a[1],10),!(a=x.exec(n)))break;s[o]=l}else s[o]=l},C.prototype.clone=function(e){var t=new C;return t.childPos=this.childPos,t.arrayPath=f.clone(this.arrayPath),t.ownerTree=this.ownerTree,t.parentNode=e||this.parentNode,t.formElement=this.formElement,t.schemaElement=this.schemaElement,t.view=this.view,t.children=f.map(this.children,function(e){return e.clone(t)}),t},C.prototype.hasNonDefaultValue=function(){return(!this.formElement||"hidden"!=this.formElement.type)&&(!(!this.value||this.defaultValue)||!!f.find(this.children,function(e){return e.hasNonDefaultValue()}))},C.prototype.getProperty=function(e,t){var l=this[e];return void 0===l&&t&&this.parentNode?this.parentNode.getProperty(e,!0):l},C.prototype.isReadOnly=function(){return this.getProperty("readOnly",!0)},C.prototype.getTitle=function(){var e=this.name;return this.title?e=this.title:this.name===this.key&&this.parentNode&&this.parentNode.key&&(e=e.substring(this.parentNode.key.length),this.parentNode.schemaElement&&this.parentNode.schemaElement.type&&("object"===this.parentNode.schemaElement.type?e=e.substring(1):"array"===this.parentNode.schemaElement.type&&(e=e.replace(/[\[\]']+/g,"")))),e},C.prototype.appendChild=function(e){return e.parentNode=this,e.childPos=this.children.length,this.children.push(e),e},C.prototype.removeChild=function(){var e=this.children[this.children.length-1];if(e)return h(e.el).remove(),this.children.pop()},C.prototype.moveValuesTo=function(e){var t=this.getFormValues(e.arrayPath);e.resetValues(),e.computeInitialValues(t,!0)},C.prototype.switchValuesWith=function(e){var t=this.getFormValues(e.arrayPath),l=e.getFormValues(this.arrayPath);e.resetValues(),e.computeInitialValues(t,!0),this.resetValues(),this.computeInitialValues(l,!0)},C.prototype.resetValues=function(){var e;if(this.value=null,this.parentNode?(this.arrayPath=f.clone(this.parentNode.arrayPath),this.parentNode.view&&this.parentNode.view.array&&this.arrayPath.push(this.childPos)):this.arrayPath=[],this.view&&this.view.inputfield)e=h(":input",this.el).serializeArray(),f.each(e,function(e){h('[name="'+g(e.name)+'"]',h(this.el)).val("")},this);else if(this.view&&this.view.array)for(;0<this.children.length;)this.removeChild();f.each(this.children,function(e){e.resetValues()})},C.prototype.setChildTemplate=function(e){(this.childTemplate=e).parentNode=this},C.prototype.getChildTemplate=function(){return this.childTemplate||this.view.array&&(key=this.formElement.items?this.formElement.items[0]||this.formElement.items:this.formElement.key+"[]",f.isString(key)&&(key={key:key}),this.setChildTemplate(this.ownerTree.buildFromLayout(key))),this.childTemplate},C.prototype.computeInitialValues=function(i,t,l){var n=this,e=null,s=1,a=0,o=this.ownerTree.formDesc.tpldata||{};if(l=l||0,this.parentNode?(this.arrayPath=f.clone(this.parentNode.arrayPath),this.parentNode.view&&this.parentNode.view.array&&this.arrayPath.push(this.childPos)):this.arrayPath=[],o.idx=0<this.arrayPath.length?this.arrayPath[this.arrayPath.length-1]+1:this.childPos+1,o.value="",o.getValue=function(e){if(!i)return"";for(var t=i,l=e.split("[]."),s=0;s<l.length-1;s++)t=t[l[s]][n.arrayPath[s]];return t[l[s]]},this.formElement&&(this.formElement.id?this.id=b(this.formElement.id,this.arrayPath):(this.view&&this.view.array||this.parentNode&&this.parentNode.view&&this.parentNode.view.array||"button"===this.formElement.type||"selectfieldset"===this.formElement.type||"question"===this.formElement.type||"buttonquestion"===this.formElement.type)&&(this.id=g(this.ownerTree.formDesc.prefix)+"-elt-counter-"+f.uniqueId()),this.formElement.key&&(this.key=b(this.formElement.key,this.arrayPath),this.keydash=d(this.key.replace(/\./g,"---"))),this.name=b(this.formElement.name,this.arrayPath),f.each(["title","legend","description","append","prepend","inlinetitle","helpvalue","value","disabled","required","placeholder","readOnly"],function(e){f.isString(this.formElement[e])?(-1!==this.formElement[e].indexOf("{{values.")?this[e]=this.formElement[e].replace(/\{\{values\.([^\}]+)\}\}/g,'{{getValue("$1")}}'):this[e]=b(this.formElement[e],this.arrayPath),this[e]&&(this[e]=f.template(this[e],w)(o))):this[e]=this.formElement[e]},this),this.formElement.options&&(this.options=f.map(this.formElement.options,function(e){var t=null;return f.isObject(e)&&e.title?(t=-1!==e.title.indexOf("{{values.")?e.title.replace(/\{\{values\.([^\}]+)\}\}/g,'{{getValue("$1")}}'):b(e.title,n.arrayPath),f.extend({},e,{value:u(e.value)?e.value:"",title:f.template(t,w)(o)})):e}))),this.view&&this.view.inputfield&&this.schemaElement)i?u(E.util.getObjKey(i,this.key))?this.value=E.util.getObjKey(i,this.key):u(this.schemaElement.default)&&(this.value=this.schemaElement.default,"string"==typeof this.value&&(this.value=f.template(this.value,w)(o))):t||u(this.value)||(r=y(n.ownerTree.formDesc.schema,this.key,l),u(r)&&(this.value=r,f.isString(this.value)&&(-1!==this.value.indexOf("{{values.")?this.value=this.value.replace(/\{\{values\.([^\}]+)\}\}/g,'{{getValue("$1")}}'):this.value=b(this.value,this.arrayPath,!0),this.value&&(this.value=f.template(this.value,w)(o))),this.defaultValue=!0));else if(this.view&&this.view.array){var r,s=0;for(i?(r=E.util.getObjKeyEx(i,this.key))&&Array.isArray(r)?s=r.length:f.isEmpty(r)||(s=this.getPreviousNumberOfItems(i,this.arrayPath)):t||(r=y(n.ownerTree.formDesc.schema,this.key,l))&&Array.isArray(r)&&(s=r.length),a=0;a<s;a++)this.appendChild(this.getChildTemplate().clone())}if(f.each(this.children,function(e){e.computeInitialValues(i,t,l)}),this.formElement&&this.formElement.valueInLegend)for(e=this;e;){if(e.parentNode&&e.parentNode.view&&e.parentNode.view.array&&(e.legendChild=this,e.formElement&&e.formElement.legend)){e.legend=b(e.formElement.legend,e.arrayPath),o.idx=0<e.arrayPath.length?e.arrayPath[e.arrayPath.length-1]+1:e.childPos+1,o.value=u(this.value)?this.value:"",e.legend=f.template(e.legend,w)(o);break}e=e.parentNode}},C.prototype.getPreviousNumberOfItems=function(t,l){var e,s=null;return t?this.view.inputfield&&this.schemaElement?(e=function(e,t){var l=0,s=0;if(!e)return null;if(0<t)for(;l<t;){if(-1===(s=e.indexOf("[]",s)))return e;s+=2,l+=1}return-1===(s=e.indexOf("[]",s))?e:e.substring(0,s)}(this.formElement.key,l.length),e=b(e,l),(e=E.util.getObjKey(t,e))?(s=f.map(this.children,function(e){return e.getPreviousNumberOfItems(t,l)}),f.max([f.max(s)||0,e.length])):0):this.view.array?this.getChildTemplate().getPreviousNumberOfItems(t,l):(s=f.map(this.children,function(e){return e.getPreviousNumberOfItems(t,l)}),f.max(s)||0):0},C.prototype.getFormValues=function(t){var e={};if(!this.el)throw new Error("formNode.getFormValues can only be called on nodes that are associated with a DOM element in the tree");var l=h(":input",this.el).serializeArray();l=(l=l.concat(h(":input[type=checkbox]:not(:disabled):not(:checked)[name]",this.el).map(function(){return{name:this.name,value:this.checked}}).get())).concat(h(':input[type=checkbox]:disabled[name][readonly="readonly"]',this.el).map(function(){return{name:this.name,value:this.checked}}).get()),t&&f.each(l,function(e){e.name=b(e.name,t)});for(var s=this.ownerTree.formDesc.schema,i=0;i<l.length;i++){var n,a,o=l[i].name,r=c(s.properties,o),d=null;if(r)if(r._jsonform_checkboxes_as_array&&(n=o.match(/\[([0-9]*)\]$/)))o=o.replace(/\[([0-9]*)\]$/,""),d=E.util.getObjKey(e,o)||[],"value"===r._jsonform_checkboxes_as_array&&!1!==l[i].value&&""!==l[i].value?d.push(l[i].value):!0===r._jsonform_checkboxes_as_array&&"1"===l[i].value&&d.push(r.enum[parseInt(n[1],10)]),E.util.setObjKey(e,o,d);else if("tagsinput"===r._jsonform_get_value_by_tagsinput)a=t?(n=b(o,this.arrayPath),h(':input[name="'+n+'"]',this.el).tagsinput("items")):h(':input[name="'+o+'"]',this.el).tagsinput("items"),E.util.setObjKey(e,o,a);else if("[]"===o.slice(-2)&&(o=o.slice(0,-2),"array"===(r=c(s.properties,o)).type))(d=E.util.getObjKey(e,o)||[]).push(l[i].value),E.util.setObjKey(e,o,d);else{if("boolean"===r.type&&("0"===l[i].value||"false"===l[i].value?l[i].value=!1:""===l[i].value?l[i].value=null:l[i].value=!!l[i].value),"number"!==r.type&&"integer"!==r.type||f.isString(l[i].value)&&(l[i].value.length?isNaN(Number(l[i].value))||(l[i].value=Number(l[i].value)):l[i].value=null),"string"!==r.type||""!==l[i].value||r._jsonform_allowEmpty||(l[i].value=null),"object"===r.type&&f.isString(l[i].value)&&"{"===l[i].value.substring(0,1))try{l[i].value=m.parse(l[i].value)}catch(e){l[i].value={}}if("array"===r.type&&f.isString(l[i].value))if("["===l[i].value.substring(0,1))try{l[i].value=m.parse(l[i].value)}catch(e){l[i].value=[]}else l[i].value=null;"null"===r.type&&"null"===l[i].value&&(l[i].value=null),"object"!==r.type||"null"!==l[i].value&&""!==l[i].value||(l[i].value=null),l[i].name&&(null!==l[i].value||"null"===r.type&&null===l[i].value)&&E.util.setObjKey(e,l[i].name,l[i].value)}}return e},C.prototype.render=function(e){var t=this.generate();this.setContent(t,e),this.enhance()},C.prototype.setContent=function(e,t){var l,e=h(e),t=t||(this.parentNode?this.parentNode.el:this.ownerTree.domRoot);this.el?h(this.el).replaceWith(e):(l=h(t).children().get(this.childPos))?h(l).before(e):h(t).append(e),this.el=e,this.updateElement(this.el)},C.prototype.updateElement=function(e){this.id&&(this.el=h("#"+g(this.id),e).get(0),this.view&&this.view.getElement&&(this.el=this.view.getElement(this.el)),!1!==this.fieldtemplate&&this.view&&this.view.fieldtemplate&&(this.el=h(this.el).parent().parent(),(this.prepend||this.append)&&(this.el=this.el.parent()),this.el=this.el.get(0)),this.parentNode&&this.parentNode.view&&this.parentNode.view.childTemplate&&(this.el=h(this.el).parent().get(0)));for(const t in this.children)0!=this.children.hasOwnProperty(t)&&this.children[t].updateElement(this.el||e)},C.prototype.generate=function(){var e={id:this.id,keydash:this.keydash,elt:this.formElement,schema:this.schemaElement,node:this,value:u(this.value)?this.value:"",cls:this.ownerTree.defaultClasses,escape:p},t=null,l=(this.ownerTree.formDesc.onBeforeRender&&this.ownerTree.formDesc.onBeforeRender(e,this),this.view.onBeforeRender&&this.view.onBeforeRender(e,this),t=this.template||(this.formElement&&this.formElement.template?this.formElement:this.view).template,!1!==this.fieldtemplate&&(this.fieldtemplate||this.view.fieldtemplate)&&(t=E.fieldTemplate(t)),this.parentNode&&this.parentNode.view&&this.parentNode.view.childTemplate&&(t=this.parentNode.view.childTemplate(t,this.parentNode)),"");return f.each(this.children,function(e){l+=e.generate()}),e.children=l,e.fieldHtmlClass="",this.ownerTree&&this.ownerTree.formDesc&&this.ownerTree.formDesc.params&&this.ownerTree.formDesc.params.fieldHtmlClass&&(e.fieldHtmlClass=this.ownerTree.formDesc.params.fieldHtmlClass),this.formElement&&void 0!==this.formElement.fieldHtmlClass&&(e.fieldHtmlClass=this.formElement.fieldHtmlClass),f.template(t,o)(e)},C.prototype.enhance=function(){var e,l=this,t=null,s=f.clone(this.ownerTree.formDesc.tpldata)||{};this.formElement&&(this.view.onInsert&&this.view.onInsert({target:h(this.el)},this),e=this.handlers||this.formElement.handlers,(t=this.onInsert||this.formElement.onInsert)&&t({target:h(this.el)},this),e&&f.each(e,function(e,t){"insert"===t&&e({target:h(this.el)},this)},this),this.el&&(this.onChange&&h(this.el).on("change",function(e){l.onChange(e,l)}),this.view.onChange&&h(this.el).on("change",function(e){l.view.onChange(e,l)}),this.formElement.onChange&&h(this.el).on("change",function(e){l.formElement.onChange(e,l)}),this.onInput&&h(this.el).on("input",function(e){l.onInput(e,l)}),this.view.onInput&&h(this.el).on("input",function(e){l.view.onInput(e,l)}),this.formElement.onInput&&h(this.el).on("input",function(e){l.formElement.onInput(e,l)}),this.onClick&&h(this.el).on("click",function(e){l.onClick(e,l)}),this.view.onClick&&h(this.el).on("click",function(e){l.view.onClick(e,l)}),this.formElement.onClick&&h(this.el).on("click",function(e){l.formElement.onClick(e,l)}),this.onKeyUp&&h(this.el).on("keyup",function(e){l.onKeyUp(e,l)}),this.view.onKeyUp&&h(this.el).on("keyup",function(e){l.view.onKeyUp(e,l)}),this.formElement.onKeyUp&&h(this.el).on("keyup",function(e){l.formElement.onKeyUp(e,l)}),e&&f.each(e,function(t,e){"insert"!==e&&h(this.el).on(e,function(e){t(e,l)})},this)),this.formElement.legend&&this.legendChild&&this.legendChild.formElement&&(t=function(e){l.formElement&&l.formElement.legend&&l.parentNode&&(l.legend=b(l.formElement.legend,l.arrayPath),s.idx=0<l.arrayPath.length?l.arrayPath[l.arrayPath.length-1]+1:l.childPos+1,s.value=h(e.target).val(),l.legend=f.template(l.legend,w)(s),h(l.parentNode.el).trigger("legendUpdated"))},h(this.legendChild.el).on("change",t),h(this.legendChild.el).on("keyup",t))),f.each(this.children,function(e){e.enhance()})},C.prototype.insertArrayItem=function(e,t){var l=0,s=(void 0===e&&(e=this.children.length),this.getChildTemplate().clone());for(this.appendChild(s),s.resetValues(),l=this.children.length-2;e<=l;l--)this.children[l].moveValuesTo(this.children[l+1]);for(this.children[e].resetValues(),this.children[e].computeInitialValues(null,!1,this.children[e].arrayPath.length),l=e;l<this.children.length;l++)this.children[l].render(t)},C.prototype.deleteArrayItem=function(e){for(var t=0,t=e=void 0===e?this.children.length-1:e;t<this.children.length-1;t++)this.children[t+1].moveValuesTo(this.children[t]),this.children[t].render();this.removeChild()},C.prototype.getArrayBoundaries=function(){if(!this.view||!this.view.array)return{minItems:-1,maxItems:-1};function i(e,t){var l=null,s={minItems:-1,maxItems:-1};return t=t||e,e.view&&e.view.array&&e!==t?s:e.key?(l=e.key.replace(/\[[0-9]+\]/g,"[]"),e!==t&&(l=l.replace(/\[\][^\[\]]*$/,"")),(l=c(e.ownerTree.formDesc.schema.properties,l))&&(0<=l.minItems&&(s.minItems=l.minItems),0<=l.minLength&&(s.minItems=l.minLength),0<=l.maxItems&&(s.maxItems=l.maxItems),0<=l.maxLength&&(s.maxItems=l.maxLength)),s):(f.each(e.children,function(e){e=i(e,t);-1!==e.minItems&&(-1!==s.minItems?s.minItems=Math.max(s.minItems,e.minItems):s.minItems=e.minItems),-1!==e.maxItems&&(-1!==s.maxItems?s.maxItems=Math.min(s.maxItems,e.maxItems):s.maxItems=e.maxItems)}),s)}return i(this)};n.prototype.initialize=function(e){this.formDesc=f.clone(e=e||{}),E.defaultClasses=s(),this.defaultClasses=f.clone(E.defaultClasses),this.formDesc.defaultClasses&&f.extend(this.defaultClasses,this.formDesc.defaultClasses),this.formDesc.prefix=this.formDesc.prefix||"jsonform-"+f.uniqueId();function c(e,t){Array.isArray(e)||(e=[e]);for(var l=!!t,s=[],i=0;i<e.length;i++){var n=e[i];"object"==typeof n?(s.push(n),l=!0):s.push({type:n})}return l&&s}this.formDesc.schema&&!0===function(e){if(e.type&&(f.isString(e.type)||Array.isArray(e.type)))return!1;var t,l=["$schema","properties","definitions"];for(t in e)if(f.contains(l,t))return!1;return!0}(this.formDesc.schema)&&(this.formDesc.schema={type:"object",properties:this.formDesc.schema}),this.formDesc._originalSchema=this.formDesc.schema,this.formDesc.schema=m.parse(m.stringify(this.formDesc.schema)),function e(t){if(t){var l,s;if(t.type&&("string"!=typeof t.type?(l=c(t.type))&&(t.anyOf=l,delete t.type):"any"==t.type&&delete t.type),t.extends&&(l=t.extends,Array.isArray(l)||(l=[l]),t.allOf=l,delete t.extends),t.disallow&&("string"==typeof t.disallow?t.not={type:t.disallow}:t.not={anyOf:c(t.disallow,!0)},delete t.disallow),t.properties){var i,n=Array.isArray(t.required)?t.required:[];for(i in t.properties){var a=t.properties[i];if(a&&"boolean"==typeof a.required)a.required&&n.indexOf(i)<0&&n.push(i),delete a.required;else if(void 0!==a.required&&"boolean"!=typeof a.required&&!Array.isArray(a.required))throw new Error("field "+i+"'s required property should be either boolean or array of strings");if("array"===a.type&&a.items&&Array.isArray(a.items))throw new Error("the items property of array property "+i+" in the schema definition must be an object")}n.length&&(t.required=n)}if(t.dependencies)for(var o in t.dependencies)"string"==typeof t.dependencies[o]&&(t.dependencies[o]=[t.dependencies[o]]);for(s in"boolean"==typeof t.required&&delete t.required,void 0!==t.divisibleBy&&(t.multipleOf=t.divisibleBy,delete t.divisibleBy),t)if("properties"===s||"patternProperties"===s||"dependencies"===s)for(var r in t[s])t[s][r]=e(t[s][r]);else if("enum"!==s)if(Array.isArray(t[s]))for(var d=0;d<t[s].length;d++)t[s][d]=e(t[s][d]);else"object"==typeof t[s]&&(t[s]=e(t[s]));return t}}(this.formDesc.schema),this.formDesc._originalSchemaV4=this.formDesc.schema,this.formDesc.schema=m.parse(m.stringify(this.formDesc.schema)),this.formDesc._originalSchemaV4.$schema&&delete this.formDesc._originalSchemaV4.$schema;var r=[],d=0;this.formDesc.schema.definitions&&!function n(a,o){Object.keys(a).forEach(function(e,t,l){var s,i=a[e];if(0===d&&"$ref"===e&&null!==i&&"string"==typeof i){if("#/definitions/"!==i.slice(0,14))throw new Error("Unresolved $ref: "+i);s=i.replace(/^#\/definitions\//,""),delete(a=f.extend(a,o[s])).$ref,r.indexOf(a)<0&&r.push(a)}else if(null!==i&&"object"==typeof i)if(i.$ref){if("#/definitions/"!==i.$ref.slice(0,14))throw new Error("Unresolved $ref: "+i.$ref);s=i.$ref.replace(/^#\/definitions\//,""),a[e]=f.extend(a[e],o[s]),delete a[e].$ref}else r.indexOf(i)<0&&(d+=1,n(i,o),--d,r.push(i))})}(this.formDesc.schema,this.formDesc.schema.definitions);if(this.formDesc.schema&&!0===function(e){if(e.type){if(f.isString(e.type)&&"object"===e.type)return!1;if(Array.isArray(e.type)&&f.contains(e.type,"object"))return!1}else if(e.properties)return!1;return!0}(this.formDesc.schema)){var t,l={},e=this.formDesc.prefix+"-distortedSchema";for(t in this.formDesc.schema)f.contains(["$schema","definitions"],t)||(l[t]=this.formDesc.schema[t],delete this.formDesc.schema[t]);this.formDesc.schema.properties={},this.formDesc.schema.properties[e]=l,this.formDesc._isDistorted=!0,!this.formDesc.value||"object"==typeof this.formDesc.value&&!Array.isArray(this.formDesc.value)||(this.formDesc.value={[e]:this.formDesc.value})}else this.formDesc._isDistorted=!1;this.formDesc.form=this.formDesc.form||["*",{type:"actions",items:[{type:"submit",value:"Submit"}]}],this.formDesc.form=f.isArray(this.formDesc.form)?this.formDesc.form:[this.formDesc.form],this.formDesc.params=this.formDesc.params||{},this.root=new C,(this.root.ownerTree=this).root.view=E.elementTypes.root,this.buildTree(),this.computeInitialValues()},n.prototype.buildTree=function(){f.each(this.formDesc.form,function(e){"*"===e?f.each(this.formDesc.schema.properties,function(e,t){this.formDesc.nonDefaultFormItems&&0<=this.formDesc.nonDefaultFormItems.indexOf(t)||this.root.appendChild(this.buildFromLayout({key:t}))},this):(f.isString(e)&&(e={key:e}),this.root.appendChild(this.buildFromLayout(e)))},this)},n.prototype.buildFromLayout=function(l,e){var t=null,s=new C;if(l.key&&this.formDesc.customFormItems&&(void 0!==(a=this.formDesc.customFormItems[l.key])&&(a.key=l.key,l=a)),(l=f.clone(l)).items&&(f.isArray(l.items)?l.items=f.map(l.items,f.clone):l.items=[f.clone(l.items)]),l.key){if(!(t=c(this.formDesc.schema.properties,l.key)))throw new Error('The JSONForm object references the schema key "'+l.key+'" but that key does not exist in the JSON schema');this.formDesc.onElementSchema&&this.formDesc.onElementSchema(l,t),l.name=l.name||l.key,l.title=l.title||t.title,l.description=l.description||t.description,l.readOnly=l.readOnly||t.readOnly||l.readonly||t.readonly;var i=function(e,t){var e=e.split("."),l=e.pop();if("[]"==l.slice(-2))return!1;var s,e=e.join(".");return e?(s=c(t.properties,e)).required&&0<=s.required.indexOf(l)&&("[]"==e.slice(-2)||i(e,t)):t.required&&0<=t.required.indexOf(l)};if(l.required=!0===l.required||!0===t.required||i(l.key,this.formDesc.schema),l.id||(l.id=g(this.formDesc.prefix)+"-elt-"+d(l.key)),l.allowEmpty&&(t._jsonform_allowEmpty=!0),!l.type){if(f.isArray(t.type)){if(f.contains(t.type,"null")&&(t.type=f.without(t.type,"null"),t.required=!1),1<t.type.length)throw new Error("Cannot process schema element with multiple types.");t.type=f.first(t.type)}"string"===t.type&&!f.isUndefined(t.format)&&f.contains(["url","time","email","date-time","date","color"],t.format)?"date-time"===t.format?l.type="datetime-local":l.type=t.format:"number"!==t.type&&"integer"!==t.type||t.enum?"string"!==t.type&&"any"!==t.type||t.enum?"boolean"===t.type?l.type="checkbox":"object"===t.type?t.properties?l.type="fieldset":l.type="textarea":f.isUndefined(t.enum)?l.type=t.type:l.type="select":l.type="text":l.type="number"}function n(l,e){l.options?Array.isArray(l.options)?l.options=l.options.map(function(e){return r(e,"value")?e:{value:e,title:e}}):"object"==typeof l.options&&(l.options=Object.keys(l.options).map(function(e){return{value:e,title:l.options[e]}})):l.titleMap?l.options=f.map(e,function(e){var t=e.toString();return{value:e,title:r(l.titleMap,t)?l.titleMap[t]:t}}):l.options=e.map(function(e){return{value:e,title:e.toString()}})}var a,o;l.options?n(l):!t.enum&&"boolean"!==t.type||((a=t.enum)?l.optionsAsEnumOrder=!0:a="select"===l.type?["",!0,!1]:[!0,!1],n(l,a)),"checkboxes"!==l.type&&"checkboxbuttons"!==l.type||!t.items||(a=Array.isArray(t.items)?t.items[0]:t.items,l.options?(n(l),a._jsonform_checkboxes_as_array="value"):(o=a.enum)&&(n(l,o),l.optionsAsEnumOrder=!0,a._jsonform_checkboxes_as_array="checkboxes"===l.type||"value")),"tagsinput"===l.getValue&&(t._jsonform_get_value_by_tagsinput="tagsinput"),"object"===t.type&&f.each(t.properties,function(e,t){t=l.key+"."+t;this.formDesc.nonDefaultFormItems&&0<=this.formDesc.nonDefaultFormItems.indexOf(t)||s.appendChild(this.buildFromLayout({key:t}))},this)}if(l.type||(l.type="text"),!(o=E.elementTypes[l.type]))throw new Error('The JSONForm contains an element whose type is unknown: "'+l.type+'"');if(t){if(!o.inputfield&&!o.array&&"selectfieldset"!==l.type&&"object"!==t.type)throw new Error('The JSONForm contains an element that links to an element in the JSON schema (key: "'+l.key+'") and that should not based on its type ("'+l.type+'")')}else if(o.inputfield&&"selectfieldset"!==l.type)throw new Error('The JSONForm defines an element of type "'+l.type+'" but no "key" property to link the input field to the JSON schema');return l.iddot=g(l.id||""),s.formElement=l,s.schemaElement=t,s.view=o,s.ownerTree=this,l.handlers||(l.handlers={}),s.view.array||(l.items?f.each(l.items,function(e){f.isString(e)&&(e={key:e}),s.appendChild(this.buildFromLayout(e))},this):l.otherField&&(a=l.otherField,f.isString(a)?a=l.otherField={key:a,notitle:!0}:void 0===a.notitle&&(a.notitle=!0),void 0===a.inline&&(a.inline=l.inline),s.appendChild(this.buildFromLayout(a)))),s},n.prototype.computeInitialValues=function(){this.root.computeInitialValues(this.formDesc.value)},n.prototype.render=function(e){e&&(this.domRoot=e,this.root.render(),this.hasRequiredField()&&h(e).addClass("jsonform-hasrequired"),h(e).addClass("jsonform"))},n.prototype.forEachElement=function(l){function s(e){for(var t=0;t<e.children.length;t++)l(e.children[t]),s(e.children[t])}s(this.root)},n.prototype.validate=function(e){var t,l,s=E.getFormValue(this.domRoot),i=!1,n=this.formDesc;return!1!==n.validate&&(t=!1,"object"!=typeof n.validate?a.Ajv?(t=new a.Ajv({allErrors:!0,schemaId:"auto",unknownFormats:"ignore",validateSchema:"log"}),this.formDesc._validatorVendor="ajv"):a.ZSchema?(t=new a.ZSchema({ignoreUnknownFormats:!0}),this.formDesc._validatorVendor="z-schema"):a.JSONFormValidator&&(t=a.JSONFormValidator.createEnvironment("json-schema-draft-03"),this.formDesc._validatorVendor="jsv"):t=n.validate,t&&(h(this.domRoot).jsonFormErrors(!1,n),"ajv"==this.formDesc._validatorVendor?!(l=t.compile(this.formDesc._originalSchemaV4))(s)&&l.errors&&l.errors.length&&(i=l.errors):"z-schema"==this.formDesc._validatorVendor?(t.validate(s,this.formDesc._originalSchemaV4),i=t.getLastErrors(),0):(l=t.validate(s,this.formDesc._originalSchema))&&l.errors&&l.errors.length&&(i=(i=i||[]).concat(l.errors)))),i&&!e&&(n.displayErrors?n.displayErrors(i,this.domRoot):h(this.domRoot).jsonFormErrors(i,n)),{errors:i,values:s}},n.prototype.submit=function(t){function e(){return t&&(t.preventDefault(),t.stopPropagation()),!1}var l=E.getFormValue(this.domRoot),s=this.formDesc,i=!1;if(this.forEachElement(function(e){i||e.view.onSubmit&&(i=!e.view.onSubmit(t,e))}),i)return e();var n=this.validate();return(s.onSubmit&&!s.onSubmit(n.errors,l)||n.errors||!(!s.onSubmitValid||s.onSubmitValid(l)))&&e()},n.prototype.hasRequiredField=function(){return 0<h(this.domRoot).find(".jsonform-required").length},E.getFormValue=function(e){e=h(e).data("jsonform-tree");if(!e)return null;var t=e.root.getFormValues();return t=e.formDesc._isDistorted?t[e.formDesc.prefix+"-distortedSchema"]:t},h.fn.jsonFormErrors=function(e,t){var l=h(this).data("jsonform-tree");if(h("."+l.defaultClasses.groupMarkClassPrefix+"error",this).removeClass(l.defaultClasses.groupMarkClassPrefix+"error"),h("."+l.defaultClasses.groupMarkClassPrefix+"warning",this).removeClass(l.defaultClasses.groupMarkClassPrefix+"warning"),h(".jsonform-errortext",this).hide(),e){for(var s,i,n,a,o=[],r=0;r<e.length;r++)"ajv"===l.formDesc._validatorVendor?(s=e[r].dataPath||e[r].instancePath,0<=["dependencies","required","additionalProperties"].indexOf(e[r].keyword)&&e[r].params&&f.isObject(e[r].params)&&(s&&"/"!=s.slice(-1)&&(s+="/"),s+=e[r].params.missingProperty||e[r].params.property)):"z-schema"===l.formDesc._validatorVendor?(s=e[r].path,0<=["OBJECT_DEPENDENCY_KEY","OBJECT_MISSING_REQUIRED_PROPERTY"].indexOf(e[r].code)&&("/"!=s.slice(-1)&&(s+="/"),s+=e[r].params[0])):"jsv"===l.formDesc._validatorVendor?(s=e[r].uri,0<=["dependencies","required"].indexOf(e[r].attribute)&&("/"!=s.slice(-1)&&(s+="/"),e[r].details&&f.isObject(e[r].details)&&(i=Object.keys(e[r].details)[0],Array.isArray(e[r].details[i])?s+=e[r].details[i][0]:s+=i))):s=e[r].uri||e[r].path||e[r].dataPath,s&&(s=(s="ajv"!==l.formDesc._validatorVendor||"."!==s.charAt(0)&&"/"!==s.charAt(0)?s:s.substring(1)).replace(/.*#\//,"").replace(/\//g,".").replace(/\.([0-9]+)(?=\.|$)/g,"[$1]"),i=".jsonform-error-"+g(s.replace(/\./g,"---")),o.push(i),n=e[r].type||"error",a=h(i,this),"ajv"===l.formDesc._validatorVendor?0<=["minItems","maxItems"].indexOf(e[r].keyword)&&(0<=["checkboxes","checkboxbuttons"].indexOf(a.data("jsonform-type"))?e[r].message="Please select at "+("minItems"==e[r].keyword?"least":"most")+" "+e[r].params.limit+(1<e[r].params.limit?" options":" option")+".":0<=["tagsinput"].indexOf(a.data("jsonform-type"))&&(e[r].message="Please insert at "+("minItems"==e[r].keyword?"least":"most")+" "+e[r].params.limit+(1<e[r].params.limit?" tags":" tag")+".")):"z-schema"===l.formDesc._validatorVendor?"ARRAY_LENGTH_SHORT"!=e[r].code&&"ARRAY_LENGTH_LONG"!=e[r].code||(0<=["checkboxes","checkboxbuttons"].indexOf(a.data("jsonform-type"))?e[r].message="Please select at "+("ARRAY_LENGTH_SHORT"==e[r].code?"least":"most")+" "+e[r].params[1]+(1<e[r].params[1]?" options":" option")+".":0<=["tagsinput"].indexOf(a.data("jsonform-type"))&&(e[r].message="Please insert at "+("ARRAY_LENGTH_SHORT"==e[r].code?"least":"most")+" "+e[r].params[1]+(1<e[r].params[1]?" tags":" tag")+".")):"jsv"===l.formDesc._validatorVendor&&0<=["minItems","maxItems"].indexOf(e[r].attribute)&&(0<=["checkboxes","checkboxbuttons"].indexOf(a.data("jsonform-type"))?e[r].message="Please select at "+("minItems"==e[r].attribute?"least":"most")+" "+e[r].details+(1<e[r].details?" options":" option")+".":0<=["tagsinput"].indexOf(a.data("jsonform-type"))&&(e[r].message="Please insert at "+("minItems"==e[r].attribute?"least":"most")+" "+e[r].details+(1<e[r].details?" tags":" tag")+".")),a.addClass(l.defaultClasses.groupMarkClassPrefix+n),a.find("> div > .jsonform-errortext, > .jsonform-errortext").text(e[r].message).show());var o=o.join(","),d=h(o,this),c=d.parents(".tab-pane"),m=h(),c=(c.each(function(){var e=h(this);m=m.add(e.closest(".jsonform-tabbable").find("> .nav > li").eq(e.index()).addClass(l.defaultClasses.groupMarkClassPrefix+"error"))}),d.filter(":visible").get(0));(c=!c&&0<m.length?m.get(0):c)&&c.scrollIntoView&&c.scrollIntoView(!0,{behavior:"smooth"})}},h.fn.jsonForm=function(e,t){if("values"===e)return E.getFormValue(this);if("submit"===e||"validate"===e)return(l=this.data("jsonform-tree"))?"submit"===e?l.submit():l.validate(t):null;var l=this,s=(e=f.defaults({},e,{submitEvent:"submit"}),new n);return s.initialize(e),s.render(l.get(0)),l.data("jsonform-tree",s),e.submitEvent&&(l.off(e.submitEvent+".jsonform"),l.on(e.submitEvent+".jsonform",function(e){s.submit(e)})),i(l),h(".expandable > div, .expandable > fieldset",l).hide(),l.on("click",".expandable > legend",function(){var e=h(this).parent();e.toggleClass("expanded"),e.find("legend").attr("aria-expanded",e.hasClass("expanded")),h("> div",e).slideToggle(100)}),s.defaultClasses.useTooltip&&v(),s},h.fn.jsonFormValue=function(){return E.getFormValue(this)},a.JSONForm||(a.JSONForm=E)}("undefined"!=typeof exports,"undefined"!=typeof exports?exports:window,"undefined"!=typeof jQuery?jQuery:{fn:{}},"undefined"!=typeof _?_:null,JSON);
!function(e,s,f,h,m){e&&!h&&(h=require("underscore"));function n(){return{rootClass:"",formClass:"form-group",formReadonlyClass:"jsonform-readonly",formDisabledClass:"jsonform-disabled",formInlineClass:"form-inline",formsGroupClass:"form-group",groupMarkClassPrefix:"has-",labelClass:"col-form-label",controlClass:"",iconClassPrefix:"fa fa",buttonClass:"btn-secondary",submitButtonClass:"btn-primary",resetButtonClass:"btn-danger",buttonGroupClass:"btn-group",textualInputClass:"form-control",inputGroupClass:"input-group",prependClass:"input-group-prepend",appendClass:"input-group-append",addonClass:"input-group-text",placementClassPrefix:"float",helpClass:"form-text text-muted",useTooltip:!!f.fn.tooltip,tooltipClass:"",tooltipIconSuffix:"info-circle",actionsClass:"",errorTextClass:"text-danger",imgResponsiveClass:"img-fluid",legendClass:"col-form-label-lg",navTabsClass:"nav-tabs",navItemClass:"nav-item",navLinkClass:"nav-link",selectWrapClass:"",rangeInputClass:"form-control-range",switchWrapClass:"custom-control custom-switch",switchInputClass:"custom-control-input",switchLabelClass:"custom-control-label",radioWrapClass:"form-check",radioWrapInlineClass:"form-check form-check-inline",radioInputClass:"form-check-input",radioLabelClass:"form-check-label",checkboxWrapClass:"form-check",checkboxWrapInlineClass:"form-check form-check-inline",checkboxInputClass:"form-check-input",checkboxLabelClass:"form-check-label",dropdownMenuClass:"",dropdownInputClass:""}}function u(e){return!(h.isUndefined(e)||h.isNull(e))}function r(e,t){return"object"==typeof e&&e.hasOwnProperty(t)}function p(e){return u(e)&&(e=""+e)?e.replace(/&(?!\w+;|#\d+;|#x[\da-f]+;)/gi,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;"):""}function g(e){return e.replace(/([ \!\"\#\$\%\&\'\(\)\*\+\,\.\/\:\;<\=\>\?\@\[\\\]\^\`\{\|\}\~])/g,"\\$1")}function d(e){return e.replace(/\ /g,"_")}function v(){f('[data-toggle="tooltip"]').tooltip()}function l(e){function l(e,t){t.find("> .active").removeClass("active").find("> a.active").removeClass("active"),e.addClass("active").find("> a").addClass("active")}function a(e,t){e.find("input, textarea, select").prop("disabled",!1),e.parent().children(":not([data-idx="+t+"])").find("input, textarea, select").attr("disabled","disabled")}function t(e){var t=f("option:selected",f(this)),i=f(this),n=t.get(0).getAttribute("data-idx")||t.attr("value");e.preventDefault(),t.hasClass("active")||(e=f(this).parents(".jsonform-tabbable").eq(0).find("> .tab-content > [data-idx="+n+"]"),l(t,i),l(e,e.parent()),a(e,n))}function i(e){f("a",f(this));var t=f(this).parents(".jsonform-tabbable").first().find(".tab-content").first(),i=f(this).index(),t=t.find("> [data-idx="+i+"]");e.preventDefault(),l(f(this),f(this).parent()),l(t,t.parent()),f(this).parent().hasClass("jsonform-alternative")&&a(t,i)}e.each(function(){f(this).on("change","select.nav",t),f(this).find("select.nav").each(function(){f(this).val(f(this).find(".active").attr("value"));var e=f(this).find("option:selected").get(0).getAttribute("data-idx")||f(this).find("option:selected").attr("value"),t=f(this).parents(".jsonform-tabbable").eq(0).find("> .tab-content > [data-idx="+e+"]");a(t,e)}),f(this).on("click","ul.nav li",i),f(this).find("ul.nav li.active").trigger("click")})}function t(e,t,i){return e={template:'<input type="'+e+'" class="<%= fieldHtmlClass'+(t?" || cls.textualInputClass":"")+' %>" name="<%= node.name %>" value="<%= escape(value) %>" id="<%= id %>" aria-label="<%= node.title ? escape(node.title) : node.name %>"<%= (node.disabled? " disabled" : "")%><%= (node.isReadOnly() ? " readonly=\'readonly\'" : "") %><%= (node.schemaElement && node.schemaElement.minLength ? " minlength=\'" + node.schemaElement.minLength + "\'" : "") %><%= (node.schemaElement && node.schemaElement.maxLength ? " maxlength=\'" + node.schemaElement.maxLength + "\'" : "") %><%= (node.required ? " required=\'required\'" : "") %><%= (node.placeholder? " placeholder=" + \'"\' + escape(node.placeholder) + \'"\' : "")%> />',fieldtemplate:!0,inputfield:!0,onInsert:function(e,t){if(t.formElement){var i=f(t.el).find("input");if(t.formElement.autocomplete&&i.autocomplete&&i.autocomplete(t.formElement.autocomplete),t.formElement.tagsinput||"tagsvalue"===t.formElement.getValue){if(!f.fn.tagsinput)throw new Error("tagsinput is not found");var n=Array.isArray(t.value),l=(n&&i.attr("value","").val(""),{maxChars:t.schemaElement&&t.schemaElement.maxLength&&-1<t.schemaElement.maxLength?t.schemaElement.maxLength:void 0});t.formElement.tagsinput&&h.extend(l,t.formElement.tagsinput),i.tagsinput(l),n&&t.value.forEach(function(e){i.tagsinput("add",e)})}t.formElement.typeahead&&i.typeahead&&i.typeahead(t.formElement.typeahead)}}},e=i?h.extend(e,i):e}function i(n,e){return{template:("range"===n?'<div class="range">':"")+'<input type="'+n+'" class="<%= fieldHtmlClass'+(e?" || cls.textualInputClass":"")+" %>"+("range"===n?"<%= cls.rangeInputClass %>":"")+'" name="<%= node.name %>" value="<%= escape(value) %>" id="<%= id %>" aria-label="<%= node.title ? escape(node.title) : node.name %>"<%= (node.disabled? " disabled" : "")%><%= (node.isReadOnly() ? " readonly=\'readonly\'" : "") %><%= (range.min !== undefined ? " min="+range.min : "")%><%= (range.max !== undefined ? " max="+range.max : "")%><%= (range.step !== undefined ? " step="+range.step : "")%><%= (node.schemaElement && node.schemaElement.minLength ? " minlength=\'" + node.schemaElement.minLength + "\'" : "") %><%= (node.schemaElement && node.schemaElement.maxLength ? " maxlength=\'" + node.schemaElement.maxLength + "\'" : "") %><%= (node.required ? " required=\'required\'" : "") %><%= (node.placeholder? " placeholder=" + \'"\' + escape(node.placeholder) + \'"\' : "")%> />'+("range"===n?'<% if (range.indicator) { %><span class="range-value" rel="<%= id %>"><%= escape(value) %></span><% } %></div>':""),fieldtemplate:!0,inputfield:!0,onInput:function(e,t){const i=document.querySelector('span.range-value[rel="'+t.id+'"]');i&&(i.innerText=e.target.value)},onBeforeRender:function(e,t){var i;e.range={step:1,indicator:!1},"range"==n&&(e.range.min=1,e.range.max=100),t&&t.schemaElement&&(void 0!==t.schemaElement.multipleOf?e.range.step=t.schemaElement.multipleOf:t.formElement&&t.formElement.step?e.range.step=t.formElement.step:"number"==t.schemaElement.type&&(e.range.step="any"),i="any"===e.range.step?1:e.range.step,t.formElement&&t.formElement.indicator&&(e.range.indicator=t.formElement.indicator),void 0!==t.schemaElement.minimum&&(t.schemaElement.exclusiveMinimum?e.range.min=t.schemaElement.minimum+i:e.range.min=t.schemaElement.minimum),void 0!==t.schemaElement.maximum&&(t.schemaElement.exclusiveMaximum?e.range.max=t.schemaElement.maximum-i:e.range.max=t.schemaElement.maximum))}}}function c(e,t){if(t=t.replace(/\./g,".properties.").replace(/\[[0-9]*\]/g,".items"),(e=E.util.getObjKey(e,t,!0))&&e.$ref)throw new Error("JSONForm does not yet support schemas that use the $ref keyword. See: https://github.com/joshfire/jsonform/issues/54");return e}function y(e,t,i){var n;if(i=i||0,u(t)&&""!==t)if(e.default&&0==i)n=E.util.getObjKeyEx(e.default,t);else{var l=t.match(/^((([^\\\[.]|\\.)+)|\[(\d+)\])\.?(.*)$/);if(!l)throw new Error("bad format key: "+t);if("string"==typeof l[2]&&0<l[2].length)e=e.properties[l[2]];else{if(!("string"==typeof l[4]&&0<l[4].length))throw new Error("impossible reach here");e=e.items,0<i&&--i}e&&(n=e.default&&0==i?E.util.getObjKeyEx(e.default,l[5]):y(e,l[5],i))}else 0==i&&(n=e.default);return n}function b(e,i,n){var l=0;return e?i&&0!==i.length?e.replace(x,function(e,t){return n&&2!=e.length||!u(i[l])||(e="["+i[l]+"]"),l+=1,e}):e:null}function C(){this.id=null,this.key=null,this.el=null,this.formElement=null,this.schemaElement=null,this.view=null,this.children=[],this.ownerTree=null,this.parentNode=null,this.childTemplate=null,this.legendChild=null,this.arrayPath=[],this.childPos=0}function a(){this.eventhandlers=[],this.root=null,this.formDesc=null}var x=/\[([0-9]*)\](?=\[|\.|$)/g,o={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g},w={evaluate:/\{\[([\s\S]+?)\]\}/g,interpolate:/\{\{([\s\S]+?)\}\}/g},E={util:{}};E.fieldTemplate=function(e){return'<div <% for(var key in elt.htmlMetaData) {%><%= key %>="<%= elt.htmlMetaData[key] %>" <% }%>class="<%= cls.formClass %> jsonform-node jsonform-error-<%= keydash %><%= elt.htmlClass ? " " + elt.htmlClass : "" %><%= (node.required && node.formElement && (node.formElement.type !== "checkbox") && (node.formElement.type !== "switch") ? " jsonform-required" : "") %><%= (node.isReadOnly() ? " " + cls.formReadonlyClass : "") %><%= (node.disabled ? " " + cls.formDisabledClass : "") %>" data-jsonform-type="<%= node.formElement.type %>"><% if (!elt.notitle && node.inlinetitle !== true) { %><label class="<%= cls.labelClass %>" for="<%= node.id %>"><%= node.getTitle() %><% if (node.description && (elt.useTooltip === true || (elt.useTooltip === undefined && cls.useTooltip))) { %><span data-toggle="tooltip" data-placement="right" title="<%= node.description %>" class="<%= cls.tooltipClass %> jsonform-description-tooltip"><i class="<%= cls.iconClassPrefix %>-<%= cls.tooltipIconSuffix %>"></i></span><% } %></label><% } %><div<% if (cls.controlClass) { %> class="<%= cls.controlClass %>"<% } %>><% if (node.description && !(elt.useTooltip === true || (elt.useTooltip === undefined && cls.useTooltip))) { %><small class="<%= cls.helpClass %> jsonform-description"><%= node.description %></small><% } %><% if (node.prepend || node.append) { %><div class="<%= cls.inputGroupClass %>"><% if (node.prepend) { %><% if (cls.prependClass) { %><div class="<%= cls.prependClass %>"><% } %><% if (node.prepend.indexOf("<input ") >= 0) { %><div class="<%= cls.addonClass %>"><%= node.prepend %></div><% } else { %><% if (node.prepend.indexOf("<button ") >= 0) { %><%= node.prepend %><% } else { %><span class="<%= cls.addonClass %>"><%= node.prepend %></span><% } %><% } %><% if (cls.prependClass) { %></div><% } %><% } %>'+e+'<% if (node.append) { %><% if (cls.appendClass) { %><div class="<%= cls.appendClass %>"><% } %><% if (node.append.indexOf("<input ") >= 0) { %><div class="<%= cls.addonClass %>"><%= node.append %></div><% } else { %><% if (node.append.indexOf("<button ") >= 0) { %><%= node.append %><% } else { %><span class="<%= cls.addonClass %>"><%= node.append %></span><% } %><% } %><% if (cls.appendClass) { %></div><% } %><% } %></div><% } else { %>'+e+'<% } %><small class="<%= cls.errorTextClass %> jsonform-errortext" style="display:none;"></small></div></div>'},E.elementTypes={none:{template:""},root:{template:'<div<% if (cls.rootClass) { %> class="<%= cls.rootClass %>"<% } %>><%= children %></div>'},text:t("text",!0),password:t("password",!0),date:t("date",!0,{onInsert:function(e,t){var i,n;window.Modernizr&&window.Modernizr.inputtypes&&!window.Modernizr.inputtypes.date&&(i=f(t.el).find("input")).datepicker&&(n={dateFormat:"yy-mm-dd"},t.formElement&&t.formElement.datepicker&&"object"==typeof t.formElement.datepicker&&h.extend(n,t.formElement.datepicker),i.datepicker(n))}}),datetime:t("datetime",!0),"datetime-local":t("datetime-local",!0,{onBeforeRender:function(e,t){e.value&&e.value.getTime&&(e.value=new Date(e.value.getTime()-6e4*e.value.getTimezoneOffset()).toISOString().slice(0,-1))}}),email:t("email",!0),month:t("month",!0),number:i("number",!0),search:t("search",!0),tel:t("tel",!0),time:t("time",!0),url:t("url",!0),week:t("week",!0),range:i("range"),color:{template:'<span id="color_picker_<%= id %>"><input type="text" <%= (fieldHtmlClass ? "class=\'" + fieldHtmlClass + "\' " : "") %>name="<%= node.name %>" value="<%= escape(value) %>" id="<%= id %>" aria-label="<%= node.title ? escape(node.title) : node.name %>"<%= (node.disabled? " disabled" : "")%><%= (node.required ? " required=\'required\'" : "") %><%= (node.isReadOnly()? " readonly=\'readonly\'" : "") %> /></span>',fieldtemplate:!0,inputfield:!0,getElement:function(e){return f(e).parent().get(0)},onInsert:function(e,t){var i;s.Picker?(f(t.el).find("input").attr("readOnly","true"),(i=f(t.el).find("input").attr("value"))&&f(t.el).find("#"+g(t.id)).attr("style","background-color:"+i+";color:"+i),new s.Picker({parent:document.querySelector("#color_picker_"+g(t.id)),alpha:!1,color:i||"",editor:!0,editorFormat:"hex",cancelButton:!0,onDone:function(e){f(t.el).find("#"+g(t.id)).attr("value",e.hex.slice(0,7)).attr("style","background-color:"+e.hex.slice(0,7)+";color:"+e.hex.slice(0,7))}})):(i={type:"color",showPalette:!1,showAlpha:!1,allowEmpty:!0,disabled:!!t.disabled,preferredFormat:"hex",showInput:!0},t.isReadOnly()&&h.extend(i,{beforeShow:function(e){return!1}}),f(t.el).find("#"+g(t.id)).spectrum(i))}},textarea:{template:'<textarea id="<%= id %>" name="<%= node.name %>" class="<%= fieldHtmlClass || cls.textualInputClass %>" style="height:<%= elt.height || "150px" %>;width:<%= elt.width || "100%" %>;" aria-label="<%= node.title ? escape(node.title) : node.name %>"<%= (node.disabled? " disabled" : "")%><%= (node.isReadOnly() ? " readonly=\'readonly\'" : "") %><%= (node.schemaElement && node.schemaElement.minLength ? " minlength=\'" + node.schemaElement.minLength + "\'" : "") %><%= (node.schemaElement && node.schemaElement.maxLength ? " maxlength=\'" + node.schemaElement.maxLength + "\'" : "") %><%= (node.required ? " required=\'required\'" : "") %><%= (node.placeholder? " placeholder=" + \'"\' + escape(node.placeholder) + \'"\' : "")%>><%= value %></textarea>',fieldtemplate:!0,inputfield:!0},wysihtml5:{template:'<textarea id="<%= id %>" name="<%= node.name %>" style="height:<%= elt.height || "300px" %>;width:<%= elt.width || "100%" %>;" aria-label="<%= node.title ? escape(node.title) : node.name %>"class="<%= fieldHtmlClass || cls.textualInputClass %>" <%= (node.disabled? " disabled" : "")%><%= (node.isReadOnly() ? " readonly=\'readonly\'" : "") %><%= (node.schemaElement && node.schemaElement.minLength ? " minlength=\'" + node.schemaElement.minLength + "\'" : "") %><%= (node.schemaElement && node.schemaElement.maxLength ? " maxlength=\'" + node.schemaElement.maxLength + "\'" : "") %><%= (node.required ? " required=\'required\'" : "") %><%= (node.placeholder? " placeholder=" + \'"\' + escape(node.placeholder) + \'"\' : "")%>><%= value %></textarea>',fieldtemplate:!0,inputfield:!0,onInsert:function(e,t){function i(){f(t.el).data("wysihtml5")||(f(t.el).data("wysihtml5_loaded",!0),f(t.el).find("#"+g(t.id)).wysihtml5({toolbar:{html:!0,emphasis:!0,link:!!f.fn.modal,image:!!f.fn.modal,color:!1,fa:"fa"===t.ownerTree.defaultConfig.iconClassPrefix.slice(-2)},events:{load:function(){f(this.editableElement).prop("required",!1)}}}))}var n;window.jsonform_wysihtml5_setup?window.jsonform_wysihtml5_setup(i):n=window.setInterval(function(){window.wysihtml5&&(window.clearInterval(n),i())},1e3)}},summernote:{template:'<textarea id="<%= id %>" name="<%= node.name %>" style="height:<%= elt.height || "300px" %>;width:<%= elt.width || "100%" %>;" aria-label="<%= node.title ? escape(node.title) : node.name %>"class="<%= fieldHtmlClass || cls.textualInputClass %>" <%= (node.disabled? " disabled" : "")%><%= (node.isReadOnly() ? " readonly=\'readonly\'" : "") %><%= (node.schemaElement && node.schemaElement.minLength ? " minlength=\'" + node.schemaElement.minLength + "\'" : "") %><%= (node.schemaElement && node.schemaElement.maxLength ? " maxlength=\'" + node.schemaElement.maxLength + "\'" : "") %><%= (node.required ? " required=\'required\'" : "") %><%= (node.placeholder? " placeholder=" + \'"\' + escape(node.placeholder) + \'"\' : "")%>><%= value %></textarea>',fieldtemplate:!0,inputfield:!0,onInsert:function(e,t){var i,n;i=t.formElement||{},n={placeholder:t.placeholder||null,height:i.height||"300px",width:i.width||"100%",disableDragAndDrop:!0,codeviewFilter:!0,spellCheck:!1,disableGrammar:!0,callbacks:{onInit:function(){f(this).prop("required",!1)}},toolbar:[["style",["style"]],["color",["color"]],["font",["bold","italic","underline","clear"]],["para",["ul","ol","paragraph"]],["table",["table"]],["view",["codeview"]],["insert",["link","picture"]]]},"fa"===t.ownerTree.defaultConfig.iconClassPrefix.slice(-2)&&h.extend(n,{icons:{align:'<i class="'+t.ownerTree.defaultConfig.iconClassPrefix+'-align-left"/>',alignCenter:'<i class="'+t.ownerTree.defaultConfig.iconClassPrefix+'-align-center"/>',alignJustify:'<i class="'+t.ownerTree.defaultConfig.iconClassPrefix+'-align-justify"/>',alignLeft:'<i class="'+t.ownerTree.defaultConfig.iconClassPrefix+'-align-left"/>',alignRight:'<i class="'+t.ownerTree.defaultConfig.iconClassPrefix+'-align-right"/>',indent:'<i class="'+t.ownerTree.defaultConfig.iconClassPrefix+'-indent"/>',outdent:'<i class="'+t.ownerTree.defaultConfig.iconClassPrefix+'-outdent"/>',arrowsAlt:'<i class="'+t.ownerTree.defaultConfig.iconClassPrefix+'-arrows-alt"/>',bold:'<i class="'+t.ownerTree.defaultConfig.iconClassPrefix+'-bold"/>',caret:'<i class="'+t.ownerTree.defaultConfig.iconClassPrefix+'-caret-down"/>',circle:'<i class="'+t.ownerTree.defaultConfig.iconClassPrefix+'-circle"/>',close:'<i class="'+t.ownerTree.defaultConfig.iconClassPrefix+'-times"/>',code:'<i class="'+t.ownerTree.defaultConfig.iconClassPrefix+'-code"/>',eraser:'<i class="'+t.ownerTree.defaultConfig.iconClassPrefix+'-eraser"/>',italic:'<i class="'+t.ownerTree.defaultConfig.iconClassPrefix+'-italic"/>',link:'<i class="'+t.ownerTree.defaultConfig.iconClassPrefix+'-link"/>',unlink:'<i class="'+t.ownerTree.defaultConfig.iconClassPrefix+'-unlink"/>',magic:'<i class="'+t.ownerTree.defaultConfig.iconClassPrefix+'-magic"/>',menuCheck:'<i class="'+t.ownerTree.defaultConfig.iconClassPrefix+'-check"/>',minus:'<i class="'+t.ownerTree.defaultConfig.iconClassPrefix+'-minus"/>',orderedlist:'<i class="'+t.ownerTree.defaultConfig.iconClassPrefix+'-list-ol"/>',pencil:'<i class="'+t.ownerTree.defaultConfig.iconClassPrefix+'-pencil-alt"/>',picture:'<i class="'+t.ownerTree.defaultConfig.iconClassPrefix+'-image"/>',question:'<i class="'+t.ownerTree.defaultConfig.iconClassPrefix+'-question"/>',redo:'<i class="'+t.ownerTree.defaultConfig.iconClassPrefix+'-redo"/>',square:'<i class="'+t.ownerTree.defaultConfig.iconClassPrefix+'-square"/>',strikethrough:'<i class="'+t.ownerTree.defaultConfig.iconClassPrefix+'-strikethrough"/>',subscript:'<i class="'+t.ownerTree.defaultConfig.iconClassPrefix+'-subscript"/>',superscript:'<i class="'+t.ownerTree.defaultConfig.iconClassPrefix+'-superscript"/>',table:'<i class="'+t.ownerTree.defaultConfig.iconClassPrefix+'-table"/>',textHeight:'<i class="'+t.ownerTree.defaultConfig.iconClassPrefix+'-text-height"/>',trash:'<i class="'+t.ownerTree.defaultConfig.iconClassPrefix+'-trash-alt"/>',underline:'<i class="'+t.ownerTree.defaultConfig.iconClassPrefix+'-underline"/>',undo:'<i class="'+t.ownerTree.defaultConfig.iconClassPrefix+'-undo"/>',unorderedlist:'<i class="'+t.ownerTree.defaultConfig.iconClassPrefix+'-list-ul"/>',video:'<i class="'+t.ownerTree.defaultConfig.iconClassPrefix+'-film"/>'}}),i.summernote&&"object"==typeof i.summernote&&h.extend(n,i.summernote),f(t.el).find("#"+g(t.id)).summernote(n),(t.disabled||t.isReadOnly())&&f(t.el).find("#"+g(t.id)).summernote("disable")}},ace:{template:'<div id="<%= id %>" style="position:relative;height:<%= elt.height || "300px" %>;"><div id="<%= id %>__ace" style="width:<%= elt.width || "100%" %>;height:<%= elt.height || "300px" %>;"></div><input type="hidden" name="<%= node.name %>" id="<%= id %>__hidden" value="<%= escape(value) %>"/></div>',fieldtemplate:!0,inputfield:!0,onBeforeRender:function(e,t){(e.value&&"object"==typeof e.value||Array.isArray(e.value))&&(e.value=m.stringify(e.value,null,2))},onInsert:function(e,n){function t(){var e=n.formElement||{},t=window.ace.edit(f(n.el).find("#"+g(n.id)+"__ace").get(0)),i="#"+g(n.id)+"__hidden";t.getSession().setNewLineMode("unix"),t.renderer.setShowPrintMargin(!1),t.setTheme("ace/theme/"+(e.aceTheme||"twilight")),e.aceMode&&t.getSession().setMode("ace/mode/"+e.aceMode),t.getSession().setTabSize(2);null==(e=n.value)?e="":"object"!=typeof e&&!Array.isArray(e)||(e=m.stringify(e,null,2)),t.getSession().setValue(e),e=h.debounce(function(){f(n.el).find(i).val(t.getSession().getValue()),f(n.el).find(i).trigger("change")},600);t.getSession().on("change",e),t.on("blur",function(){f(n.el).find(i).trigger("change"),f(n.el).find(i).trigger("blur")}),t.on("focus",function(){f(n.el).find(i).trigger("focus")})}var i;window.jsonform_ace_setup?window.jsonform_ace_setup(t):i=window.setInterval(function(){window.ace&&(window.clearInterval(i),t())},1e3)}},checkbox:{template:'<div class="<%= cls.checkboxWrapClass %>"><input class=\'<%= cls.checkboxInputClass %><%= (checkboxTitle ? "" : " position-static") %><%= (fieldHtmlClass ? " " + fieldHtmlClass : "") %>\' type="checkbox" id="<%= id %>" value="1" name="<%= node.name %>" aria-label="<%= node.title ? escape(node.title) : node.name %>" <% if (value) {%>checked <% } %><%= (node.isReadOnly() ? "readonly=\'readonly\' " : "") %><%= (node.disabled || node.isReadOnly() ? "disabled " : "") %><%= (node.required && node.schemaElement && (node.schemaElement.type !== "boolean") ? " required=\'required\'" : "") %>/><% if (checkboxTitle) { %><label class="<%= cls.checkboxLabelClass %>" for="<%= id %>"><%= checkboxTitle || "" %></label><% } %></div>',fieldtemplate:!0,inputfield:!0,onBeforeRender:function(e,t){e.checkboxTitle=!0===t.inlinetitle?t.title:t.inlinetitle},onInsert:function(e,t){var i,n,l;t.formElement.toggleNext&&(n="jsonform-toggle-next jsonform-toggle-next-"+(i=!0===t.formElement.toggleNext?1:t.formElement.toggleNext),(l=1===i?f(t.el).next():"all"===i?f(t.el).nextAll():f(t.el).nextAll().slice(0,i)).addClass("jsonform-toggle-next-target"),f(t.el).addClass(n).find(":checkbox").on("change",function(){var e=f(this).is(":checked");f(t.el).toggleClass("checked",e),l.toggle(e).toggleClass("jsonform-toggled-visible",e)}).trigger("change"))},getElement:function(e){return f(e).parent().get(0)}},switch:{template:'<div class="<%= cls.switchWrapClass %>"><input class=\'<%= cls.switchInputClass %><%= (fieldHtmlClass ? " " + fieldHtmlClass : "") %>\' type="checkbox" id="<%= id %>" value="1" name="<%= node.name %>" aria-label="<%= node.title ? escape(node.title) : node.name %>" <% if (value) {%>checked <% } %><%= (node.isReadOnly() ? "readonly=\'readonly\' " : "") %><%= (node.disabled || node.isReadOnly() ? "disabled " : "") %><%= (node.required && node.schemaElement && (node.schemaElement.type !== "boolean") ? " required=\'required\'" : "") %>/><label class="<%= cls.switchLabelClass %>" for="<%= id %>"><%= switchTitle || "" %></label></div>',fieldtemplate:!0,inputfield:!0,onBeforeRender:function(e,t){e.switchTitle=!0===t.inlinetitle?t.title:t.inlinetitle},onInsert:function(e,t){var i,n,l;t.formElement.toggleNext&&(n="jsonform-toggle-next jsonform-toggle-next-"+(i=!0===t.formElement.toggleNext?1:t.formElement.toggleNext),(l=1===i?f(t.el).next():"all"===i?f(t.el).nextAll():f(t.el).nextAll().slice(0,i)).addClass("jsonform-toggle-next-target"),f(t.el).addClass(n).find(":checkbox").on("change",function(){var e=f(this).is(":checked");f(t.el).toggleClass("checked",e),l.toggle(e).toggleClass("jsonform-toggled-visible",e)}).trigger("change"))},getElement:function(e){return f(e).parent().get(0)}},file:{template:'<input class="input-file form-control-file" id="<%= id %>" name="<%= node.name %>" type="file" <%= (node.required ? " required=\'required\'" : "") %><%= (node.formElement && node.formElement.accept ? (" accept=\'" + node.formElement.accept + "\'") : "") %>/>',fieldtemplate:!0,inputfield:!0},select:{template:'<% if (cls.selectWrapClass) { %><div class="<%= cls.selectWrapClass %>"><% } %><select name="<%= node.name %>" id="<%= id %>" class="<%= fieldHtmlClass || cls.textualInputClass %>"<%= (node.schemaElement && node.schemaElement.disabled? " disabled" : "")%><%= (node.required ? " required=\'required\'" : "") %>> <% _.each(node.options, function(key, val) { if(key instanceof Object) { if (value === key.value) { %> <option selected value="<%= key.value %>"><%= key.title %></option> <% } else { %> <option value="<%= key.value %>"><%= key.title %></option> <% }} else { if (value === key) { %> <option selected value="<%= key %>"><%= key %></option> <% } else { %><option value="<%= key %>"><%= key %></option> <% }}}); %> </select><% if (cls.selectWrapClass) { %></div><% } %>',fieldtemplate:!0,inputfield:!0},tagsinput:{template:'<select name="<%= node.name %><%= node.formElement.getValue === "tagsinput" ? "" : "[]" %>" id="<%= id %>" class="<%= fieldHtmlClass || cls.textualInputClass %>" multiple<%= (node.disabled? " disabled" : "")%><%= (node.required ? " required=\'required\'" : "") %>> </select>',fieldtemplate:!0,inputfield:!0,onInsert:function(e,t){if(!f.fn.tagsinput)throw new Error("tagsinput is not found");var i=f(t.el).find("select"),n={};t.schemaElement&&"array"===t.schemaElement.type&&(t.schemaElement.maxItems&&-1<t.schemaElement.maxItems&&(n.maxTags=t.schemaElement.maxItems),n.allowDuplicates=!t.schemaElement.uniqueItems,"object"==typeof t.schemaElement.items&&"string"===t.schemaElement.items.type&&(n.maxChars=t.schemaElement.items.maxLength&&-1<t.schemaElement.items.maxLength?t.schemaElement.items.maxLength:void 0)),t.formElement&&t.formElement.tagsinput&&h.extend(n,t.formElement.tagsinput),i.tagsinput(n),t.value&&t.value.forEach(function(e){i.tagsinput("add",e)})}},imageselect:{template:'<div><input type="hidden" name="<%= node.name %>" id="<%= node.id %>" value="<%= value %>" /><div class="dropdown"><a class="btn <%= cls.buttonClass %> <%= cls.dropdownInputClass %>" data-toggle="dropdown" href="#"<% if (node.value) { %> style="max-width:<%= width %>px;max-height:<%= height %>px"<% } %>><% if (node.value) { %><img class="<%= cls.imgResponsiveClass %>" src="<% if (!node.value.match(/^https?:/)) { %><%= prefix %><% } %><%= node.value %><%= suffix %>" alt="" /><% } else { %><%= buttonTitle %><% } %></a><div class="dropdown-menu <%= cls.dropdownMenuClass %>" id="<%= node.id %>_dropdown"><div><% _.each(node.options, function(key, idx) { if ((idx > 0) && ((idx % columns) === 0)) { %></div><div><% } %><a class="btn<% if (buttonClass) { %> <%= buttonClass %><% } %>" style="max-width:<%= width %>px;max-height:<%= height %>px"><% if (key instanceof Object) { %><img class="<%= cls.imgResponsiveClass %>" src="<% if (!key.value.match(/^https?:/)) { %><%= prefix %><% } %><%= key.value %><%= suffix %>" alt="<%= key.title %>" /></a><% } else { %><img class="<%= cls.imgResponsiveClass %>" src="<% if (!key.match(/^https?:/)) { %><%= prefix %><% } %><%= key %><%= suffix %>" alt="" /><% } %></a> <% }); %></div><div class="<%= cls.placementClassPrefix %>-right"><a class="btn <%= cls.buttonClass %>">Reset</a></div></div></div></div>',fieldtemplate:!0,inputfield:!0,onBeforeRender:function(e,t){var i=t.formElement||{},n=i.imageSelectorColumns||5;e.buttonTitle=i.imageSelectorTitle||"Select...",e.prefix=i.imagePrefix||"",e.suffix=i.imageSuffix||"",e.width=i.imageWidth||32,e.height=i.imageHeight||32,e.buttonClass=i.imageButtonClass||!1,t.options.length>n?(i=Math.ceil(t.options.length/n),e.columns=Math.ceil(t.options.length/i)):e.columns=n},getElement:function(e){return f(e).parent().get(0)},onInsert:function(e,s){f(s.el).on("click",".dropdown-menu a",function(e){e.preventDefault(),e.stopPropagation();var e=("img"===e.target.nodeName.toLowerCase()?f(e.target):f(e.target).find("img")).attr("src"),t=s.formElement||{},i=t.imagePrefix||"",n=t.imageSuffix||"",l=t.imageWidth||32,a=t.imageHeight||32;e?(e=(e=0===e.indexOf(i)?e.substring(i.length):e).substring(0,e.length-n.length),f(s.el).find("input").attr("value",e),f(s.el).find('a[data-toggle="dropdown"]').attr("style","max-width:"+l+"px;max-height:"+a+"px").html('<img class="'+s.ownerTree.defaultConfig.imgResponsiveClass+'" src="'+(e.match(/^https?:/)?"":i)+e+n+'" alt="" />').dropdown("hide")):(f(s.el).find("input").attr("value",""),f(s.el).find('a[data-toggle="dropdown"]').removeAttr("style").html(t.imageSelectorTitle||"Select...").dropdown("hide"))})}},iconselect:{template:'<div><input type="hidden" name="<%= node.name %>" id="<%= node.id %>" value="<%= value %>" /><div class="dropdown"><a class="btn <%= cls.buttonClass %> <%= cls.dropdownInputClass %>" data-toggle="dropdown" href="#"><% if (node.value) { %><i class="<%= cls.iconClassPrefix %>-<%= node.value %><% if (isFaIcon) { %> fa-fw<% } %>" alt="" /><% } else { %><%= buttonTitle %><% } %></a><div class="dropdown-menu <%= cls.dropdownMenuClass %>" id="<%= node.id %>_dropdown"><div><% _.each(node.options, function(key, idx) { if ((idx > 0) && ((idx % columns) === 0)) { %></div><div><% } %><a class="btn<% if (buttonClass) { %> <%= buttonClass %><% } %>"><% if (key instanceof Object) { %><i class="<%= cls.iconClassPrefix %>-<%= key.value %><% if (isFaIcon) { %> fa-fw<% } %>" alt="<%= key.title %>"></i><% } else { %><i class="<%= cls.iconClassPrefix %>-<%= key %><% if (isFaIcon) { %> fa-fw<% } %>" alt=""></i><% } %></a> <% }); %></div><div class="<%= cls.placementClassPrefix %>-right"><a class="btn <%= cls.buttonClass %>">Reset</a></div></div></div></div>',fieldtemplate:!0,inputfield:!0,onBeforeRender:function(e,t){var i=t.formElement||{},n=i.imageSelectorColumns||5;e.buttonTitle=i.imageSelectorTitle||"Select...",e.buttonClass=i.imageButtonClass||!1,e.isFaIcon="fa"===e.cls.iconClassPrefix.slice(-2),t.options.length>n?(i=Math.ceil(t.options.length/n),e.columns=Math.ceil(t.options.length/i)):e.columns=n},getElement:function(e){return f(e).parent().get(0)},onInsert:function(e,n){f(n.el).on("click",".dropdown-menu a",function(e){e.preventDefault(),e.stopPropagation();var e=("i"===e.target.nodeName.toLowerCase()?f(e.target):f(e.target).find("i")).attr("class"),t=n.formElement||{},i="fa"===n.ownerTree.defaultConfig.iconClassPrefix.slice(-2);e?(0===e.indexOf(n.ownerTree.defaultConfig.iconClassPrefix)&&(e=e.substring(n.ownerTree.defaultConfig.iconClassPrefix.length+1)),i&&(e=e.substring(0,e.length-" fa-fw".length)),f(n.el).find("input").attr("value",e),f(n.el).find('a[data-toggle="dropdown"]').html('<i class="'+n.ownerTree.defaultConfig.iconClassPrefix+"-"+e+(i?" fa-fw":"")+'" alt="" />').dropdown("hide")):(f(n.el).find("input").attr("value",""),f(n.el).find('a[data-toggle="dropdown"]').html(t.imageSelectorTitle||"Select...").dropdown("hide"))})}},radios:{template:'<div id="<%= node.id %>"<% if (elt.inline) { %> class="<%= cls.formInlineClass %>"<% } %>><% _.each(node.options, function(key, val) { %><div class="<% if (elt.inline) { %><%= cls.radioWrapInlineClass %><% } else { %><%= cls.radioWrapClass %><% } %>"><input class=\'<%= cls.radioInputClass %><%= (fieldHtmlClass ? " " + fieldHtmlClass : "") %>\' type="radio" id="<%= node.id %>_<%= escape(key instanceof Object ? key.title : key) %>" value="<%= (key instanceof Object ? key.value : key) %>" name="<%= node.name %>" aria-label="<%= (key instanceof Object ? key.title : key) %>" <% if (((key instanceof Object) && (value === key.value)) || (value === key)) { %>checked="checked" <% } else { %><%= (node.isReadOnly() ? "disabled " : "") %><% } %><%= (node.disabled ? "disabled " : "") %><%= (node.required ? "required=\'required\'" : "") %>/><label class="<%= cls.radioLabelClass %>" for="<%= node.id %>_<%= escape(key instanceof Object ? key.title : key) %>"><%= (key instanceof Object ? key.title : key) %></label></div><% }); %></div>',fieldtemplate:!0,inputfield:!0,onInsert:function(e,t){if(t.formElement.toggleNextMap){var i,a={};for(i in t.formElement.toggleNextMap){var n=t.formElement.toggleNextMap[i],n=!0===n?1:n,l="jsonform-toggle-next jsonform-toggle-next-"+n,n=1===n?f(t.el).next():"all"===n?f(t.el).nextAll():f(t.el).nextAll().slice(0,n);n.addClass("jsonform-toggle-next-target"),a[i]=n}f(t.el).addClass(l).find(":radio").on("change",function(){var e,t=f(this),i=t.val(),n=t.is(":checked");for(e in a){var l=a[e];n&&e===i?l.toggle(!0).toggleClass("jsonform-toggled-visible",!0):l.toggle(!1).toggleClass("jsonform-toggled-visible",!1)}}).trigger("change")}}},radiobuttons:{template:'<div id="<%= node.id %>" class="<%= cls.buttonGroupClass %> btn-group-toggle" data-toggle="buttons"><% _.each(node.options, function(key, val) { %><label class="btn <% if (((key instanceof Object) && (value === key.value)) || (value === key)) { %>active <%= elt.activeClass ? elt.activeClass : cls.buttonClass %><% } else { %><%= cls.buttonClass %><% } %><%= (node.disabled || node.isReadOnly() ? " disabled" : "") %>"><input type="radio" style="position:absolute;left:-9999px;" <%= (fieldHtmlClass ? "class=\'" + fieldHtmlClass + "\' ": "") %>name="<%= node.name %>" value="<%= (key instanceof Object ? key.value : key) %>" <% if (((key instanceof Object) && (value === key.value)) || (value === key)) { %>checked="checked" <% } %><%= (node.disabled ? "disabled" : "") %>/><%= (key instanceof Object ? key.title : key) %></label> <% }); %></div>',fieldtemplate:!0,inputfield:!0,onInsert:function(e,t){var i,n;t.disabled||t.isReadOnly()||(i="active",(n=t.formElement||{}).activeClass?i+=" "+n.activeClass:i+=" "+t.ownerTree.defaultConfig.buttonClass,f(t.el).find("label.btn").on("click",function(){f(this).parent().find("label.btn").removeClass(i).addClass(t.ownerTree.defaultConfig.buttonClass),f(this).removeClass(t.ownerTree.defaultConfig.buttonClass).addClass(i)}).find(":checked").closest("label.btn").addClass(i))}},checkboxes:{template:'<div id="<%= node.id %>"<% if (elt.inline) { %> class="<%= cls.formInlineClass %>"<% } %>><%= choiceshtml %><%= children %></div>',fieldtemplate:!0,inputfield:!0,childTemplate:function(e,t){if(!t.formElement.otherField)return e;var i='<div class="'+(t.formElement.inline?"<%= cls.checkboxWrapInlineClass %>":"<%= cls.checkboxWrapClass %>")+(t.formElement.otherField.inline?" inline-":" ")+'other-field">',n=(t.formElement.otherField.asArrayValue&&t.otherValues&&(i+='<% value = node.parentNode.otherValues.join(", ") %>'),t.key+"["+(void 0!==t.formElement.otherField.idx?t.formElement.otherField.idx:t.formElement.options.length)+"]");return i+='<input class=\'<%= cls.checkboxInputClass %><%= (fieldHtmlClass ? " " + fieldHtmlClass : "") %>\' type="checkbox" id="'+n+'" aria-label="<%= node.title || "Other" %>" <% if ((value !== undefined) && (value !== null) && (value !== "")) {%>checked="checked" <% } else { %><%= (node.isReadOnly() ? "disabled " : "") %><% } %><%= (node.disabled ? "disabled " : "") %>',(t.formElement.otherField.asArrayValue||!0===t.formElement.otherField.novalue)&&!1!==t.formElement.otherField.novalue||(i+=' name="'+n+'" value="'+(t.formElement.optionsAsEnumOrder?1:t.formElement.otherField.otherValue||"OTHER")+'"'),i=i+"/>"+('<label class="<%= cls.checkboxLabelClass %>" for="'+n+'"><%= node.title || "Other" %></label>'),i=t.formElement.otherField.inline?i+'<div class="other-field-content">'+e+"</div></div>":i+'</div><div class="other-field-content">'+e+"</div>"},onBeforeRender:function(e,i){var t,n,l,a,s;i&&i.schemaElement&&((t=i.formElement.options)&&(n='<div class="'+(i.formElement.inline?e.cls.checkboxWrapInlineClass:e.cls.checkboxWrapClass)+"\"><input class='"+e.cls.checkboxInputClass+'<%= (title ? "" : " position-static") %><%= (node.formElement.fieldHtmlClass ? " " + node.formElement.fieldHtmlClass : "") %>\' type="checkbox" id="<%= name %>" value="<%= escape(value) %>" name="<%= name %>" aria-label="<%= title ? escape(title) : name %>" <% if (checked) {%>checked="checked" <% } else { %><%= (node.isReadOnly() ? "disabled " : "") %><% } %><%= (node.disabled ? "disabled" : "") %>/><% if (title) { %><label class="'+e.cls.checkboxLabelClass+'" for="<%= name %>"><%= title || "" %></label><% } %></div>',l="",i.formElement.otherField&&i.formElement.otherField.asArrayValue&&i.value?(a=t.map(function(e){return e.value}),s=[],i.value.forEach(function(e){h.include(a,e)||s.push(e)}),0<s.length&&(i.otherValues=s)):delete i.otherValues,h.each(t,function(e,t){i.formElement.otherField&&e.value===(i.formElement.otherField.otherValue||"OTHER")?i.formElement.otherField.idx=t:l+=h.template(n,o)({name:i.key+"["+t+"]",value:i.formElement.optionsAsEnumOrder?1:e.value,checked:h.include(i.value,e.value),title:e.title,node:i,escape:p})}),i.formElement.otherField,e.choiceshtml=l))},onInsert:function(e,t){var i=t.formElement.otherField&&t.formElement.otherField.inline?f(t.el).find(".inline-other-field :checkbox").first():f(t.el).find(".other-field :checkbox"),n=f(t.el).find(".other-field-content :input");function l(){var t;i.prop("checked",(t=!1,n.each(function(){var e=f(this);return e.is(":checkbox, :radio")&&e.prop("checked")||!e.is("button")&&""!==f(this).val()?!(t=!0):void 0}),t))}n.on("keyup",l).on("change",l).trigger("change"),i.on("change",function(){this.checked?(this.checked=!1,n.not(":checkbox,:radio,button").trigger("focus")):n.filter("input[type=text], textarea").val("")})}},checkboxbuttons:{template:'<div id="<%= node.id %>" class="<%= cls.buttonGroupClass %> btn-group-toggle" data-toggle="buttons"><%= choiceshtml %></div>',fieldtemplate:!0,inputfield:!0,onBeforeRender:function(i,n){var e,l=null,a='<label class="btn <% if (checked) { %>active <%= node.formElement && node.formElement.activeClass ? node.formElement.activeClass : cls.buttonClass %><% } else { %><%= cls.buttonClass %><% } %><%= (node.disabled || node.isReadOnly() ? " disabled" : "") %>"><input type="checkbox" style="position:absolute;left:-9999px;" '+(i.fieldHtmlClass?'class="'+i.fieldHtmlClass+'" ':"")+'<% if (checked) { %> checked="checked" <% } %> name="<%= name %>" value="<%= value %>" <%= (node.disabled ? "disabled" : "") %>/><%= title %></label> ';n&&n.schemaElement&&(e=n.formElement.options)&&(n.value&&Array.isArray(n.value)||(n.value=[]),l="",h.each(e,function(e,t){l+=h.template(a,o)({name:n.key+"["+t+"]",checked:h.include(n.value,e.value),value:e.value,title:e.title,node:n,cls:i.cls})}),i.choiceshtml=l)},onInsert:function(e,t){var i=(t.formElement||{}).activeClass||t.ownerTree.defaultConfig.buttonClass;f(t.el).find("label.btn").on("click",function(){f(this).find("input:checkbox").prop("checked")?(f(this).removeClass(t.ownerTree.defaultConfig.buttonClass),f(this).toggleClass(i,!0)):(f(this).toggleClass(i,!1),f(this).addClass(t.ownerTree.defaultConfig.buttonClass))}).find(":checked").closest("label.btn").addClass(i)}},array:{template:'<div id="<%= id %>"><ul class="_jsonform-array-ul" style="list-style-type:none;"><%= children %></ul><% if (!node.isReadOnly()) { %><span class="_jsonform-array-buttons"><a href="#" class="btn <%= cls.buttonClass %> _jsonform-array-addmore"><i class="<%= cls.iconClassPrefix %>-plus" title="<%= node.formElement.addMoreTooltip ? escape(node.formElement.addMoreTooltip) : \'Add new item\'%>"></i> <%= node.formElement.addMoreTitle || \'\'%></a> </span><% } %></div>',fieldtemplate:!0,array:!0,childTemplate:function(e,t){var i='<span class="_jsonform-array-legend"><%= escape(node.legend) || "" %></span> ';return t.isReadOnly()||(!f("").sortable||u(t.formElement.draggable)&&!t.formElement.draggable||(i+='<span class="draggable line"><i class="<%= cls.iconClassPrefix %>-list" title="Move item"></i></span> '),i+='<a href="#" class="_jsonform-array-item-delete"><i class="<%= cls.iconClassPrefix %>-trash" title="Remove item"></i></a>'),'<li data-idx="<%= node.childPos %>">'+i+e+"</li>"},onInsert:function(e,r){function d(){h.each(r.children,function(e,t){f('> ul._jsonform-array-ul > li[data-idx="'+t+'"] > span._jsonform-array-legend',c).html(p(e.legend||""))});var e=0<=n.minItems&&r.children.length<=n.minItems;c.find(a).toggle(!e)}function i(e){if(0<=n.maxItems){var t=n.maxItems-r.children.length;if(c.find(l).toggleClass("disabled",t<=1),t<1)return}r.insertArrayItem(e,f("> ul",c).get(0)),r.ownerTree.defaultConfig.useTooltip&&v(),d()}var c=f(r.el).find("#"+g(r.id)),n=r.getArrayBoundaries(),l="> span > a._jsonform-array-addmore",a="> ul > li > a._jsonform-array-item-delete";if(c.off("click",l).on("click",l,function(e){var t=r.children.length;e.preventDefault(),e.stopPropagation(),i(t)}),c.off("click",a).on("click",a,function(e){e.preventDefault(),e.stopPropagation();var e=f(e.currentTarget).parent().data("idx"),t=r.children.length-Math.max(n.minItems,0);c.find(a).toggle(1<t),t<1||(r.deleteArrayItem(e),d(),c.find(l).toggleClass("disabled",0<=n.maxItems&&r.children.length>=n.maxItems))}),f(r.el).on("legendUpdated",function(e){d(),e.preventDefault(),e.stopPropagation()}),u(r.formElement.draggable)&&!r.formElement.draggable||!r.isReadOnly()&&f(r.el).sortable&&(f("> ul",c).sortable(),f("> ul",c).on("sortstop",function(e,t){var i=f(t.item).data("idx"),t=f(t.item).index(),n=t;if(i!==n){for(var l=i<n?1:-1,a=0,s=f("> ul",c),a=i;a!==n;a+=l)r.children[a].switchValuesWith(r.children[a+l]),r.children[a].render(s.get(0)),r.children[a+l].render(s.get(0));var t=f(r.children[i].el),o=f(r.children[n].el);t.detach(),o.detach(),i<n?(0===i?s.prepend(t):f(r.children[i-1].el).after(t),f(r.children[n-1].el).after(o)):(0===n?s.prepend(o):f(r.children[n-1].el).after(o),f(r.children[i-1].el).after(t))}d()})),0<=n.minItems)for(var t=r.children.length;t<n.minItems;t++)i(r.children.length);d(),c.find(l).toggleClass("disabled",0<=n.maxItems&&r.children.length>=n.maxItems);var s=0<=n.minItems&&r.children.length<=n.minItems;c.find(a).toggle(!s)}},tabarray:{template:'<div id="<%= id %>"><div class="jsonform-tabbable"><ul class="nav <%= cls.navTabsClass %>"><%= tabs %></ul><div style="clear: both;"></div><div class="tab-content"><%= children %></div></div></div>',fieldtemplate:!0,array:!0,childTemplate:function(e){return'<div data-idx="<%= node.childPos %>" class="tab-pane">'+e+"</div>"},onBeforeRender:function(e,t){e.tabs=""},onInsert:function(e,o){function r(e){var i="",t=!1,n=((e=void 0===e?(e=f("> .jsonform-tabbable > ul.nav .active",d).data("idx"))?parseInt(e,10):(t=!0,0):e)>=o.children.length&&(e=o.children.length-1),h.each(o.children,function(e,t){f('> .jsonform-tabbable > .tab-content > [data-idx="'+t+'"] > fieldset > legend',d).html(e.legend);e=e.legend||e.title||"Item "+(t+1);i+='<li class="tabwrap '+o.ownerTree.defaultConfig.navItemClass+'" data-idx="'+t+'"><a class="draggable tab '+o.ownerTree.defaultConfig.navLinkClass+'" data-toggle="tab" rel="'+escape(e)+'">'+p(e),o.isReadOnly()||(i+=' <span href="#" class="_jsonform-array-item-delete"><i class="'+o.ownerTree.defaultConfig.iconClassPrefix+'-trash" title="Remove item"></i></span></a>'),i+="</li>"}),!o.isReadOnly()&&(l.maxItems<0||o.children.length<l.maxItems)&&(i+='<li class="tabwrap '+o.ownerTree.defaultConfig.navItemClass+'" data-idx="-1"><a class="tab '+o.ownerTree.defaultConfig.navLinkClass+' _jsonform-array-addmore" title="'+(o.formElement.addMoreTooltip?p(o.formElement.addMoreTooltip):"Add new item")+'"><i class="'+o.ownerTree.defaultConfig.iconClassPrefix+'-plus"></i> '+(o.formElement.addMoreTitle||"New")+"</a></li>"),f("> .jsonform-tabbable > ul.nav",d).html(i),0<=l.minItems&&o.children.length<=l.minItems);d.find(a).toggle(!n),t&&f('> .jsonform-tabbable > ul.nav [data-idx="0"]',d).addClass("active").find("> a").addClass("active"),f('> .jsonform-tabbable > ul.nav [data-toggle="tab"]',d).eq(e).trigger("click")}function i(e){if(0<=l.maxItems){var t=l.maxItems-o.children.length;if(d.find(n).toggleClass("disabled",t<=1),t<1)return}o.insertArrayItem(e,d.find("> .jsonform-tabbable > .tab-content").get(0)),o.ownerTree.defaultConfig.useTooltip&&v(),r(e)}var d=f(o.el).find("#"+g(o.id)),l=o.getArrayBoundaries(),n="> .jsonform-tabbable > ul.nav > li > ._jsonform-array-addmore",a="> .jsonform-tabbable > ul.nav > li > a > ._jsonform-array-item-delete";if(d.off("click",n).on("click",n,function(e){var t=o.children.length;e.preventDefault(),e.stopPropagation(),i(t)}),d.off("click",a).on("click",a,function(e){e.preventDefault(),e.stopPropagation();var e=f(e.currentTarget).closest("li").data("idx"),t=o.children.length-Math.max(l.minItems,0);d.find(a).toggle(1<t),t<1||(o.deleteArrayItem(e),r(),d.find(n).toggleClass("disabled",0<=l.maxItems&&o.children.length>=l.maxItems))}),f(o.el).on("legendUpdated",function(e){r(),e.preventDefault(),e.stopPropagation()}),u(o.formElement.draggable)&&!o.formElement.draggable||!o.isReadOnly()&&f(o.el).sortable&&f("> .jsonform-tabbable > ul.nav",d).sortable({containment:o.el,cancel:"._jsonform-array-addmore",tolerance:"pointer"}).on("sortchange",function(e,t){t.placeholder.index()==f(this).children().length-1&&-1==t.placeholder.prev().data("idx")&&t.placeholder.prev().before(t.placeholder)}).on("sortstop",function(e,t){var i=f(t.item).data("idx"),t=f(t.item).index(),n=t;if(i!==n)for(var l=i<n?1:-1,a=0,s=f("> .jsonform-tabbable > .tab-content",d).get(0),a=i;a!==n;a+=l)o.children[a].switchValuesWith(o.children[a+l]),o.children[a].render(s),o.children[a+l].render(s);r(t)}),0<=l.minItems)for(var t=o.children.length;t<l.minItems;t++)i(o.children.length);r(),d.find(n).toggleClass("disabled",0<=l.maxItems&&o.children.length>=l.maxItems);var s=0<=l.minItems&&o.children.length<=l.minItems;d.find(a).toggle(!s)}},help:{template:'<small <%= id ? \'id="\' + id + \'"\' : "" %> class="<%= cls.helpClass %>" style="padding-top:5px"><%= node.helpvalue || elt.helpvalue %></small>',fieldtemplate:!0},null:{template:'<input type="hidden" id="<%= id %>" name="<%= node.name %>" value="null" <%= (node.disabled? " disabled" : "")%> />',inputfield:!0,fieldtemplate:!0},msg:{template:"<%= elt.msg %>"},html:{template:"<%= elt.html %>"},textview:{template:'<pre id="<%= id %>" name="<%= node.name %>"><%= value %></pre>',inputfield:!0,fieldtemplate:!0},fieldset:{template:'<fieldset class="jsonform-node jsonform-error-<%= keydash %> <% if (elt.expandable) { %>expandable<% } %> <%= elt.htmlClass?elt.htmlClass:"" %>" <% if (id) { %> id="<%= id %>"<% } %> data-jsonform-type="fieldset"<%= (node.disabled ? " disabled" : "") %>><% if (node.title || node.legend) { %><legend class="<%= cls.legendClass %>" role="treeitem" aria-expanded="false"><%= node.title || node.legend %><% if (node.description && (elt.useTooltip === true || (elt.useTooltip === undefined && cls.useTooltip))) { %><span data-toggle="tooltip" data-placement="right" title="<%= node.description %>" class="<%= cls.tooltipClass %> jsonform-description-tooltip"><i class="<%= cls.iconClassPrefix %>-<%= cls.tooltipIconSuffix %>"></i></span><% } %></legend><% } %><% if (node.description && !(elt.useTooltip === true || (elt.useTooltip === undefined && cls.useTooltip))) { %><small class="<%= cls.helpClass %> jsonform-description"><%= node.description %></small><% } %><% if (elt.expandable) { %><div class="<%= cls.formsGroupClass %>"><% } %><%= children %><% if (elt.expandable) { %></div><% } %><small class="<%= cls.errorTextClass %> jsonform-errortext" style="display:none;"></small></fieldset>',onInsert:function(e,t){null!==t.el&&(f(".expandable > div, .expandable > fieldset",t.el).hide(),f(".expandable",t.el).removeClass("expanded"))}},advancedfieldset:{template:'<fieldset class="jsonform-node jsonform-error-<%= keydash %> <% if (elt.expandable !== false) { %>expandable<% } %> <%= elt.htmlClass?elt.htmlClass:"" %>"<% if (id) { %> id="<%= id %>"<% } %> data-jsonform-type="advancedfieldset"<%= (node.disabled ? " disabled" : "") %>><legend class="<%= cls.legendClass %>" role="treeitem" aria-expanded="false"><%= (node.title || node.legend) ? (node.title || node.legend) : "Advanced options" %></legend><% if (elt.expandable !== false) { %><div class="<%= cls.formsGroupClass %>"><% } %><%= children %><% if (elt.expandable !== false) { %></div><% } %><small class="<%= cls.errorTextClass %> jsonform-errortext" style="display:none;"></small></fieldset>',onInsert:function(e,t){null!==t.el&&(f(".expandable > div, .expandable > fieldset",t.el).hide(),f(".expandable",t.el).removeClass("expanded"))}},authfieldset:{template:'<fieldset class="jsonform-node jsonform-error-<%= keydash %> <% if (elt.expandable !== false) { %>expandable<% } %> <%= elt.htmlClass?elt.htmlClass:"" %>"<% if (id) { %> id="<%= id %>"<% } %> data-jsonform-type="authfieldset"<%= (node.disabled ? " disabled" : "") %>><legend class="<%= cls.legendClass %>" role="treeitem" aria-expanded="false"><%= (node.title || node.legend) ? (node.title || node.legend) : "Authentication settings" %></legend><% if (elt.expandable !== false) { %><div class="<%= cls.formsGroupClass %>"><% } %><%= children %><% if (elt.expandable !== false) { %></div><% } %><small class="<%= cls.errorTextClass %> jsonform-errortext" style="display:none;"></small></fieldset>',onInsert:function(e,t){null!==t.el&&(f(".expandable > div, .expandable > fieldset",t.el).hide(),f(".expandable",t.el).removeClass("expanded"))}},submit:{template:'<input type="submit" <% if (id) { %> id="<%= id %>" <% } %> class="btn <%= cls.submitButtonClass %> <%= elt.htmlClass?elt.htmlClass:"" %>" value="<%= value || node.title %>"<%= (node.disabled? " disabled" : "")%>/>'},reset:{template:'<input type="reset" <% if (id) { %> id="<%= id %>" <% } %> class="btn <%= cls.resetButtonClass %> <%= elt.htmlClass?elt.htmlClass:"" %>" value="<%= value || node.title %>"<%= (node.disabled? " disabled" : "")%>/>'},button:{template:'<button type="button" <% if (id) { %> id="<%= id %>" <% } %> class="btn <%= cls.buttonClass %> <%= elt.htmlClass?elt.htmlClass:"" %>"><%= node.title %></button>'},actions:{template:'<div class="<%= cls.actionsClass %> <%= elt.htmlClass?elt.htmlClass:"" %>"><%= children %></div>'},hidden:{template:'<input type="hidden" id="<%= id %>" name="<%= node.name %>" value="<%= escape(value) %>" <%= (node.disabled? " disabled" : "")%> />',inputfield:!0},tabs:{template:'<ul class="nav <%= cls.navTabsClass %> <%= elt.htmlClass?elt.htmlClass:"" %>"<% if (elt.id) { %> id="<%= elt.id %>"<% } %>><%=tab_list%></ul><div style="clear: both;"></div><div class="tab-content" <% if (elt.id) { %> data-tabset="<%= elt.id %>"<% } %>><%=children%></div>',getElement:function(e){return f(e).parent().get(0)},onBeforeRender:function(e,l){var a=p(l.id?l.id+"-":""),s="";return h.each(l.children,function(e,t){var i=p(e.title||"Item "+(t+1)),n=i.replace(" ","_");s+='<li class="tabwrap '+l.ownerTree.defaultConfig.navItemClass+(0===t?" active":"")+'"><a href="#'+a+n+'" class="tab '+l.ownerTree.defaultConfig.navLinkClass+(0===t?" active":"")+'" data-tab="'+a+n+'" data-toggle="tab">'+i+(e.formElement&&e.formElement.addIcon?'<i class="'+l.ownerTree.defaultConfig.iconClassPrefix+"-"+e.formElement.addIcon+'"></i>':"")+"</a></li>"}),e.tab_list=s,e},onInsert:function(e,t){f("#"+t.id+">li.tabwrap").on("click",function(e){e.preventDefault(),f(t.el).find("div[data-tabset='"+t.id+"']>div.tab-pane.active").each(function(){f(this).removeClass("active")});e=f(this).find("a").attr("data-tab");f("#"+e).addClass("active")})}},tab:{template:'<div class="tab-pane<% if (elt.htmlClass) { %> <%= elt.htmlClass %> <% } %><% if (node.childPos === 0) { %> active<% } %>" id="<%= tabId %>"><%= children %></div>',onBeforeRender:function(e,t){return e.tabId=p(t.parentNode.id?t.parentNode.id+"-":"")+p(t.title||"Item "+(t.childPos+1)).replace(" ","_"),e}},selectfieldset:{template:'<fieldset class="tab-container <%= elt.htmlClass?elt.htmlClass:"" %>"<%= (node.disabled ? " disabled" : "") %>><% if (node.legend) { %><legend class="<%= cls.legendClass %>" role="treeitem" aria-expanded="false"><%= node.legend %></legend><% } %><% if (node.formElement.key) { %><input type="hidden" id="<%= node.id %>" name="<%= node.name %>" value="<%= escape(value) %>" /><% } else { %><a id="<%= node.id %>"></a><% } %><div class="jsonform-tabbable"><div class="<%= cls.formClass %><%= node.formElement.hideMenu ? " hide" : "" %><%= (node.isReadOnly() ? " " + cls.formReadonlyClass : "") %><%= (node.disabled ? " " + cls.formDisabledClass : "") %>"><% if (!elt.notitle) { %><label class="<%= cls.labelClass %>" for="<%= node.id %>"><%= node.getTitle() %></label><% } %><div<% if (cls.controlClass) { %> class="<%= cls.controlClass %>"<% } %>><%= tabs %></div></div><div class="tab-content"><%= children %></div></div></fieldset>',inputfield:!0,getElement:function(e){return f(e).parent().get(0)},childTemplate:function(e){return'<div data-idx="<%= node.childPos %>" class="tab-pane<% if (node.active) { %> active<% } %>">'+e+"</div>"},onBeforeRender:function(e,n){var t=null,l=[],i=(n.schemaElement&&(l=n.schemaElement.enum||[]),t=n.options?h.map(n.options,function(e,t){var i=n.children[t];return i.childPos=t,e instanceof Object?((e=h.extend({node:i},e)).title=e.title||i.legend||i.title||"Option "+(i.childPos+1),e.value=u(e.value)?e.value:u(l[t])?l[t]:t,e):{title:e,value:u(l[i.childPos])?l[i.childPos]:i.childPos,node:i}}):h.map(n.children,function(e,t){return e.childPos=t,{title:e.legend||e.title||"Option "+(e.childPos+1),value:l[e.childPos]||e.value||e.childPos,node:e}}),h.each(t,function(e,t){e.node.active=!1}),null),a=((i=(i=(i=void 0!==e.value?h.find(t,function(e){return e.value==n.value}):i)||h.find(t,function(e){return e.node.hasNonDefaultValue()}))||t[0]).node.active=!0,e.value=i.value,n.formElement,"");return e.cls.selectWrapClass&&(a+='<div class="'+e.cls.selectWrapClass+'">'),a+='<select class="nav '+e.cls.textualInputClass+'"'+(n.disabled?" disabled":"")+">",h.each(t,function(e,t){a+='<option data-idx="'+t+'" value="'+e.value+'"'+(e.node.active?' selected="selected" class="active"':"")+">"+p(e.title)+"</option>"}),a+="</select>",e.cls.selectWrapClass&&(a+="</div>"),e.tabs=a,e},onInsert:function(e,i){f(i.el).find("select.nav").first().on("change",function(e){var t=f(this).find("option:selected");f(i.el).find('input[type="hidden"]').first().val(t.attr("value"))})}},optionfieldset:{template:'<div<% if (node.id) { %> id="<%= node.id %>"<% } %>><%= children %></div>'},section:{template:'<div<% if (node.id) { %> id="<%= node.id %>"<% } %> class="jsonform-node jsonform-error-<%= keydash %> <%= elt.htmlClass?elt.htmlClass:"" %>"><%= children %></div>'},questions:{template:'<div><input type="hidden" id="<%= node.id %>" name="<%= node.name %>" value="<%= escape(value) %>" /><%= children %></div>',fieldtemplate:!0,inputfield:!0,getElement:function(e){return f(e).parent().get(0)},onInsert:function(e,t){t.children&&0!==t.children.length&&(h.each(t.children,function(e){f(e.el).hide()}),f(t.children[0].el).show())}},question:{template:'<div id="<%= node.id %>"<% if (elt.optionsType === "radiobuttons") { %> class="<%= cls.buttonGroupClass %> btn-group-toggle" data-toggle="buttons"<% } %><% if (elt.inline) { %> class="<%= cls.formInlineClass %>"<% } %>><% _.each(node.options, function(key, val) { %><% if (elt.optionsType === "radiobuttons") { %><label class="btn <%= cls.buttonClass %><%= ((key instanceof Object && key.htmlClass) ? " " + key.htmlClass : "") %><%= (node.disabled || node.isReadOnly() ? " disabled" : "") %>"><input type="radio" style="position:absolute;left:-9999px;" name="<%= node.id %>" value="<%= val %>" <%= (node.disabled ? "disabled" : "") %>/><%= (key instanceof Object ? key.title : key) %></label> <% } else { %><div class="<% if (elt.inline) { %><%= cls.radioWrapInlineClass %><% } else { %><%= cls.radioWrapClass %><% } %>"><input class=\'<%= cls.radioInputClass %><%= ((key instanceof Object && key.htmlClass) ? " " + key.htmlClass : "") %>\' type="radio" id="<%= node.id %>_<%= escape(val) %>" value="<%= val %>" name="<%= node.id %>" <%= (node.disabled || node.isReadOnly() ? "disabled" : "") %>/><label class="<%= cls.radioLabelClass %>" for="<%= node.id %>_<%= escape(val) %>"><%= (key instanceof Object ? key.title : key) %></label></div><% } %><% }); %></div>',fieldtemplate:!0,onInsert:function(e,n){var l="active",t=n.formElement||{};t.activeClass?l+=" "+t.activeClass:"radiobuttons"===t.optionsType&&(l+=" "+n.ownerTree.defaultConfig.buttonClass),f(n.el).find('input[type="radio"]').on("change",function(e){var t,i=n.options[f(this).val()];n.parentNode&&n.parentNode.el&&(f(n.el).find("label").removeClass(l),f(n.el).find("label.btn").addClass(n.ownerTree.defaultConfig.buttonClass),f(this).closest("label.btn").removeClass(n.ownerTree.defaultConfig.buttonClass),f(this).closest("label").addClass(l),f(this).siblings("label").addClass(l),f(n.el).nextAll().hide(),f(n.el).nextAll().find('input[type="radio"]').prop("checked",!1),i.value&&f(n.parentNode.el).find('input[type="hidden"]').val(i.value),i.next&&(t=h.find(n.parentNode.children,function(e){return e.formElement&&e.formElement.qid===i.next}),f(t.el).show(),f(t.el).nextAll().hide(),f(t.el).nextAll().find('input[type="radio"]').prop("checked",!1)),i.href&&(i.target?window.open(i.href,i.target):window.location=i.href),i.submit&&setTimeout(function(){n.ownerTree.submit()},0))})}}},E.util.getObjKey=function(e,t,i){for(var n=e,l=t.split("."),a=null,s=null,o=null,r=0;r<l.length;r++){if(null===n||"object"!=typeof n)return null;if(o=(a=l[r]).replace(x,""),x.lastIndex=0,s=x.exec(a))for(;;){if(o&&!h.isArray(n[o]))return null;if(n=(o?n[o]:n)[parseInt(s[1])],!(s=x.exec(a)))break;o=null}else n=(i&&!n[o]&&h.isArray(n)&&n[0]?n[0]:n)[o]}return i&&h.isArray(n)&&n[0]?n[0]:n},E.util.getObjKeyEx=function(e,t,i){var n=e;if(null==t||""===t)return e;if("string"==typeof i&&0<i.length){if(t.slice(0,i.length)!==i)throw new Error("key ["+t+"] does not match the objKey ["+i+"]");"."===(t=t.slice(i.length))[0]&&(t=t.slice(1))}e=t.match(/^((([^\\\[.]|\\.)+)|\[(\d+)\])\.?(.*)$/);if(!e)throw new Error("bad format key: "+t);if("string"==typeof e[2]&&0<e[2].length)n=n[e[2]];else{if(!("string"==typeof e[4]&&0<e[4].length))throw new Error("impossible reach here");n=n[Number(e[4])]}return n=n&&0<e[5].length?this.getObjKeyEx(n,e[5]):n},E.util.setObjKey=function(e,t,i){for(var n=e,l=t.split("."),a=null,s=null,o=null,r=0;r<l.length-1;r++)if(o=(a=l[r]).replace(x,""),x.lastIndex=0,s=x.exec(a)){for(;;)if(h.isArray(n[o])||(n[o]=[]),n=n[o],o=parseInt(s[1],10),!(s=x.exec(a)))break;"object"==typeof n[o]&&null!==n[o]||(n[o]={}),n=n[o]}else"object"==typeof n[o]&&null!==n[o]||(n[o]={}),n=n[o];if(o=(a=l[l.length-1]).replace(x,""),x.lastIndex=0,s=x.exec(a)){for(;;)if(h.isArray(n[o])||(n[o]=[]),n=n[o],o=parseInt(s[1],10),!(s=x.exec(a)))break;n[o]=i}else n[o]=i},C.prototype.clone=function(e){var t=new C;return t.childPos=this.childPos,t.arrayPath=h.clone(this.arrayPath),t.ownerTree=this.ownerTree,t.parentNode=e||this.parentNode,t.formElement=this.formElement,t.schemaElement=this.schemaElement,t.view=this.view,t.children=h.map(this.children,function(e){return e.clone(t)}),t},C.prototype.hasNonDefaultValue=function(){return(!this.formElement||"hidden"!=this.formElement.type)&&(!(!this.value||this.defaultValue)||!!h.find(this.children,function(e){return e.hasNonDefaultValue()}))},C.prototype.getProperty=function(e,t){var i=this[e];return void 0===i&&t&&this.parentNode?this.parentNode.getProperty(e,!0):i},C.prototype.isReadOnly=function(){return this.getProperty("readOnly",!0)},C.prototype.getTitle=function(){var e=this.name;return this.title?e=this.title:this.name===this.key&&this.parentNode&&this.parentNode.key&&(e=e.substring(this.parentNode.key.length),this.parentNode.schemaElement&&this.parentNode.schemaElement.type&&("object"===this.parentNode.schemaElement.type?e=e.substring(1):"array"===this.parentNode.schemaElement.type&&(e=e.replace(/[\[\]']+/g,"")))),e},C.prototype.appendChild=function(e){return e.parentNode=this,e.childPos=this.children.length,this.children.push(e),e},C.prototype.removeChild=function(){var e=this.children[this.children.length-1];if(e)return f(e.el).remove(),this.children.pop()},C.prototype.moveValuesTo=function(e){var t=this.getFormValues(e.arrayPath);e.resetValues(),e.computeInitialValues(t,!0)},C.prototype.switchValuesWith=function(e){var t=this.getFormValues(e.arrayPath),i=e.getFormValues(this.arrayPath);e.resetValues(),e.computeInitialValues(t,!0),this.resetValues(),this.computeInitialValues(i,!0)},C.prototype.resetValues=function(){var e;if(this.value=null,this.parentNode?(this.arrayPath=h.clone(this.parentNode.arrayPath),this.parentNode.view&&this.parentNode.view.array&&this.arrayPath.push(this.childPos)):this.arrayPath=[],this.view&&this.view.inputfield)e=f(":input",this.el).serializeArray(),h.each(e,function(e){f('[name="'+g(e.name)+'"]',f(this.el)).val("")},this);else if(this.view&&this.view.array)for(;0<this.children.length;)this.removeChild();h.each(this.children,function(e){e.resetValues()})},C.prototype.setChildTemplate=function(e){(this.childTemplate=e).parentNode=this},C.prototype.getChildTemplate=function(){return this.childTemplate||this.view.array&&(key=this.formElement.items?this.formElement.items[0]||this.formElement.items:this.formElement.key+"[]",h.isString(key)&&(key={key:key}),this.setChildTemplate(this.ownerTree.buildFromLayout(key))),this.childTemplate},C.prototype.computeInitialValues=function(l,t,i){var a=this,e=null,n=1,s=0,o=this.ownerTree.formDesc.tpldata||{};if(i=i||0,this.parentNode?(this.arrayPath=h.clone(this.parentNode.arrayPath),this.parentNode.view&&this.parentNode.view.array&&this.arrayPath.push(this.childPos)):this.arrayPath=[],o.idx=0<this.arrayPath.length?this.arrayPath[this.arrayPath.length-1]+1:this.childPos+1,o.value="",o.getValue=function(e){if(!l)return"";for(var t=l,i=e.split("[]."),n=0;n<i.length-1;n++)t=t[i[n]][a.arrayPath[n]];return t[i[n]]},this.formElement&&(this.formElement.id?this.id=b(this.formElement.id,this.arrayPath):(this.view&&this.view.array||this.parentNode&&this.parentNode.view&&this.parentNode.view.array||"button"===this.formElement.type||"selectfieldset"===this.formElement.type||"question"===this.formElement.type||"buttonquestion"===this.formElement.type)&&(this.id=g(this.ownerTree.formDesc.prefix)+"-elt-counter-"+h.uniqueId()),this.formElement.key&&(this.key=b(this.formElement.key,this.arrayPath),this.keydash=d(this.key.replace(/\./g,"---"))),this.name=b(this.formElement.name,this.arrayPath),h.each(["title","legend","description","append","prepend","inlinetitle","helpvalue","value","disabled","required","placeholder","readOnly"],function(e){h.isString(this.formElement[e])?(-1!==this.formElement[e].indexOf("{{values.")?this[e]=this.formElement[e].replace(/\{\{values\.([^\}]+)\}\}/g,'{{getValue("$1")}}'):this[e]=b(this.formElement[e],this.arrayPath),this[e]&&(this[e]=h.template(this[e],w)(o))):this[e]=this.formElement[e]},this),this.formElement.options&&(this.options=h.map(this.formElement.options,function(e){var t=null;return h.isObject(e)&&e.title?(t=-1!==e.title.indexOf("{{values.")?e.title.replace(/\{\{values\.([^\}]+)\}\}/g,'{{getValue("$1")}}'):b(e.title,a.arrayPath),h.extend({},e,{value:u(e.value)?e.value:"",title:h.template(t,w)(o)})):e}))),this.view&&this.view.inputfield&&this.schemaElement)l?u(E.util.getObjKey(l,this.key))?this.value=E.util.getObjKey(l,this.key):u(this.schemaElement.default)&&(this.value=this.schemaElement.default,"string"==typeof this.value&&(this.value=h.template(this.value,w)(o))):t||u(this.value)||(r=y(a.ownerTree.formDesc.schema,this.key,i),u(r)&&(this.value=r,h.isString(this.value)&&(-1!==this.value.indexOf("{{values.")?this.value=this.value.replace(/\{\{values\.([^\}]+)\}\}/g,'{{getValue("$1")}}'):this.value=b(this.value,this.arrayPath,!0),this.value&&(this.value=h.template(this.value,w)(o))),this.defaultValue=!0));else if(this.view&&this.view.array){var r,n=0;for(l?(r=E.util.getObjKeyEx(l,this.key))&&Array.isArray(r)?n=r.length:h.isEmpty(r)||(n=this.getPreviousNumberOfItems(l,this.arrayPath)):t||(r=y(a.ownerTree.formDesc.schema,this.key,i))&&Array.isArray(r)&&(n=r.length),s=0;s<n;s++)this.appendChild(this.getChildTemplate().clone())}if(h.each(this.children,function(e){e.computeInitialValues(l,t,i)}),this.formElement&&this.formElement.valueInLegend)for(e=this;e;){if(e.parentNode&&e.parentNode.view&&e.parentNode.view.array&&(e.legendChild=this,e.formElement&&e.formElement.legend)){e.legend=b(e.formElement.legend,e.arrayPath),o.idx=0<e.arrayPath.length?e.arrayPath[e.arrayPath.length-1]+1:e.childPos+1,o.value=u(this.value)?this.value:"",e.legend=h.template(e.legend,w)(o);break}e=e.parentNode}},C.prototype.getPreviousNumberOfItems=function(t,i){var e,n=null;return t?this.view.inputfield&&this.schemaElement?(e=function(e,t){var i=0,n=0;if(!e)return null;if(0<t)for(;i<t;){if(-1===(n=e.indexOf("[]",n)))return e;n+=2,i+=1}return-1===(n=e.indexOf("[]",n))?e:e.substring(0,n)}(this.formElement.key,i.length),e=b(e,i),(e=E.util.getObjKey(t,e))?(n=h.map(this.children,function(e){return e.getPreviousNumberOfItems(t,i)}),h.max([h.max(n)||0,e.length])):0):this.view.array?this.getChildTemplate().getPreviousNumberOfItems(t,i):(n=h.map(this.children,function(e){return e.getPreviousNumberOfItems(t,i)}),h.max(n)||0):0},C.prototype.getFormValues=function(t){var e={};if(!this.el)throw new Error("formNode.getFormValues can only be called on nodes that are associated with a DOM element in the tree");var i=f(":input",this.el).serializeArray();i=(i=i.concat(f(":input[type=checkbox]:not(:disabled):not(:checked)[name]",this.el).map(function(){return{name:this.name,value:this.checked}}).get())).concat(f(':input[type=checkbox]:disabled[name][readonly="readonly"]',this.el).map(function(){return{name:this.name,value:this.checked}}).get()),t&&h.each(i,function(e){e.name=b(e.name,t)});for(var n=this.ownerTree.formDesc.schema,l=0;l<i.length;l++){var a,s,o=i[l].name,r=c(n.properties,o),d=null;if(r)if(r._jsonform_checkboxes_as_array&&(a=o.match(/\[([0-9]*)\]$/)))o=o.replace(/\[([0-9]*)\]$/,""),d=E.util.getObjKey(e,o)||[],"value"===r._jsonform_checkboxes_as_array&&!1!==i[l].value&&""!==i[l].value?d.push(i[l].value):!0===r._jsonform_checkboxes_as_array&&"1"===i[l].value&&d.push(r.enum[parseInt(a[1],10)]),E.util.setObjKey(e,o,d);else if("tagsinput"===r._jsonform_get_value_by_tagsinput)s=t?(a=b(o,this.arrayPath),f(':input[name="'+a+'"]',this.el).tagsinput("items")):f(':input[name="'+o+'"]',this.el).tagsinput("items"),E.util.setObjKey(e,o,s);else if("[]"===o.slice(-2)&&(o=o.slice(0,-2),"array"===(r=c(n.properties,o)).type))(d=E.util.getObjKey(e,o)||[]).push(i[l].value),E.util.setObjKey(e,o,d);else{if("boolean"===r.type&&("0"===i[l].value||"false"===i[l].value?i[l].value=!1:""===i[l].value?i[l].value=null:i[l].value=!!i[l].value),"number"!==r.type&&"integer"!==r.type||h.isString(i[l].value)&&(i[l].value.length?isNaN(Number(i[l].value))||(i[l].value=Number(i[l].value)):i[l].value=null),"string"!==r.type||""!==i[l].value||r._jsonform_allowEmpty||(i[l].value=null),"object"===r.type&&h.isString(i[l].value)&&"{"===i[l].value.substring(0,1))try{i[l].value=m.parse(i[l].value)}catch(e){i[l].value={}}if("array"===r.type&&h.isString(i[l].value))if("["===i[l].value.substring(0,1))try{i[l].value=m.parse(i[l].value)}catch(e){i[l].value=[]}else i[l].value=null;"null"===r.type&&"null"===i[l].value&&(i[l].value=null),"object"!==r.type||"null"!==i[l].value&&""!==i[l].value||(i[l].value=null),i[l].name&&(null!==i[l].value||"null"===r.type&&null===i[l].value)&&E.util.setObjKey(e,i[l].name,i[l].value)}}return e},C.prototype.render=function(e){var t=this.generate();this.setContent(t,e),this.enhance()},C.prototype.setContent=function(e,t){var i,e=f(e),t=t||(this.parentNode?this.parentNode.el:this.ownerTree.domRoot);this.el?f(this.el).replaceWith(e):(i=f(t).children().get(this.childPos))?f(i).before(e):f(t).append(e),this.el=e,this.updateElement(this.el)},C.prototype.updateElement=function(e){this.id&&(this.el=f("#"+g(this.id),e).get(0),this.view&&this.view.getElement&&(this.el=this.view.getElement(this.el)),!1!==this.fieldtemplate&&this.view&&this.view.fieldtemplate&&(this.el=f(this.el).parent().parent(),(this.prepend||this.append)&&(this.el=this.el.parent()),this.el=this.el.get(0)),this.parentNode&&this.parentNode.view&&this.parentNode.view.childTemplate&&(this.el=f(this.el).parent().get(0)));for(const t in this.children)0!=this.children.hasOwnProperty(t)&&this.children[t].updateElement(this.el||e)},C.prototype.generate=function(){var e={id:this.id,keydash:this.keydash,elt:this.formElement,schema:this.schemaElement,node:this,value:u(this.value)?this.value:"",cls:this.ownerTree.defaultConfig,escape:p},t=null,i=(this.ownerTree.formDesc.onBeforeRender&&this.ownerTree.formDesc.onBeforeRender(e,this),this.view.onBeforeRender&&this.view.onBeforeRender(e,this),t=this.template||(this.formElement&&this.formElement.template?this.formElement:this.view).template,!1!==this.fieldtemplate&&(this.fieldtemplate||this.view.fieldtemplate)&&(t=E.fieldTemplate(t)),this.parentNode&&this.parentNode.view&&this.parentNode.view.childTemplate&&(t=this.parentNode.view.childTemplate(t,this.parentNode)),"");return h.each(this.children,function(e){i+=e.generate()}),e.children=i,e.fieldHtmlClass="",this.ownerTree&&this.ownerTree.formDesc&&this.ownerTree.formDesc.params&&this.ownerTree.formDesc.params.fieldHtmlClass&&(e.fieldHtmlClass=this.ownerTree.formDesc.params.fieldHtmlClass),this.formElement&&void 0!==this.formElement.fieldHtmlClass&&(e.fieldHtmlClass=this.formElement.fieldHtmlClass),h.template(t,o)(e)},C.prototype.enhance=function(){var e,i=this,t=null,n=h.clone(this.ownerTree.formDesc.tpldata)||{};this.formElement&&(this.view.onInsert&&this.view.onInsert({target:f(this.el)},this),e=this.handlers||this.formElement.handlers,(t=this.onInsert||this.formElement.onInsert)&&t({target:f(this.el)},this),e&&h.each(e,function(e,t){"insert"===t&&e({target:f(this.el)},this)},this),this.el&&(this.onChange&&f(this.el).on("change",function(e){i.onChange(e,i)}),this.view.onChange&&f(this.el).on("change",function(e){i.view.onChange(e,i)}),this.formElement.onChange&&f(this.el).on("change",function(e){i.formElement.onChange(e,i)}),this.onInput&&f(this.el).on("input",function(e){i.onInput(e,i)}),this.view.onInput&&f(this.el).on("input",function(e){i.view.onInput(e,i)}),this.formElement.onInput&&f(this.el).on("input",function(e){i.formElement.onInput(e,i)}),this.onClick&&f(this.el).on("click",function(e){i.onClick(e,i)}),this.view.onClick&&f(this.el).on("click",function(e){i.view.onClick(e,i)}),this.formElement.onClick&&f(this.el).on("click",function(e){i.formElement.onClick(e,i)}),this.onKeyUp&&f(this.el).on("keyup",function(e){i.onKeyUp(e,i)}),this.view.onKeyUp&&f(this.el).on("keyup",function(e){i.view.onKeyUp(e,i)}),this.formElement.onKeyUp&&f(this.el).on("keyup",function(e){i.formElement.onKeyUp(e,i)}),e&&h.each(e,function(t,e){"insert"!==e&&f(this.el).on(e,function(e){t(e,i)})},this)),this.formElement.legend&&this.legendChild&&this.legendChild.formElement&&(t=function(e){i.formElement&&i.formElement.legend&&i.parentNode&&(i.legend=b(i.formElement.legend,i.arrayPath),n.idx=0<i.arrayPath.length?i.arrayPath[i.arrayPath.length-1]+1:i.childPos+1,n.value=f(e.target).val(),i.legend=h.template(i.legend,w)(n),f(i.parentNode.el).trigger("legendUpdated"))},f(this.legendChild.el).on("change",t),f(this.legendChild.el).on("keyup",t))),h.each(this.children,function(e){e.enhance()})},C.prototype.insertArrayItem=function(e,t){var i=0,n=(void 0===e&&(e=this.children.length),this.getChildTemplate().clone());for(this.appendChild(n),n.resetValues(),i=this.children.length-2;e<=i;i--)this.children[i].moveValuesTo(this.children[i+1]);for(this.children[e].resetValues(),this.children[e].computeInitialValues(null,!1,this.children[e].arrayPath.length),i=e;i<this.children.length;i++)this.children[i].render(t)},C.prototype.deleteArrayItem=function(e){for(var t=0,t=e=void 0===e?this.children.length-1:e;t<this.children.length-1;t++)this.children[t+1].moveValuesTo(this.children[t]),this.children[t].render();this.removeChild()},C.prototype.getArrayBoundaries=function(){if(!this.view||!this.view.array)return{minItems:-1,maxItems:-1};function l(e,t){var i=null,n={minItems:-1,maxItems:-1};return t=t||e,e.view&&e.view.array&&e!==t?n:e.key?(i=e.key.replace(/\[[0-9]+\]/g,"[]"),e!==t&&(i=i.replace(/\[\][^\[\]]*$/,"")),(i=c(e.ownerTree.formDesc.schema.properties,i))&&(0<=i.minItems&&(n.minItems=i.minItems),0<=i.minLength&&(n.minItems=i.minLength),0<=i.maxItems&&(n.maxItems=i.maxItems),0<=i.maxLength&&(n.maxItems=i.maxLength)),n):(h.each(e.children,function(e){e=l(e,t);-1!==e.minItems&&(-1!==n.minItems?n.minItems=Math.max(n.minItems,e.minItems):n.minItems=e.minItems),-1!==e.maxItems&&(-1!==n.maxItems?n.maxItems=Math.min(n.maxItems,e.maxItems):n.maxItems=e.maxItems)}),n)}return l(this)};a.prototype.initialize=function(e){this.formDesc=h.clone(e=e||{}),E.defaultConfig=n(),this.defaultConfig=h.clone(E.defaultConfig),this.formDesc.defaultConfig&&h.extend(this.defaultConfig,this.formDesc.defaultConfig),this.formDesc.prefix=this.formDesc.prefix||"jsonform-"+h.uniqueId();function c(e,t){Array.isArray(e)||(e=[e]);for(var i=!!t,n=[],l=0;l<e.length;l++){var a=e[l];"object"==typeof a?(n.push(a),i=!0):n.push({type:a})}return i&&n}this.formDesc.schema&&!0===function(e){if(e.type&&(h.isString(e.type)||Array.isArray(e.type)))return!1;var t,i=["$schema","properties","definitions"];for(t in e)if(h.contains(i,t))return!1;return!0}(this.formDesc.schema)&&(this.formDesc.schema={type:"object",properties:this.formDesc.schema}),this.formDesc._originalSchema=this.formDesc.schema,this.formDesc.schema=m.parse(m.stringify(this.formDesc.schema)),function e(t){if(t){var i,n;if(t.type&&("string"!=typeof t.type?(i=c(t.type))&&(t.anyOf=i,delete t.type):"any"==t.type&&delete t.type),t.extends&&(i=t.extends,Array.isArray(i)||(i=[i]),t.allOf=i,delete t.extends),t.disallow&&("string"==typeof t.disallow?t.not={type:t.disallow}:t.not={anyOf:c(t.disallow,!0)},delete t.disallow),t.properties){var l,a=Array.isArray(t.required)?t.required:[];for(l in t.properties){var s=t.properties[l];if(s&&"boolean"==typeof s.required)s.required&&a.indexOf(l)<0&&a.push(l),delete s.required;else if(void 0!==s.required&&"boolean"!=typeof s.required&&!Array.isArray(s.required))throw new Error("field "+l+"'s required property should be either boolean or array of strings");if("array"===s.type&&s.items&&Array.isArray(s.items))throw new Error("the items property of array property "+l+" in the schema definition must be an object")}a.length&&(t.required=a)}if(t.dependencies)for(var o in t.dependencies)"string"==typeof t.dependencies[o]&&(t.dependencies[o]=[t.dependencies[o]]);for(n in"boolean"==typeof t.required&&delete t.required,void 0!==t.divisibleBy&&(t.multipleOf=t.divisibleBy,delete t.divisibleBy),t)if("properties"===n||"patternProperties"===n||"dependencies"===n)for(var r in t[n])t[n][r]=e(t[n][r]);else if("enum"!==n)if(Array.isArray(t[n]))for(var d=0;d<t[n].length;d++)t[n][d]=e(t[n][d]);else"object"==typeof t[n]&&(t[n]=e(t[n]));return t}}(this.formDesc.schema),this.formDesc._originalSchemaV4=this.formDesc.schema,this.formDesc.schema=m.parse(m.stringify(this.formDesc.schema)),this.formDesc._originalSchemaV4.$schema&&delete this.formDesc._originalSchemaV4.$schema;var r=[],d=0;this.formDesc.schema.definitions&&!function a(s,o){Object.keys(s).forEach(function(e,t,i){var n,l=s[e];if(0===d&&"$ref"===e&&null!==l&&"string"==typeof l){if("#/definitions/"!==l.slice(0,14))throw new Error("Unresolved $ref: "+l);n=l.replace(/^#\/definitions\//,""),delete(s=h.extend(s,o[n])).$ref,r.indexOf(s)<0&&r.push(s)}else if(null!==l&&"object"==typeof l)if(l.$ref){if("#/definitions/"!==l.$ref.slice(0,14))throw new Error("Unresolved $ref: "+l.$ref);n=l.$ref.replace(/^#\/definitions\//,""),s[e]=h.extend(s[e],o[n]),delete s[e].$ref}else r.indexOf(l)<0&&(d+=1,a(l,o),--d,r.push(l))})}(this.formDesc.schema,this.formDesc.schema.definitions);if(this.formDesc.schema&&!0===function(e){if(e.type){if(h.isString(e.type)&&"object"===e.type)return!1;if(Array.isArray(e.type)&&h.contains(e.type,"object"))return!1}else if(e.properties)return!1;return!0}(this.formDesc.schema)){var t,i={},e=this.formDesc.prefix+"-distortedSchema";for(t in this.formDesc.schema)h.contains(["$schema","definitions"],t)||(i[t]=this.formDesc.schema[t],delete this.formDesc.schema[t]);this.formDesc.schema.properties={},this.formDesc.schema.properties[e]=i,this.formDesc._isDistorted=!0,!this.formDesc.value||"object"==typeof this.formDesc.value&&!Array.isArray(this.formDesc.value)||(this.formDesc.value={[e]:this.formDesc.value})}else this.formDesc._isDistorted=!1;this.formDesc.form=this.formDesc.form||["*",{type:"actions",items:[{type:"submit",value:"Submit"}]}],this.formDesc.form=h.isArray(this.formDesc.form)?this.formDesc.form:[this.formDesc.form],this.formDesc.params=this.formDesc.params||{},this.root=new C,(this.root.ownerTree=this).root.view=E.elementTypes.root,this.buildTree(),this.computeInitialValues()},a.prototype.buildTree=function(){h.each(this.formDesc.form,function(e){"*"===e?h.each(this.formDesc.schema.properties,function(e,t){this.formDesc.nonDefaultFormItems&&0<=this.formDesc.nonDefaultFormItems.indexOf(t)||this.root.appendChild(this.buildFromLayout({key:t}))},this):(h.isString(e)&&(e={key:e}),this.root.appendChild(this.buildFromLayout(e)))},this)},a.prototype.buildFromLayout=function(i,e){var t=null,n=new C;if(i.key&&this.formDesc.customFormItems&&(void 0!==(s=this.formDesc.customFormItems[i.key])&&(s.key=i.key,i=s)),(i=h.clone(i)).items&&(h.isArray(i.items)?i.items=h.map(i.items,h.clone):i.items=[h.clone(i.items)]),i.key){if(!(t=c(this.formDesc.schema.properties,i.key)))throw new Error('The JSONForm object references the schema key "'+i.key+'" but that key does not exist in the JSON schema');this.formDesc.onElementSchema&&this.formDesc.onElementSchema(i,t),i.name=i.name||i.key,i.title=i.title||t.title,i.description=i.description||t.description,i.readOnly=i.readOnly||t.readOnly||i.readonly||t.readonly;var l=function(e,t){var e=e.split("."),i=e.pop();if("[]"==i.slice(-2))return!1;var n,e=e.join(".");return e?(n=c(t.properties,e)).required&&0<=n.required.indexOf(i)&&("[]"==e.slice(-2)||l(e,t)):t.required&&0<=t.required.indexOf(i)};if(i.required=!0===i.required||!0===t.required||l(i.key,this.formDesc.schema),i.id||(i.id=g(this.formDesc.prefix)+"-elt-"+d(i.key)),i.allowEmpty&&(t._jsonform_allowEmpty=!0),!i.type){if(h.isArray(t.type)){if(h.contains(t.type,"null")&&(t.type=h.without(t.type,"null"),t.required=!1),1<t.type.length)throw new Error("Cannot process schema element with multiple types.");t.type=h.first(t.type)}"string"===t.type&&!h.isUndefined(t.format)&&h.contains(["url","time","email","date-time","date","color"],t.format)?"date-time"===t.format?i.type="datetime-local":i.type=t.format:"number"!==t.type&&"integer"!==t.type||t.enum?"string"!==t.type&&"any"!==t.type||t.enum?"boolean"===t.type?i.type="checkbox":"object"===t.type?t.properties?i.type="fieldset":i.type="textarea":h.isUndefined(t.enum)?i.type=t.type:i.type="select":i.type="text":i.type="number"}function a(i,e){i.options?Array.isArray(i.options)?i.options=i.options.map(function(e){return r(e,"value")?e:{value:e,title:e}}):"object"==typeof i.options&&(i.options=Object.keys(i.options).map(function(e){return{value:e,title:i.options[e]}})):i.titleMap?i.options=h.map(e,function(e){var t=e.toString();return{value:e,title:r(i.titleMap,t)?i.titleMap[t]:t}}):i.options=e.map(function(e){return{value:e,title:e.toString()}})}var s,o;i.options?a(i):!t.enum&&"boolean"!==t.type||((s=t.enum)?i.optionsAsEnumOrder=!0:s="select"===i.type?["",!0,!1]:[!0,!1],a(i,s)),"checkboxes"!==i.type&&"checkboxbuttons"!==i.type||!t.items||(s=Array.isArray(t.items)?t.items[0]:t.items,i.options?(a(i),s._jsonform_checkboxes_as_array="value"):(o=s.enum)&&(a(i,o),i.optionsAsEnumOrder=!0,s._jsonform_checkboxes_as_array="checkboxes"===i.type||"value")),"tagsinput"===i.getValue&&(t._jsonform_get_value_by_tagsinput="tagsinput"),"object"===t.type&&h.each(t.properties,function(e,t){t=i.key+"."+t;this.formDesc.nonDefaultFormItems&&0<=this.formDesc.nonDefaultFormItems.indexOf(t)||n.appendChild(this.buildFromLayout({key:t}))},this)}if(i.type||(i.type="text"),!(o=E.elementTypes[i.type]))throw new Error('The JSONForm contains an element whose type is unknown: "'+i.type+'"');if(t){if(!o.inputfield&&!o.array&&"selectfieldset"!==i.type&&"object"!==t.type)throw new Error('The JSONForm contains an element that links to an element in the JSON schema (key: "'+i.key+'") and that should not based on its type ("'+i.type+'")')}else if(o.inputfield&&"selectfieldset"!==i.type)throw new Error('The JSONForm defines an element of type "'+i.type+'" but no "key" property to link the input field to the JSON schema');return i.iddot=g(i.id||""),n.formElement=i,n.schemaElement=t,n.view=o,n.ownerTree=this,i.handlers||(i.handlers={}),n.view.array||(i.items?h.each(i.items,function(e){h.isString(e)&&(e={key:e}),n.appendChild(this.buildFromLayout(e))},this):i.otherField&&(s=i.otherField,h.isString(s)?s=i.otherField={key:s,notitle:!0}:void 0===s.notitle&&(s.notitle=!0),void 0===s.inline&&(s.inline=i.inline),n.appendChild(this.buildFromLayout(s)))),n},a.prototype.computeInitialValues=function(){this.root.computeInitialValues(this.formDesc.value)},a.prototype.render=function(e){e&&(this.domRoot=e,this.root.render(),this.hasRequiredField()&&f(e).addClass("jsonform-hasrequired"),f(e).addClass("jsonform"))},a.prototype.forEachElement=function(i){function n(e){for(var t=0;t<e.children.length;t++)i(e.children[t]),n(e.children[t])}n(this.root)},a.prototype.validate=function(e){var t,i,n=E.getFormValue(this.domRoot),l=!1,a=this.formDesc;return!1!==a.validate&&(t=!1,"object"!=typeof a.validate?s.Ajv?(t=new s.Ajv({allErrors:!0,schemaId:"auto",unknownFormats:"ignore",validateSchema:"log"}),this.formDesc._validatorVendor="ajv"):s.ZSchema?(t=new s.ZSchema({ignoreUnknownFormats:!0}),this.formDesc._validatorVendor="z-schema"):s.JSONFormValidator&&(t=s.JSONFormValidator.createEnvironment("json-schema-draft-03"),this.formDesc._validatorVendor="jsv"):t=a.validate,t&&(f(this.domRoot).jsonFormErrors(!1,a),"ajv"==this.formDesc._validatorVendor?!(i=t.compile(this.formDesc._originalSchemaV4))(n)&&i.errors&&i.errors.length&&(l=i.errors):"z-schema"==this.formDesc._validatorVendor?(t.validate(n,this.formDesc._originalSchemaV4),l=t.getLastErrors(),0):(i=t.validate(n,this.formDesc._originalSchema))&&i.errors&&i.errors.length&&(l=(l=l||[]).concat(i.errors)))),l&&!e&&(a.displayErrors?a.displayErrors(l,this.domRoot):f(this.domRoot).jsonFormErrors(l,a)),{errors:l,values:n}},a.prototype.submit=function(t){function e(){return t&&(t.preventDefault(),t.stopPropagation()),!1}var i=E.getFormValue(this.domRoot),n=this.formDesc,l=!1;if(this.forEachElement(function(e){l||e.view.onSubmit&&(l=!e.view.onSubmit(t,e))}),l)return e();var a=this.validate();return(n.onSubmit&&!n.onSubmit(a.errors,i)||a.errors||!(!n.onSubmitValid||n.onSubmitValid(i)))&&e()},a.prototype.hasRequiredField=function(){return 0<f(this.domRoot).find(".jsonform-required").length},E.getFormValue=function(e){e=f(e).data("jsonform-tree");if(!e)return null;var t=e.root.getFormValues();return t=e.formDesc._isDistorted?t[e.formDesc.prefix+"-distortedSchema"]:t},f.fn.jsonFormErrors=function(e,t){var i=f(this).data("jsonform-tree");if(f("."+i.defaultConfig.groupMarkClassPrefix+"error",this).removeClass(i.defaultConfig.groupMarkClassPrefix+"error"),f("."+i.defaultConfig.groupMarkClassPrefix+"warning",this).removeClass(i.defaultConfig.groupMarkClassPrefix+"warning"),f(".jsonform-errortext",this).hide(),e){for(var n,l,a,s,o=[],r=0;r<e.length;r++)"ajv"===i.formDesc._validatorVendor?(n=e[r].dataPath||e[r].instancePath,0<=["dependencies","required","additionalProperties"].indexOf(e[r].keyword)&&e[r].params&&h.isObject(e[r].params)&&(n&&"/"!=n.slice(-1)&&(n+="/"),n+=e[r].params.missingProperty||e[r].params.property)):"z-schema"===i.formDesc._validatorVendor?(n=e[r].path,0<=["OBJECT_DEPENDENCY_KEY","OBJECT_MISSING_REQUIRED_PROPERTY"].indexOf(e[r].code)&&("/"!=n.slice(-1)&&(n+="/"),n+=e[r].params[0])):"jsv"===i.formDesc._validatorVendor?(n=e[r].uri,0<=["dependencies","required"].indexOf(e[r].attribute)&&("/"!=n.slice(-1)&&(n+="/"),e[r].details&&h.isObject(e[r].details)&&(l=Object.keys(e[r].details)[0],Array.isArray(e[r].details[l])?n+=e[r].details[l][0]:n+=l))):n=e[r].uri||e[r].path||e[r].dataPath,n&&(n=(n="ajv"!==i.formDesc._validatorVendor||"."!==n.charAt(0)&&"/"!==n.charAt(0)?n:n.substring(1)).replace(/.*#\//,"").replace(/\//g,".").replace(/\.([0-9]+)(?=\.|$)/g,"[$1]"),l=".jsonform-error-"+g(n.replace(/\./g,"---")),o.push(l),a=e[r].type||"error",s=f(l,this),"ajv"===i.formDesc._validatorVendor?0<=["minItems","maxItems"].indexOf(e[r].keyword)&&(0<=["checkboxes","checkboxbuttons"].indexOf(s.data("jsonform-type"))?e[r].message="Please select at "+("minItems"==e[r].keyword?"least":"most")+" "+e[r].params.limit+(1<e[r].params.limit?" options":" option")+".":0<=["tagsinput"].indexOf(s.data("jsonform-type"))&&(e[r].message="Please insert at "+("minItems"==e[r].keyword?"least":"most")+" "+e[r].params.limit+(1<e[r].params.limit?" tags":" tag")+".")):"z-schema"===i.formDesc._validatorVendor?"ARRAY_LENGTH_SHORT"!=e[r].code&&"ARRAY_LENGTH_LONG"!=e[r].code||(0<=["checkboxes","checkboxbuttons"].indexOf(s.data("jsonform-type"))?e[r].message="Please select at "+("ARRAY_LENGTH_SHORT"==e[r].code?"least":"most")+" "+e[r].params[1]+(1<e[r].params[1]?" options":" option")+".":0<=["tagsinput"].indexOf(s.data("jsonform-type"))&&(e[r].message="Please insert at "+("ARRAY_LENGTH_SHORT"==e[r].code?"least":"most")+" "+e[r].params[1]+(1<e[r].params[1]?" tags":" tag")+".")):"jsv"===i.formDesc._validatorVendor&&0<=["minItems","maxItems"].indexOf(e[r].attribute)&&(0<=["checkboxes","checkboxbuttons"].indexOf(s.data("jsonform-type"))?e[r].message="Please select at "+("minItems"==e[r].attribute?"least":"most")+" "+e[r].details+(1<e[r].details?" options":" option")+".":0<=["tagsinput"].indexOf(s.data("jsonform-type"))&&(e[r].message="Please insert at "+("minItems"==e[r].attribute?"least":"most")+" "+e[r].details+(1<e[r].details?" tags":" tag")+".")),s.addClass(i.defaultConfig.groupMarkClassPrefix+a),s.find("> div > .jsonform-errortext, > .jsonform-errortext").text(e[r].message).show());var o=o.join(","),d=f(o,this),c=d.parents(".tab-pane"),m=f(),c=(c.each(function(){var e=f(this);m=m.add(e.closest(".jsonform-tabbable").find("> .nav > li").eq(e.index()).addClass(i.defaultConfig.groupMarkClassPrefix+"error"))}),d.filter(":visible").get(0));(c=!c&&0<m.length?m.get(0):c)&&c.scrollIntoView&&c.scrollIntoView(!0,{behavior:"smooth"})}},f.fn.jsonForm=function(e,t){if("values"===e)return E.getFormValue(this);if("submit"===e||"validate"===e)return(i=this.data("jsonform-tree"))?"submit"===e?i.submit():i.validate(t):null;var i=this,n=(e=h.defaults({},e,{submitEvent:"submit"}),new a);return n.initialize(e),n.render(i.get(0)),i.data("jsonform-tree",n),e.submitEvent&&(i.off(e.submitEvent+".jsonform"),i.on(e.submitEvent+".jsonform",function(e){n.submit(e)})),l(i),f(".expandable > div, .expandable > fieldset",i).hide(),i.on("click",".expandable > legend",function(){var e=f(this).parent();e.toggleClass("expanded"),e.find("legend").attr("aria-expanded",e.hasClass("expanded")),f("> div",e).slideToggle(100)}),n.defaultConfig.useTooltip&&v(),n},f.fn.jsonFormValue=function(){return E.getFormValue(this)},s.JSONForm||(s.JSONForm=E)}("undefined"!=typeof exports,"undefined"!=typeof exports?exports:window,"undefined"!=typeof jQuery?jQuery:{fn:{}},"undefined"!=typeof _?_:null,JSON);